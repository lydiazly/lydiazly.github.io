<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 7.3.0">

  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16.png">
  <link rel="mask-icon" href="/images/safari-pinned-tab.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.2/css/all.min.css" integrity="sha256-XOqroi11tY4EFQMR9ZYwZWKj5ZXiftSx36RRuC3anlA=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"lydiazly.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.20.0","exturl":false,"sidebar":{"position":"left","width_expanded":320,"width_dual_column":240,"display":"post","padding":18,"offset":12,"width":250},"copycode":{"enable":true,"style":"mac"},"fold":{"enable":false,"height":500},"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"menu_item":"fadeInDown","post_block":"none","post_header":"none","post_body":"none","coll_header":"fadeInLeft","sidebar":"none"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false}}</script><script src="/js/config.js"></script>

    <meta name="description" content="Jupyter Notebook  FITS Data  Anaconda  A conda package is a compressed tarball file that contains system-level libraries, Python or other modules, executable programs and other components. Conda keep">
<meta property="og:type" content="blog">
<meta property="og:title" content="Python 进阶 (lecture for Solar Group)">
<meta property="og:url" content="https://lydiazly.github.io/advance">
<meta property="og:site_name" content="Lydia&#39;s notes">
<meta property="og:description" content="Jupyter Notebook  FITS Data  Anaconda  A conda package is a compressed tarball file that contains system-level libraries, Python or other modules, executable programs and other components. Conda keep">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://lydiazly.github.io/advance/Screenshot_20180617-181206.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/nbtutor1.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/nbtutor2.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/scope_resolution_1.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/anatomy.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/advance_205_0.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/tut_a_2.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/advance_279_1.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/advance_283_0.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/advance_285_0.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/nbtutor3.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/nbtutor4.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/nbtutor5.png">
<meta property="og:image" content="https://lydiazly.github.io/advance/Screenshot_20180618-151438.png">
<meta property="article:published_time" content="2018-07-03T04:46:13.000Z">
<meta property="article:modified_time" content="2018-07-03T04:46:13.000Z">
<meta property="article:author" content="Lydia Zhang">
<meta property="article:tag" content="python">
<meta property="article:tag" content="jupyter">
<meta property="article:tag" content="conda">
<meta property="article:tag" content="astropy">
<meta property="article:tag" content="sunpy">
<meta property="article:tag" content="astronomy">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://lydiazly.github.io/advance/Screenshot_20180617-181206.png">


<link rel="canonical" href="https://lydiazly.github.io/advance.html">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"https://lydiazly.github.io/advance","path":"/advance.html","title":"Python 进阶 (lecture for Solar Group)"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Python 进阶 (lecture for Solar Group) | Lydia's notes</title>
  








  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
<link rel="alternate" href="/atom.xml" title="Lydia's notes" type="application/atom+xml">
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <div class="column">
      <header class="header" itemscope itemtype="http://schema.org/WPHeader"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Lydia's notes</p>
      <i class="logo-line"></i>
    </a>
      <p class="site-subtitle" itemprop="description">Tips about Python and Linux.</p>
      <img class="custom-logo-image" src="/images/logo2.png" alt="Lydia's notes">
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger" aria-label="Search" role="button">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu"><li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>Home</a></li><li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fa fa-user fa-fw"></i>About</a></li><li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>Tags<span class="badge">11</span></a></li><li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>Categories<span class="badge">4</span></a></li><li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>Archives<span class="badge">15</span></a></li><li class="menu-item menu-item-rss"><a href="/atom.xml" rel="section"><i class="fa fa-rss fa-fw"></i>RSS</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>Search
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="Searching..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</header>
        
  
  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#anaconda"><span class="nav-number">1.</span> <span class="nav-text">Anaconda</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#ipython-jupyter"><span class="nav-number">2.</span> <span class="nav-text">IPython &amp; Jupyter</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E7%BB%86%E8%8A%82"><span class="nav-number">3.</span> <span class="nav-text">语法细节</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#python2-python3"><span class="nav-number">3.1.</span> <span class="nav-text">python2 &amp; python3</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#list-tuple"><span class="nav-number">3.2.</span> <span class="nav-text">list,
tuple</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dict"><span class="nav-number">3.3.</span> <span class="nav-text">dict</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#set"><span class="nav-number">3.4.</span> <span class="nav-text">set</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E4%B8%80%E4%BA%9B%E7%89%B9%E6%80%A7%E7%9A%84%E6%BC%94%E7%A4%BA"><span class="nav-number">3.5.</span> <span class="nav-text">一些特性的演示</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8C%85%E5%90%AB%E5%88%A4%E6%96%AD%E7%9A%84%E5%8D%95%E8%A1%8C%E5%BE%AA%E7%8E%AF"><span class="nav-number">3.6.</span> <span class="nav-text">包含判断的单行循环</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%8D%95%E8%A1%8C-if-%E4%B8%89%E5%85%83%E5%85%B3%E7%B3%BB%E8%BF%90%E7%AE%97"><span class="nav-number">3.7.</span> <span class="nav-text">单行 if (三元关系运算)</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%BE%AA%E7%8E%AF-%E8%BF%AD%E4%BB%A3%E5%99%A8-%E7%94%9F%E6%88%90%E5%99%A8"><span class="nav-number">3.8.</span> <span class="nav-text">循环, 迭代器, 生成器</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%87%BD%E6%95%B0%E5%AE%9A%E4%B9%89"><span class="nav-number">3.9.</span> <span class="nav-text">函数定义</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%91%BD%E5%90%8D%E7%A9%BA%E9%97%B4%E5%92%8C%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F"><span class="nav-number">3.10.</span> <span class="nav-text">命名空间和变量作用域</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#numpy"><span class="nav-number">4.</span> <span class="nav-text">NumPy</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#numpy-%E7%9A%84%E6%95%B0%E6%8D%AE%E7%B1%BB%E5%9E%8B-dtype"><span class="nav-number">4.1.</span> <span class="nav-text">numpy 的数据类型 dtype</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#np.arange-%E5%8F%82%E6%95%B0%E4%B8%BA%E6%B5%AE%E7%82%B9%E6%95%B0%E6%97%B6%E8%A6%81%E6%B3%A8%E6%84%8F%E7%9A%84%E7%BB%86%E8%8A%82"><span class="nav-number">4.2.</span> <span class="nav-text">np.arange 参数为浮点数时要注意的细节</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A9%E9%98%B5"><span class="nav-number">4.3.</span> <span class="nav-text">矩阵</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E5%92%8C%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97"><span class="nav-number">4.4.</span> <span class="nav-text">数组和矩阵运算</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E6%95%B0%E7%BB%84%E8%BF%90%E7%AE%97"><span class="nav-number">4.4.1.</span> <span class="nav-text">数组运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E4%BD%BF%E7%94%A8%E6%95%B0%E7%BB%84%E8%BF%9B%E8%A1%8C%E7%9F%A9%E9%98%B5%E8%BF%90%E7%AE%97"><span class="nav-number">4.4.2.</span> <span class="nav-text">使用数组进行矩阵运算</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E7%9B%B4%E6%8E%A5%E4%BD%BF%E7%94%A8%E7%9F%A9%E9%98%B5%E7%B1%BB%E5%9E%8B%E8%BF%9B%E8%A1%8C%E8%BF%90%E7%AE%97"><span class="nav-number">4.4.3.</span> <span class="nav-text">直接使用矩阵类型进行运算</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8%E4%BD%9C%E5%9D%90%E6%A0%87%E6%A0%BC%E7%82%B9%E7%9A%84%E6%95%B0%E7%BB%84%E7%9A%84%E5%87%A0%E7%A7%8D%E5%BD%A2%E5%BC%8F"><span class="nav-number">4.5.</span> <span class="nav-text">用作坐标格点的数组的几种形式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#mask"><span class="nav-number">4.6.</span> <span class="nav-text">mask</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E5%AF%B9%E6%95%B0%E7%BB%84%E5%85%83%E7%B4%A0%E7%9A%84%E5%A4%84%E7%90%86"><span class="nav-number">4.7.</span> <span class="nav-text">其他对数组元素的处理</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#matplotlib"><span class="nav-number">5.</span> <span class="nav-text">Matplotlib</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#sunpy-%E7%A4%BA%E4%BE%8B"><span class="nav-number">6.</span> <span class="nav-text">SunPy
示例</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E6%96%87%E4%BB%B6"><span class="nav-number">6.1.</span> <span class="nav-text">示例文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%A4%BA%E4%BE%8B%E4%B8%AD%E7%9A%84-fits-%E8%AF%BB%E5%8F%96%E6%96%B9%E6%B3%95"><span class="nav-number">6.2.</span> <span class="nav-text">示例中的 fits 读取方法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B3%E4%BA%8E-scaled-image-data"><span class="nav-number">6.3.</span> <span class="nav-text">关于 Scaled Image Data</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%9D%90%E6%A0%87%E5%92%8C%E5%8D%95%E4%BD%8D"><span class="nav-number">6.4.</span> <span class="nav-text">坐标和单位</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%AF%AD%E6%B3%95%E5%AF%B9%E6%AF%94"><span class="nav-number">6.5.</span> <span class="nav-text">语法对比</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%8F%92%E5%80%BC-%E6%8B%9F%E5%90%88"><span class="nav-number">7.</span> <span class="nav-text">插值,
拟合</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8F%92%E5%80%BC"><span class="nav-number">7.1.</span> <span class="nav-text">插值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%B1%82%E6%9E%81%E5%80%BC"><span class="nav-number">7.2.</span> <span class="nav-text">求极值</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%8B%9F%E5%90%88"><span class="nav-number">7.3.</span> <span class="nav-text">拟合</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%85%B6%E4%BB%96"><span class="nav-number">7.4.</span> <span class="nav-text">其他</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#copy-%E6%B3%A8%E6%84%8F%E4%BA%8B%E9%A1%B9"><span class="nav-number">8.</span> <span class="nav-text">copy 注意事项</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%85%B6%E4%BB%96%E6%A0%BC%E5%BC%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99"><span class="nav-number">9.</span> <span class="nav-text">其他格式文件读写</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%94%A8-pandas-%E8%AF%BB-csv"><span class="nav-number">9.1.</span> <span class="nav-text">用 pandas 读 csv</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#fortran-%E4%BA%8C%E8%BF%9B%E5%88%B6%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99"><span class="nav-number">9.2.</span> <span class="nav-text">Fortran 二进制文件读写</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#unformatted-sequential"><span class="nav-number">9.2.1.</span> <span class="nav-text">Unformatted (sequential)</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#unformatted-stream"><span class="nav-number">9.2.2.</span> <span class="nav-text">Unformatted (stream)</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#hdf5-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99-ncdf-cdf-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96"><span class="nav-number">9.3.</span> <span class="nav-text">HDF5
文件读写, NCDF, CDF 文件读取</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%BB%E5%86%99-hdf5-%E6%96%87%E4%BB%B6-%E8%AF%BB-ncdf-%E6%96%87%E4%BB%B6"><span class="nav-number">9.3.1.</span> <span class="nav-text">读写 HDF5
文件, 读 NCDF 文件</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E5%A4%A7%E5%B0%8F%E6%AF%94%E8%BE%83"><span class="nav-number">9.3.2.</span> <span class="nav-text">大小比较</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#%E8%AF%BB%E5%8F%96-cdf-%E6%96%87%E4%BB%B6"><span class="nav-number">9.3.3.</span> <span class="nav-text">读取 CDF 文件</span></a></li></ol></li><li class="nav-item nav-level-3"><a class="nav-link" href="#numpy-to-vtk"><span class="nav-number">9.4.</span> <span class="nav-text">NumPy to VTK</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#matlab-mat-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99"><span class="nav-number">9.5.</span> <span class="nav-text">Matlab mat 文件读写</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E7%9B%B8%E5%85%B3"><span class="nav-number">10.</span> <span class="nav-text">脚本相关</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E7%BB%93%E6%9E%84"><span class="nav-number">10.1.</span> <span class="nav-text">脚本结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#try-...-except-...-%E8%AF%AD%E6%B3%95"><span class="nav-number">10.2.</span> <span class="nav-text">try ... except ... 语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#paraview-%E8%84%9A%E6%9C%AC"><span class="nav-number">10.3.</span> <span class="nav-text">Paraview 脚本</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#python-2---3-%E7%9A%84%E8%BD%AC%E6%8D%A2"><span class="nav-number">10.4.</span> <span class="nav-text">Python 2 -&gt; 3 的转换</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E6%89%A7%E8%A1%8C-shell-%E5%91%BD%E4%BB%A4"><span class="nav-number">10.5.</span> <span class="nav-text">执行 shell 命令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E8%84%9A%E6%9C%AC%E9%80%89%E9%A1%B9"><span class="nav-number">10.6.</span> <span class="nav-text">脚本选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E5%A4%84%E7%90%86-warnings"><span class="nav-number">10.7.</span> <span class="nav-text">处理 warnings</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#urllib-requests"><span class="nav-number">11.</span> <span class="nav-text">urllib, requests</span></a></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">Lydia Zhang</p>
  <div class="site-description" itemprop="description">Tips about Python and Linux.</div>
</div>
<div class="site-state-wrap animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">15</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">4</span>
        <span class="site-state-item-name">categories</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">11</span>
        <span class="site-state-item-name">tags</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author animated">
      <span class="links-of-author-item">
        <a href="mailto:lydiazly2@nju.edu.cn" title="E-Mail → mailto:lydiazly2@nju.edu.cn" rel="noopener me" target="_blank"><i class="fa fa-envelope fa-fw"></i></a>
      </span>
  </div>
  <div class="cc-license animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-sa/4.0/deed.en" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdnjs.cloudflare.com/ajax/libs/creativecommons-vocabulary/2020.11.3/assets/license_badges/big/by_sa.svg" alt="Creative Commons"></a>
  </div>

        </div>
      </div>
    </div>

    
    <div class="sidebar-inner sidebar-blogroll">
      <div class="links-of-blogroll animated">
        <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
          Links
        </div>
        <ul class="links-of-blogroll-list">
            <li class="links-of-blogroll-item">
              <a href="https://github.com/lydiazly/scripts-sunpy" title="https:&#x2F;&#x2F;github.com&#x2F;lydiazly&#x2F;scripts-sunpy" rel="noopener" target="_blank">My SunPy scripts</a>
            </li>
        </ul>
      </div>
    </div>
  </aside>


    </div>

    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="https://lydiazly.github.io/advance">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="Lydia Zhang">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Lydia's notes">
      <meta itemprop="description" content="Tips about Python and Linux.">
    </span>

    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Python 进阶 (lecture for Solar Group) | Lydia's notes">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Python 进阶 (lecture for Solar Group)
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2018-07-02 21:46:13" itemprop="dateCreated datePublished" datetime="2018-07-02T21:46:13-07:00">2018-07-02</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">In</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/Lecture-Topics/" itemprop="url" rel="index"><span itemprop="name">Lecture Topics</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="Views" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">Views: </span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody"><p>
<a class="btn" target="_blank" rel="noopener" href="https://github.com/lydiazly/python-intro/raw/master/notebooks/python-intro.zip"><i class="fa fa-download fa-fw"></i>Jupyter Notebook</a>
<wbr> <a class="btn" target="_blank" rel="noopener" href="https://pan.baidu.com/s/1nwsIcDr?pwd=s5re"><i class="fa fa-download fa-fw"></i>FITS Data</a>
</p>
<h2 id="anaconda"><a href="#anaconda"
class="headerlink"></a>Anaconda</h2>
<blockquote>
<p>A <strong>conda package</strong> is a compressed tarball file that
contains system-level libraries, Python or other modules, executable
programs and other components. <strong>Conda</strong> keeps track of the
dependencies between packages and platforms.<br>
(https://conda.io/docs/user-guide/concepts.html)</p>
</blockquote>
<ul>
<li>凡使用 <span style="color:blue">pip install</span>
安装的包均为编译安装, <span style="color:blue">conda install</span>
安装的则为编译好的二进制包.</li>
<li>conda 包可以打包其他语言, pip 包容易出现系统依赖问题</li>
<li>conda 包的依赖管理更完善</li>
<li>conda 环境下仍可使用 pip 进行安装, 但所使用的 pip 命令和系统中的 pip
互不影响, 安装的包的位置也在 conda 本身的目录下.</li>
<li>每个环境互不影响, 各环境下的包虽然必须分别安装 (也可以 clone
一个现有环境),<br> 但如果有不同环境中有重复的包 conda 将默认使用
<em>hard link</em>.</li>
</ul>
<p>(更多讨论参考 <a
target="_blank" rel="noopener" href="https://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/)"
class="uri">https://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/)</a>
<span id="more"></span></p>
<p><img data-src='/advance/Screenshot_20180617-181206.png' width='650'/></p>
<ul>
<li>python 位置 (未使用 conda 时)</li>
</ul>
<p>使用 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ python -m site</span><br></pre></td></tr></table></figure> 可以看到有哪些目录.</p>
<p>三个部分:</p>
<ul>
<li><strong>root</strong>
<pre>
/<span style="color:#800080"><b>usr</b></span>/lib/...
/<span style="color:#800080"><b>usr</b></span>/bin/...
</pre></li>
<li><strong>user</strong>
<pre>
/home/&lt;user&gt;/<span style="color:#800080"><b>.local</b></span>/lib/...
/home/&lt;user&gt;/<span style="color:#800080"><b>.local</b></span>/bin/...
</pre></li>
<li><strong>anaconda/miniconda</strong>
<pre>
/home/&lt;user&gt;/<b><span style="color:#800080">miniconda3</span></b>/</span>/lib/...
/home/&lt;user&gt;/<b><span style="color:#800080">miniconda3</span></b>/</span>/bin/...
</pre></li>
<li>conda 目录结构 (安装之后自动修改了软连接,
修改环境变量后系统优先使用这个位置)</li>
</ul>
<pre>
/home/&lt;user&gt;/<span style="color:#800080"><b>miniconda3/</b></span>
    ├── <span style="color:navy"><b>pkgs/</b></span>
    ├── <span style="color:dimgray"><b>bin/</b></span>
    │        ├── <span style="color:magenta">python</span> -&gt; <span style="color:green">python3.6</span>
    │        ├── <span style="color:magenta">python3</span> -&gt; <span style="color:green">python3.6</span>
    │        ├── <span style="color:green">python3.6</span>
    │        ├── <span style="color:green">jupyter</span>
    │        ├── <span style="color:green">h5dump</span>
    │        └── ...
    ├── <span style="color:dimgray"><b>include/</b></span>
    ├── <span style="color:dimgray"><b>lib/</b></span>
    ├── <span style="color:dimgray"><b>share/</b></span>
    ├── <span style="color:navy"><b>envs</b></span>
    │        ├── <span style="color:blue"><b>env1/</b></span>
    │        │        ├── <span style="color:dimgray"><b>bin/</b></span>
    │        │        ├── <span style="color:dimgray"><b>include/</b></span>
    │        │        ├── <span style="color:dimgray"><b>lib/</b></span>
    │        │        ├── <span style="color:dimgray"><b>share/</b></span>
    │        │        └── ...
    │        ├── <span style="color:blue"><b>env2/</b></span>
    │        └── ...
    └── ...
</pre>
<h2 id="ipython-jupyter"><a href="#ipython-jupyter"
class="headerlink"></a>IPython &amp; Jupyter</h2>
<p>参考文档 <a target="_blank" rel="noopener" href="http://jupyter-notebook.readthedocs.io/en/stable/"
class="uri">http://jupyter-notebook.readthedocs.io/en/stable/</a></p>
<ul>
<li>配置文件路径</li>
</ul>
<p>一般用户配置文件在 <code>~/.jupyter</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!jupyter --paths</span><br></pre></td></tr></table></figure>
<pre><code>config:
    /home/lydia/.jupyter
    /home/lydia/miniconda3/etc/jupyter
    /usr/local/etc/jupyter
    /etc/jupyter
data:
    /home/lydia/.local/share/jupyter
    /home/lydia/miniconda3/share/jupyter
    /usr/local/share/jupyter
    /usr/share/jupyter
runtime:
    /run/user/1000/jupyter</code></pre>
<ul>
<li>列出所有 magic functions:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%lsmagic</span><br></pre></td></tr></table></figure>
<ul>
<li>运行脚本:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%run script.py</span><br><span class="line">%run script.ipynb</span><br></pre></td></tr></table></figure>
<ul>
<li>在单个 Cell 中调用其他语言 (子进程):</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%sh</span><br><span class="line"><span class="built_in">cd</span> ~/miniconda3/</span><br><span class="line"><span class="built_in">pwd</span></span><br></pre></td></tr></table></figure>
<pre><code>/home/lydia/miniconda3</code></pre>
<p>可以看到实际并未改变当前目录 (因为是子进程):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br></pre></td></tr></table></figure>
<pre><code>&#39;/home/lydia/codes/zly/python/python-intro&#39;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%script idl</span><br><span class="line">cd, current=d</span><br><span class="line"><span class="built_in">print</span>, d</span><br></pre></td></tr></table></figure>
<pre><code>/home/lydia/codes/zly/python/python-intro


IDL Version 8.2.1 (linux x86_64 m64). (c) 2012, Exelis Visual Information Solutions, Inc.</code></pre>
<ul>
<li>逐行使用 bash 命令 (注意不加 '!' 的区别):</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!idl -e field3dgui</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!ls ./</span><br></pre></td></tr></table></figure>
<p>得到的结果可以存入变量:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">current, = !pwd  <span class="comment"># returns a list</span></span><br><span class="line">current</span><br></pre></td></tr></table></figure>
<pre><code>&#39;/home/lydia/python-intro&#39;</code></pre>
<p>下面这两句不能写在一个 Cell 中:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd -q ~/miniconda3/</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pwd</span><br></pre></td></tr></table></figure>
<pre><code>&#39;/home/lydia/miniconda3&#39;</code></pre>
<p>用 <code>&#123;var&#125;</code> (推荐) 或 <code>$var</code> (不推荐) 调用当前
ipython 环境的变量:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd &#123;current&#125;</span><br></pre></td></tr></table></figure>
<pre><code>/home/lydia/codes/zly/python/python-intro</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd <span class="string">&quot;$current&quot;</span></span><br></pre></td></tr></table></figure>
<pre><code>/home/lydia/codes/zly/python/python-intro</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">cd $current</span><br></pre></td></tr></table></figure>
<pre><code>/home/lydia/codes/zly/python/python-intro</code></pre>
<p>见 <del><a
target="_blank" rel="noopener" href="http://mmcdan.github.io/posts/interacting-with-the-shell-via-jupyter-notebook/"
class="uri">http://mmcdan.github.io/posts/interacting-with-the-shell-via-jupyter-notebook/</a></del>
(broken)</p>
<ul>
<li>列出当前的变量信息</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="string">&#x27;x&#x27;</span></span><br><span class="line"></span><br><span class="line">%whos <span class="built_in">int</span> <span class="built_in">str</span></span><br></pre></td></tr></table></figure>
<pre><code>Variable   Type    Data/Info
----------------------------
a          int     1
b          str     x</code></pre>
<h2 id="语法细节"><a href="#语法细节"
class="headerlink"></a>语法细节</h2>
<h3 id="python2-python3"><a href="#python2-python3"
class="headerlink"></a>python2 &amp; python3</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%python2</span><br><span class="line"><span class="built_in">print</span> <span class="number">1</span> / <span class="number">2</span></span><br><span class="line"><span class="built_in">print</span> <span class="number">1</span> // <span class="number">2</span></span><br></pre></td></tr></table></figure>
<pre><code>0
0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%python3</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span> / <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span> // <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<pre><code>0.5
0</code></pre>
<p>详见 <a href="#python-2---3-的转换">Python 2 -&gt; 3 的转换</a></p>
<h3 id="list-tuple"><a href="#list-tuple" class="headerlink"></a>list,
tuple</h3>
<ul>
<li>对 list 或 tuple, 当只有一个元素时, 注意加逗号:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>]</span><br><span class="line"><span class="built_in">type</span>(l)</span><br></pre></td></tr></table></figure>
<pre><code>list</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>,]</span><br><span class="line"><span class="built_in">type</span>(l)</span><br></pre></td></tr></table></figure>
<pre><code>list</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l = (<span class="number">1</span>)</span><br><span class="line"><span class="built_in">type</span>(l)</span><br></pre></td></tr></table></figure>
<pre><code>int</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l = (<span class="number">1</span>,)</span><br><span class="line"><span class="built_in">type</span>(l)</span><br></pre></td></tr></table></figure>
<pre><code>tuple</code></pre>
<ul>
<li>赋值, 星号 (<code>*</code>) 表达式用来展开 list/tuple, 双星号
(<code>**</code>) 用来展开 dict (常用于函数参数表):</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a, b, *c = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">a, b, c</span><br></pre></td></tr></table></figure>
<pre><code>(0, 1, [2, 3])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a, *_ = [<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>] <span class="comment"># 或 a, = ...</span></span><br><span class="line">a</span><br></pre></td></tr></table></figure>
<pre><code>0</code></pre>
<h3 id="dict"><a href="#dict" class="headerlink"></a>dict</h3>
<ul>
<li>dict 改变某个 key 但 value 不变的方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">d = &#123;<span class="string">&#x27;a&#x27;</span> : <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span> : <span class="number">2</span>&#125;</span><br><span class="line">d[<span class="string">&#x27;c&#x27;</span>] = d.pop(<span class="string">&#x27;b&#x27;</span>)  <span class="comment"># 利用 `pop` 返回值, 更改 key 值</span></span><br><span class="line">d</span><br></pre></td></tr></table></figure>
<pre><code>&#123;&#39;a&#39;: 1, &#39;c&#39;: 2&#125;</code></pre>
<ul>
<li>dict 求并集</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d1 = &#123;<span class="string">&#x27;a&#x27;</span> : <span class="number">1</span>, <span class="string">&#x27;b&#x27;</span> : <span class="number">2</span>&#125;</span><br><span class="line">d2 = &#123;<span class="string">&#x27;a&#x27;</span> : -<span class="number">1</span>, <span class="string">&#x27;c&#x27;</span> : <span class="number">3</span>, <span class="string">&#x27;d&#x27;</span> : <span class="number">4</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dict</span>(d1, **d2)  <span class="comment"># 重复的 key 取后一个的值</span></span><br></pre></td></tr></table></figure>
<pre><code>&#123;&#39;a&#39;: -1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">dict</span>(<span class="built_in">list</span>(d1.items()) + <span class="built_in">list</span>(d2.items()))  <span class="comment"># 注意其中的 list</span></span><br></pre></td></tr></table></figure>
<pre><code>&#123;&#39;a&#39;: -1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">d1.update(d2)</span><br><span class="line">d1</span><br></pre></td></tr></table></figure>
<pre><code>&#123;&#39;a&#39;: -1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</code></pre>
<h3 id="set"><a href="#set" class="headerlink"></a>set</h3>
<ul>
<li>set 基本操作</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">s = &#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.add(<span class="number">3</span>) <span class="comment"># one element only</span></span><br><span class="line">s</span><br></pre></td></tr></table></figure>
<pre><code>&#123;1, 2, 3&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.update([<span class="number">4</span>, <span class="number">5</span>]) <span class="comment"># iterable: list/tuple/set/...</span></span><br><span class="line">s</span><br></pre></td></tr></table></figure>
<pre><code>&#123;1, 2, 3, 4, 5&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.remove(<span class="number">1</span>)</span><br><span class="line">s</span><br></pre></td></tr></table></figure>
<pre><code>&#123;2, 3, 4, 5&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">s.discard(<span class="number">0</span>)  <span class="comment"># No error if not exist</span></span><br><span class="line">s</span><br></pre></td></tr></table></figure>
<pre><code>&#123;2, 3, 4, 5&#125;</code></pre>
<ul>
<li>set 求交集, 并集, 差集, 对称差集, 子集</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125;.intersection(&#123;<span class="number">2</span>, <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>&#123;2&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125; &amp; &#123;<span class="number">2</span>, <span class="number">3</span>&#125;  <span class="comment"># 或用 and</span></span><br></pre></td></tr></table></figure>
<pre><code>&#123;2&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125;.union(&#123;<span class="number">2</span>, <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>&#123;1, 2, 3&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125; | &#123;<span class="number">2</span>, <span class="number">3</span>&#125;  <span class="comment"># 或用 or</span></span><br></pre></td></tr></table></figure>
<pre><code>&#123;1, 2, 3&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125;.difference(&#123;<span class="number">2</span>, <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>&#123;1&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125; - &#123;<span class="number">2</span>, <span class="number">3</span>&#125;  <span class="comment"># 在前不在后</span></span><br></pre></td></tr></table></figure>
<pre><code>&#123;1&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125;.symmetric_difference(&#123;<span class="number">2</span>, <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>&#123;1, 3&#125;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125; ^ &#123;<span class="number">2</span>, <span class="number">3</span>&#125;  <span class="comment"># 不同时在两边</span></span><br></pre></td></tr></table></figure>
<pre><code>&#123;1, 3&#125;</code></pre>
<ul>
<li>属于, 包含于(子集)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">2</span> <span class="keyword">in</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;  <span class="comment"># list/tuple/set</span></span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4</span> <span class="keyword">not</span> <span class="keyword">in</span> &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;  <span class="comment"># list/tuple/set</span></span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125;.issubset(&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>&#125; &lt;= &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;.issuperset(&#123;<span class="number">1</span>, <span class="number">2</span>&#125;)</span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125; &gt;= &#123;<span class="number">1</span>, <span class="number">2</span>&#125;</span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<h3 id="一些特性的演示"><a href="#一些特性的演示"
class="headerlink"></a>一些特性的演示</h3>
<p>插件 <a target="_blank" rel="noopener" href="https://github.com/lgpage/nbtutor"
class="uri">https://github.com/lgpage/nbtutor</a><br> 网页版 <a
target="_blank" rel="noopener" href="http://pythontutor.com/"
class="uri">http://pythontutor.com/</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">%reload_ext nbtutor</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%nbtutor -r -f</span><br><span class="line">l1= (<span class="number">0</span>)</span><br><span class="line">l2 = (<span class="number">0</span>,)</span><br></pre></td></tr></table></figure>
<p><a target="_blank" rel="noopener" href="http://t.cn/Rg9J3bf">网页版演示</a></p>
<p><img data-src='/advance/nbtutor1.png' width='550'/></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">%%nbtutor -r -f -i</span><br><span class="line">a = <span class="number">3</span></span><br><span class="line">b = <span class="number">4</span></span><br><span class="line">t = (<span class="number">1</span>, <span class="number">2</span>, [a, b]) <span class="comment"># list in tuple</span></span><br><span class="line">a = <span class="string">&#x27;x&#x27;</span> <span class="comment"># change element in list</span></span><br><span class="line">t[<span class="number">2</span>][<span class="number">0</span>] = <span class="string">&#x27;xx&#x27;</span> <span class="comment"># change element in tuple</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(t)</span><br></pre></td></tr></table></figure>
<pre><code>(1, 2, [&#39;xx&#39;, 4])</code></pre>
<p><a target="_blank" rel="noopener" href="http://t.cn/Rg9idUn">网页版演示</a></p>
<p><img data-src='/advance/nbtutor2.png' width='550'/></p>
<h3 id="包含判断的单行循环"><a href="#包含判断的单行循环"
class="headerlink"></a>包含判断的单行循环</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">l = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]</span><br><span class="line">[i <span class="keyword">for</span> i <span class="keyword">in</span> l <span class="keyword">if</span> i &gt; <span class="number">2</span>]</span><br></pre></td></tr></table></figure>
<pre><code>[3, 4, 5]</code></pre>
<p>例如用 <code>globals()</code> 来得到字符串形式的变量名 (python
的变量没有提供这个功能的关键字, 因为"变量名"存储在namespaces中)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">namestr</span>(<span class="params">obj, namespace</span>):</span><br><span class="line">    <span class="keyword">return</span> [name <span class="keyword">for</span> name <span class="keyword">in</span> namespace <span class="keyword">if</span> namespace[name] <span class="keyword">is</span> obj][<span class="number">0</span>]</span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line"><span class="keyword">for</span> var <span class="keyword">in</span> (a, b):</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&#x27;<span class="subst">&#123;namestr(var, <span class="built_in">globals</span>())&#125;</span> = <span class="subst">&#123;var&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>a = 1
b = 2</code></pre>
<h3 id="单行-if-三元关系运算"><a href="#单行-if-三元关系运算"
class="headerlink"></a>单行 if (三元关系运算)</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="string">&#x27;y&#x27;</span> <span class="keyword">if</span> a &gt; <span class="number">0</span> <span class="keyword">else</span> <span class="string">&#x27;n&#x27;</span></span><br><span class="line">b</span><br></pre></td></tr></table></figure>
<pre><code>&#39;y&#39;</code></pre>
<h3 id="循环-迭代器-生成器"><a href="#循环-迭代器-生成器"
class="headerlink"></a>循环, 迭代器, 生成器</h3>
<p>Python 的 for 循环不使用索引变量, 而使用遍历<strong>迭代器</strong>
(iterator) 的方式处理<strong>可迭代对象</strong> (range, set 等):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    ...</span><br></pre></td></tr></table></figure>
<p>遍历的方式是使用 <code>iter</code> 和 <code>next</code> 函数:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="built_in">iter</span>(<span class="built_in">range</span>(<span class="number">5</span>))  <span class="comment"># 生成一个 range_iterator 对象</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">next</span>(a)</span><br></pre></td></tr></table></figure>
<pre><code>0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">5</span>))  <span class="comment"># 转换为 list</span></span><br></pre></td></tr></table></figure>
<pre><code>[0, 1, 2, 3, 4]</code></pre>
<p><code>enumerate</code> 函数适合需要同时使用索引和内容时使用:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">for</span> i, item <span class="keyword">in</span> <span class="built_in">enumerate</span>(l):  <span class="comment"># enumerate()是一个迭代器</span></span><br><span class="line">    i = ...</span><br><span class="line">    item = ...  <span class="comment"># l[i] = ...</span></span><br></pre></td></tr></table></figure>
<p>生成器:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = (i**<span class="number">2</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>))  <span class="comment"># 产生一个生成器, 可转化成 list, tuple</span></span><br><span class="line">a</span><br></pre></td></tr></table></figure>
<pre><code>&lt;generator object &lt;genexpr&gt; at 0x14da87e652b0&gt;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">next</span>(a)  <span class="comment"># 生成器也是迭代器</span></span><br></pre></td></tr></table></figure>
<pre><code>4</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]  <span class="comment"># 产生一个 list</span></span><br><span class="line">a</span><br></pre></td></tr></table></figure>
<pre><code>[0, 1, 2]</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 转化成 tuple</span></span><br><span class="line"><span class="built_in">tuple</span>(i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>))</span><br></pre></td></tr></table></figure>
<pre><code>(0, 1, 2)</code></pre>
<h3 id="函数定义"><a href="#函数定义"
class="headerlink"></a>函数定义</h3>
<ul>
<li>一般的函数定义:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">func</span>(<span class="params">a, b, *args, **kwargs</span>):</span><br><span class="line">    <span class="comment"># func1(x, y, arg1, arg2, ..., key1=val1, key2=val2, ...)</span></span><br><span class="line">    ...</span><br><span class="line">    <span class="keyword">return</span> ... <span class="comment"># 没有 return 或为空 则返回 None</span></span><br></pre></td></tr></table></figure>
<ul>
<li>单行函数 lambda</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>(<span class="params">x, y</span>):</span><br><span class="line">    <span class="keyword">return</span> x + y</span><br><span class="line">f(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<pre><code>3</code></pre>
<p>用 <code>lambda</code> 语法来定义:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">f = <span class="keyword">lambda</span> x, y: x + y</span><br><span class="line">f(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure>
<pre><code>3</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="keyword">lambda</span> x, y: x + y)(<span class="number">1</span>, <span class="number">2</span>)  <span class="comment"># 不一定需要定义函数名称</span></span><br></pre></td></tr></table></figure>
<pre><code>3</code></pre>
<h3 id="命名空间和变量作用域"><a href="#命名空间和变量作用域"
class="headerlink"></a>命名空间和变量作用域</h3>
<p><a
target="_blank" rel="noopener" href="https://sebastianraschka.com/Articles/2014_python_scope_and_namespaces.html"
class="uri">https://sebastianraschka.com/Articles/2014_python_scope_and_namespaces.html</a></p>
<p><img data-src='/advance/scope_resolution_1.png' width='400' /></p>
<ul>
<li>Built-in Functions <a
target="_blank" rel="noopener" href="https://docs.python.org/3/library/functions.html"
class="uri">https://docs.python.org/3/library/functions.html</a></li>
<li>Built-in Constants <a
target="_blank" rel="noopener" href="https://docs.python.org/3/library/constants.html"
class="uri">https://docs.python.org/3/library/constants.html</a></li>
</ul>
<p><code>globals()</code> 以 dict 形式返回当前所有全局变量,
包括导入的包名, ipython/jupyter 的 <code>In</code>, <code>Out</code>
等.<br> python 以 name -&gt; obj 的形式存储这些变量.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">globals</span>()[<span class="string">&#x27;a&#x27;</span>] <span class="keyword">is</span> a</span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">f</span>():</span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    <span class="built_in">print</span>(i, <span class="string">&#x27;local&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line">f()</span><br><span class="line"><span class="built_in">print</span>(i, <span class="string">&#x27;global&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>2 local
1 global</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">i  <span class="comment"># 值被改变了 (“leaking”)</span></span><br></pre></td></tr></table></figure>
<pre><code>3</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">i = <span class="number">1</span></span><br><span class="line">[i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">i  <span class="comment"># 用这种方式就不会发生“leaking”</span></span><br></pre></td></tr></table></figure>
<pre><code>1</code></pre>
<p>有关函数中的变量作用方式细节, 参考这里提到的例子: <a
target="_blank" rel="noopener" href="https://stackoverflow.com/a/575887">stackoverflow</a></p>
<blockquote>
<ul>
<li><p>Any time you see <font color=blue><strong>varname
=</strong></font>, you're <strong>creating a new name</strong> binding
within the function's scope.<br>Whatever value <code>varname</code> was
bound to before is lost within this scope.</p></li>
<li><p>Any time you see
<font color=blue><strong>varname.foo()</strong></font>, you're
<strong>calling a method</strong> on <code>varname</code>. The method
may alter <code>varname</code> (e.g. <code>list.append</code>). <br>
<code>varname</code> (or, rather, the object that <code>varname</code>
names) may exist in more than one scope, and since it's the same object,
<br><strong>any changes will be visible in all scopes</strong>.</p></li>
</ul>
</blockquote>
<h2 id="numpy"><a href="#numpy" class="headerlink"></a>NumPy</h2>
<h3 id="numpy-的数据类型-dtype"><a href="#numpy-的数据类型-dtype"
class="headerlink"></a>numpy 的数据类型 dtype</h3>
<p><a target="_blank" rel="noopener" href="https://www.tutorialspoint.com/numpy/numpy_data_types.htm"
class="uri">https://www.tutorialspoint.com/numpy/numpy_data_types.htm</a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dtype(np.int64) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;i8&#x27;</span>) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;&lt;i8&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dtype(np.int64) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;int&#x27;</span>) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;int64&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dtype(np.int64) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;&gt;i8&#x27;</span>)</span><br><span class="line"><span class="literal">False</span></span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dtype(np.float64) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;f8&#x27;</span>) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;&lt;f8&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>np.dtype(np.float64) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;float&#x27;</span>) <span class="keyword">is</span> np.dtype(<span class="string">&#x27;float64&#x27;</span>)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure> 见 <a
href="#fortran-二进制文件读写">Fortran 二进制文件读写</a> 中的应用.</p>
<h3 id="np.arange-参数为浮点数时要注意的细节"><a
href="#np.arange-参数为浮点数时要注意的细节"
class="headerlink"></a>np.arange 参数为浮点数时要注意的细节</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.arange(<span class="number">0.</span>, <span class="number">1.8</span>, <span class="number">0.3</span>)  <span class="comment"># 默认不包含 `stop` 这个点</span></span><br></pre></td></tr></table></figure>
<pre><code>array([0. , 0.3, 0.6, 0.9, 1.2, 1.5])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.arange(<span class="number">0.</span>, <span class="number">2.1</span>, <span class="number">0.3</span>)  <span class="comment"># 这里却包括了, 为什么?</span></span><br></pre></td></tr></table></figure>
<pre><code>array([0. , 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">&#x27;%.16f&#x27;</span> % <span class="number">2.1</span>  <span class="comment"># 因为浮点数计算方式产生的精度问题</span></span><br></pre></td></tr></table></figure>
<pre><code>&#39;2.1000000000000001&#39;</code></pre>
<p>看一个求和的例子中同样的问题 (用 <code>list</code> 和
<code>numpy.ndarray</code> 效果一样):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%.17f&#x27;</span> % <span class="number">0.1</span>)</span><br><span class="line"><span class="comment"># sum([0.1, ..., 0.1])</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%.17f&#x27;</span> % <span class="built_in">sum</span>([<span class="number">0.1</span>] * <span class="number">10</span>))</span><br><span class="line"><span class="comment"># 因为同样问题, 累积了误差</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;%.17f&#x27;</span> % math.fsum([<span class="number">0.1</span>] * <span class="number">10</span>))</span><br></pre></td></tr></table></figure>
<pre><code>0.10000000000000001
0.99999999999999989
1.00000000000000000</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">sum</span>([<span class="number">0.1</span>] * <span class="number">10</span>) == <span class="number">1</span></span><br></pre></td></tr></table></figure>
<pre><code>False</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">math.fsum([<span class="number">0.1</span>] * <span class="number">10</span>) == <span class="number">1</span></span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">math.fsum([<span class="number">0.1</span>] * <span class="number">10</span>) == <span class="number">1.0</span></span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<p>参考 <a target="_blank" rel="noopener" href="https://docs.python.org/3/tutorial/floatingpoint.html"
class="uri">https://docs.python.org/3/tutorial/floatingpoint.html</a></p>
<p>建议是: 使用整数; 对浮点数的情况, stop 值设得略小一些
(比如减去步长的一般) 以防止改点被包含, 或使用 <code>np.linspace</code>
代替.</p>
<h3 id="矩阵"><a href="#矩阵" class="headerlink"></a>矩阵</h3>
<p><code>np.matrix</code>(矩阵) 是 <code>np.ndarray</code>(数组)
的一个子类, 继承了父级的方法, 也定义了新的方法 (例如矩阵运算).</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">issubclass</span>(np.matrix, np.ndarray)</span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = np.matrix([[<span class="number">0</span>, <span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>]]); a</span><br></pre></td></tr></table></figure>
<pre><code>matrix([[0, 1, 2],
        [3, 4, 5]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = np.matrix(<span class="string">&quot;0 1 2; 3 4 5&quot;</span>); a</span><br></pre></td></tr></table></figure>
<pre><code>matrix([[0, 1, 2],
        [3, 4, 5]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(a)</span><br></pre></td></tr></table></figure>
<pre><code>numpy.matrixlib.defmatrix.matrix</code></pre>
<p><code>np.asmatrix</code> (或简写作 <code>np.mat</code>) 相当于
<code>np.matrix(data, copy=False)</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">m = np.matrix(x)</span><br><span class="line">m[<span class="number">0</span>, <span class="number">0</span>] = <span class="number">5</span></span><br><span class="line">x</span><br></pre></td></tr></table></figure>
<pre><code>array([[1, 2],
       [3, 4]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = np.array([[<span class="number">1</span>, <span class="number">2</span>], [<span class="number">3</span>, <span class="number">4</span>]])</span><br><span class="line">m = np.mat(x)</span><br><span class="line">m[<span class="number">0</span>, <span class="number">0</span>] = <span class="number">5</span></span><br><span class="line">x</span><br></pre></td></tr></table></figure>
<pre><code>array([[5, 2],
       [3, 4]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">x.__array_interface__[<span class="string">&#x27;data&#x27;</span>][<span class="number">0</span>] == m.__array_interface__[<span class="string">&#x27;data&#x27;</span>][<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<p>注意: <code>np.matrix</code> 既是一个类名也是一个函数名, 而
<code>np.mat</code>, <code>np.asmatrix</code> 只是函数名.</p>
<h3 id="数组和矩阵运算"><a href="#数组和矩阵运算"
class="headerlink"></a>数组和矩阵运算</h3>
<h4 id="数组运算"><a href="#数组运算"
class="headerlink"></a>数组运算</h4>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">12</span>).reshape(<span class="number">3</span>, -<span class="number">1</span>); a</span><br></pre></td></tr></table></figure>
<pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.<span class="built_in">max</span>()</span><br></pre></td></tr></table></figure>
<pre><code>11</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a * a  <span class="comment"># 注意这是对应位置的元素间的运算</span></span><br></pre></td></tr></table></figure>
<pre><code>array([[  0,   1,   4,   9],
       [ 16,  25,  36,  49],
       [ 64,  81, 100, 121]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a ** <span class="number">2</span>  <span class="comment"># 注意这是对应位置的元素间的运算</span></span><br></pre></td></tr></table></figure>
<pre><code>array([[  0,   1,   4,   9],
       [ 16,  25,  36,  49],
       [ 64,  81, 100, 121]])</code></pre>
<h4 id="使用数组进行矩阵运算"><a href="#使用数组进行矩阵运算"
class="headerlink"></a>使用数组进行矩阵运算</h4>
<p><code>scipy.linalg</code> 与 <code>numpy.linalg</code> 的比较: <a
target="_blank" rel="noopener" href="https://scipy.github.io/devdocs/tutorial/linalg.html"
class="uri">https://scipy.github.io/devdocs/tutorial/linalg.html</a>
&gt;* <code>scipy.linalg</code> contains <strong>all</strong> the
functions in <code>numpy.linalg</code> plus some other more
<strong>advanced</strong> ones not contained in
<code>numpy.linalg</code> * Despite its convenience, the use of the
<code>numpy.matrix</code> class is <strong>discouraged</strong>. *
<code>scipy.linalg</code> operations can be applied
<strong>equally</strong> to <code>numpy.matrix</code> or to 2D
<code>numpy.ndarray</code> objects.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = np.diagflat([<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>]); a</span><br></pre></td></tr></table></figure>
<pre><code>array([[1., 0., 0.],
       [0., 2., 0.],
       [0., 0., 3.]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = np.array([[-<span class="number">1.</span>, -<span class="number">1.</span>, -<span class="number">1.</span>],[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]]); b</span><br></pre></td></tr></table></figure>
<pre><code>array([[-1., -1., -1.],
       [ 0.,  0.,  0.]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> scipy.linalg <span class="keyword">import</span> inv</span><br><span class="line">inv(a)  <span class="comment"># 求逆</span></span><br></pre></td></tr></table></figure>
<pre><code>array([[ 1.        ,  0.        , -0.        ],
       [ 0.        ,  0.5       , -0.        ],
       [ 0.        ,  0.        ,  0.33333333]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.dot(b.T)  <span class="comment"># 矩阵内积</span></span><br></pre></td></tr></table></figure>
<pre><code>array([[-1.,  0.],
       [-2.,  0.],
       [-3.,  0.]])</code></pre>
<h4 id="直接使用矩阵类型进行运算"><a href="#直接使用矩阵类型进行运算"
class="headerlink"></a>直接使用矩阵类型进行运算</h4>
<p>使用 numpy 的矩阵类型 <code>numpy.matrix</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = np.mat(np.diagflat([<span class="number">1.</span>, <span class="number">2.</span>, <span class="number">3.</span>])); a</span><br></pre></td></tr></table></figure>
<pre><code>matrix([[1., 0., 0.],
        [0., 2., 0.],
        [0., 0., 3.]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">b = np.mat(np.array([[-<span class="number">1.</span>, -<span class="number">1.</span>, -<span class="number">1.</span>],[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>]])); b</span><br></pre></td></tr></table></figure>
<pre><code>matrix([[-1., -1., -1.],
        [ 0.,  0.,  0.]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a * b.T  <span class="comment"># 矩阵内积, 注意与数组的运算符定义不同</span></span><br></pre></td></tr></table></figure>
<pre><code>matrix([[-1.,  0.],
        [-2.,  0.],
        [-3.,  0.]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a @ b.T  <span class="comment"># 矩阵内积的新写法, python 3.5+</span></span><br></pre></td></tr></table></figure>
<pre><code>matrix([[-1.,  0.],
        [-2.,  0.],
        [-3.,  0.]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a.I  <span class="comment"># 求逆</span></span><br></pre></td></tr></table></figure>
<pre><code>matrix([[ 1.        ,  0.        , -0.        ],
        [ 0.        ,  0.5       , -0.        ],
        [ 0.        ,  0.        ,  0.33333333]])</code></pre>
<h3 id="用作坐标格点的数组的几种形式"><a
href="#用作坐标格点的数组的几种形式"
class="headerlink"></a>用作坐标格点的数组的几种形式</h3>
<ul>
<li><strong><code>np.meshgrid</code></strong></li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = np.linspace(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>); x</span><br><span class="line">array([ <span class="number">0.</span>,  <span class="number">1.</span>,  <span class="number">2.</span>])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = np.linspace(<span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>); y</span><br><span class="line">array([<span class="number">3.</span>, <span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>])</span><br><span class="line"><span class="comment"># X, Y 形状相同: N x M 矩阵, shape=(N, M)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X, Y = np.meshgrid(x, y)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X                         <span class="comment"># X[j, :] 表示同一层 y[j] 对应的不同 x 值</span></span><br><span class="line">array([[<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">2.</span>],          <span class="comment">#  0_____x</span></span><br><span class="line">       [<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">2.</span>],          <span class="comment">#  |</span></span><br><span class="line">       [<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">2.</span>],          <span class="comment">#  |y</span></span><br><span class="line">       [<span class="number">0.</span>, <span class="number">1.</span>, <span class="number">2.</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Y</span><br><span class="line">array([[<span class="number">3.</span>, <span class="number">3.</span>, <span class="number">3.</span>],          <span class="comment"># Y[:, i] 表示同一层 x[i] 对应的不同 y 值</span></span><br><span class="line">       [<span class="number">4.</span>, <span class="number">4.</span>, <span class="number">4.</span>],</span><br><span class="line">       [<span class="number">5.</span>, <span class="number">5.</span>, <span class="number">5.</span>],</span><br><span class="line">       [<span class="number">6.</span>, <span class="number">6.</span>, <span class="number">6.</span>]])</span><br></pre></td></tr></table></figure>
<p>可用来计算坐标的函数 (例如磁场的表达式等等, 见 <a
target="_blank" rel="noopener" href="https://github.com/lydiazly/python-intro/blob/master/examples/streamplot.py">examples/streamplot.py</a>
) <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">U =   (np.cos(k1 * X) * np.exp(-k1 * Y)</span><br><span class="line">     - np.cos(k2 * X) * np.exp(-k2 * Y))</span><br><span class="line">V = (- np.sin(k1 * X) * np.exp(-k1 * Y)</span><br><span class="line">     + np.sin(k2 * X) * np.exp(-k2 * Y))</span><br></pre></td></tr></table></figure></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">x = np.linspace(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line">y = np.linspace(<span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line">X, Y = np.meshgrid(x, y, indexing=<span class="string">&#x27;ij&#x27;</span>)</span><br><span class="line">Y.shape</span><br></pre></td></tr></table></figure>
<pre><code>(3, 4)</code></pre>
<ul>
<li><strong><code>np.mgrid</code></strong></li>
</ul>
<p><code>j</code> 标记默认是虚数单位,
但在这里表示前面的数字是格点数.<br> 格点数使用变量
<em><code>n</code></em> 时, 可写成:
<em><code>n</code></em><code>*1j + 1j</code>, 1不能省
(否则j定义为变量)<br> 类似的 <code>np.ogrid</code> 可参见 numpy
相关文档</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span>x = np.linspace(<span class="number">0</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>y = np.linspace(<span class="number">3</span>, <span class="number">6</span>, <span class="number">4</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 下面三行等价</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X, Y = np.mgrid[<span class="number">0</span>:<span class="number">2</span>:<span class="number">3j</span>, <span class="number">3</span>:<span class="number">6</span>:<span class="number">4j</span>]</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X, Y = np.array([i.astype(np.float64) <span class="keyword">for</span> i <span class="keyword">in</span> np.mgrid[<span class="number">0</span>:<span class="number">3</span>, <span class="number">3</span>:<span class="number">7</span>]])</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X, Y = np.array(np.meshgrid(x, y, indexing=<span class="string">&#x27;ij&#x27;</span>))</span><br><span class="line"><span class="comment"># np.mgrid[0:2:3j, 3:6:4j] 得到的数据类型为 &#x27;float64&#x27;</span></span><br><span class="line"><span class="comment"># np.mgrid[0:3, 3:6] 得到的数据类型为 &#x27;int64&#x27;</span></span><br><span class="line"><span class="comment"># np.meshgrid(x, y, indexing=&#x27;ij&#x27;) 得到一个 list, 数据格式同x, y</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># X, Y 形状相同: M x N 矩阵, shape=(M, N)</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>X                      <span class="comment"># X[i, :] 表示 x[i]</span></span><br><span class="line">array([[<span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>, <span class="number">0.</span>],   <span class="comment">#  0_____y</span></span><br><span class="line">       [<span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>, <span class="number">1.</span>],   <span class="comment">#  |</span></span><br><span class="line">       [<span class="number">2.</span>, <span class="number">2.</span>, <span class="number">2.</span>, <span class="number">2.</span>]])  <span class="comment">#  |x</span></span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>Y                      <span class="comment"># Y[:, j] 表示 y[j]</span></span><br><span class="line">array([[<span class="number">3.</span>, <span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>],</span><br><span class="line">       [<span class="number">3.</span>, <span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>],</span><br><span class="line">       [<span class="number">3.</span>, <span class="number">4.</span>, <span class="number">5.</span>, <span class="number">6.</span>]])</span><br></pre></td></tr></table></figure>
<h3 id="mask"><a href="#mask" class="headerlink"></a>mask</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a = np.arange(<span class="number">9</span>).reshape(<span class="number">3</span>, -<span class="number">1</span>); a</span><br></pre></td></tr></table></figure>
<pre><code>array([[0, 1, 2],
       [3, 4, 5],
       [6, 7, 8]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a &gt; <span class="number">4</span>  <span class="comment"># mask</span></span><br></pre></td></tr></table></figure>
<pre><code>array([[False, False, False],
       [False, False,  True],
       [ True,  True,  True]])</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">np.where(a &gt; <span class="number">4</span>)  <span class="comment"># 得到 tuple(col_indexs, row_indexs)</span></span><br></pre></td></tr></table></figure>
<pre><code>(array([1, 2, 2, 2]), array([2, 0, 1, 2]))</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span>(<span class="built_in">zip</span>(*np.where(a &gt; <span class="number">4</span>)))  <span class="comment"># 也可以用 np.array(np.where(a &gt; 4)).T</span></span><br></pre></td></tr></table></figure>
<pre><code>[(1, 2), (2, 0), (2, 1), (2, 2)]</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">a[a &gt; <span class="number">4</span>] = -<span class="number">1</span>; a  <span class="comment"># same as a[np.where(a &gt; 4)]</span></span><br></pre></td></tr></table></figure>
<pre><code>array([[ 0,  1,  2],
       [ 3,  4, -1],
       [-1, -1, -1]])</code></pre>
<h3 id="其他对数组元素的处理"><a href="#其他对数组元素的处理"
class="headerlink"></a>其他对数组元素的处理</h3>
<p>处理含有 NaN 的数据:</p>
<p>e.g. 求最值可使用 <code>np.nanmin(...)</code> 和
<code>np.nanmax(...)</code></p>
<h2 id="matplotlib"><a href="#matplotlib"
class="headerlink"></a>Matplotlib</h2>
<ul>
<li>官方教程 <a
target="_blank" rel="noopener" href="https://matplotlib.org/tutorials/introductory/usage.html"
class="uri">https://matplotlib.org/tutorials/introductory/usage.html</a></li>
</ul>
<p><img data-src='/advance/anatomy.png' width='600' /></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fig = plt.gcf() <span class="comment"># current figure</span></span><br><span class="line">ax = plt.gca()  <span class="comment"># current `Axes`</span></span><br><span class="line">im = plt.gci()  <span class="comment"># current artist(图像内容), 可由诸如 plt.imshow(...) 得到</span></span><br></pre></td></tr></table></figure>
<ul>
<li><p>得到当前 backend: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>plt.get_backend()</span><br></pre></td></tr></table></figure> 或 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> maplotlib <span class="keyword">as</span> mpl</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>mpl.get_backend()</span><br></pre></td></tr></table></figure></p></li>
<li><p>选择 backend (在导入其他 matplotlib 模块之前):
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&gt;&gt;&gt; </span><span class="keyword">import</span> matplotlib</span><br><span class="line"><span class="meta">&gt;&gt;&gt; </span>matplotlib.use(<span class="string">&#x27;TkAgg&#x27;</span>)  <span class="comment"># &#x27;Qt5Agg&#x27;, &#x27;TkAgg&#x27;, &#x27;Agg&#x27;, ...</span></span><br></pre></td></tr></table></figure></p></li>
<li><p>用户配置文档 <code>matplotlibrc</code><br> 通常的位置:
<code>~/.config/matplotlib/matplotlibrc</code> (Linux)</p></li>
<li><p>用 <code>zorder</code> 来控制图层:</p></li>
</ul>
<p>这个例子中也展示了加入一个动态的竖线的方法,
这条线在保存后的图像中不会显示.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib</span><br><span class="line">%run -e <span class="string">&#x27;examples/test_plot.py&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>使用 <a
target="_blank" rel="noopener" href="https://github.com/joferkington/mpldatacursor">这个工具</a>
动态标注光标位置的值:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib</span><br><span class="line">%run -e <span class="string">&#x27;examples/test_imshow.py&#x27;</span></span><br></pre></td></tr></table></figure>
<ul>
<li>点击图像后在命令行显示光标处信息的例子</li>
</ul>
<p>命令行脚本: <a
target="_blank" rel="noopener" href="https://github.com/lydiazly/python-intro/blob/master/examples/test_imshow_click.py">examples/test_imshow_click.py</a>
(jupyter 中无法使用)</p>
<ul>
<li>布局问题 <a
target="_blank" rel="noopener" href="https://matplotlib.org/tutorials/intermediate/constrainedlayout_guide.html"
class="uri">https://matplotlib.org/tutorials/intermediate/constrainedlayout_guide.html</a></li>
<li>绘制平行投影的3D图 <a
target="_blank" rel="noopener" href="https://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html"
class="uri">https://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html</a></li>
<li>更复杂的 3D 可转存可视化数据用其他软件或使用 Mayavi
(http://docs.enthought.com/mayavi/mayavi)</li>
</ul>
<h2 id="sunpy-示例"><a href="#sunpy-示例" class="headerlink"></a>SunPy
示例</h2>
<h3 id="示例文件"><a href="#示例文件"
class="headerlink"></a>示例文件</h3>
<ul>
<li><p>读取 fits, submap, 作图 <a
href="/example_plothmi.html">example_plothmi</a></p></li>
<li><p>投影 <a
href="/example_projection.html">example_projection</a></p></li>
<li><p>下载数据 <a href="/fido.html">fido</a>, <a
href="/jsoc.html">jsoc</a></p></li>
</ul>
<p>注意: 这些例子只是提供一个使用参考, 不一定是最优的.</p>
<h3 id="示例中的-fits-读取方法"><a href="#示例中的-fits-读取方法"
class="headerlink"></a>示例中的 fits 读取方法</h3>
<p>更多 FITS 的读取方法参见 <a href="/main.html#fits-文件读取">Python
简易教程#FITS-文件读取</a><br> 另见 <a
target="_blank" rel="noopener" href="http://docs.astropy.org/en/stable/io/fits/usage/scripts.html">Astropy
的命令行工具</a></p>
<p>读取<code>HMIMap</code> 的例子:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 导入 `sunpy.map` 的时间会略有点长</span></span><br><span class="line"><span class="keyword">import</span> sunpy.<span class="built_in">map</span></span><br><span class="line">smap = sunpy.<span class="built_in">map</span>.Map(<span class="string">&#x27;data/hmi.B_720s.20150827_052400_TAI.field.fits&#x27;</span>)</span><br><span class="line"><span class="built_in">type</span>(smap)</span><br></pre></td></tr></table></figure>
<pre><code>sunpy.map.sources.sdo.HMIMap</code></pre>
<p>这是 <code>GenericMap</code> 的一个子类:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">issubclass</span>(sunpy.<span class="built_in">map</span>.sources.sdo.HMIMap, sunpy.<span class="built_in">map</span>.mapbase.GenericMap)</span><br><span class="line"><span class="literal">True</span></span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.meta  <span class="comment"># headers</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(smap.data)  <span class="comment"># 索引从 0 开始</span></span><br></pre></td></tr></table></figure>
<pre><code>numpy.ndarray</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.data.shape  <span class="comment"># (dimy, dimx)</span></span><br></pre></td></tr></table></figure>
<pre><code>(4096, 4096)</code></pre>
<p><code>smap.data[i, j]</code> 中的 i 为 Y 轴, 单位为 pixel:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> matplotlib.pyplot <span class="keyword">as</span> plt</span><br><span class="line">plt.imshow(smap.data[<span class="number">0</span>:<span class="number">2000</span>, :], origin=<span class="string">&#x27;lower&#x27;</span>);</span><br><span class="line">plt.show()</span><br></pre></td></tr></table></figure>
<figure>
<img data-src="/advance/advance_205_0.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<h3 id="关于-scaled-image-data"><a href="#关于-scaled-image-data"
class="headerlink"></a>关于 Scaled Image Data</h3>
<p>这一部分将更仔细地检查 Astropy 对示例中的 FITS 文件的处理.</p>
<p>参见 <a
target="_blank" rel="noopener" href="http://docs.astropy.org/en/stable/io/fits/usage/image.html#scaled-data"
class="uri">http://docs.astropy.org/en/stable/io/fits/usage/image.html#scaled-data</a></p>
<blockquote>
<p>Images are scaled only when either of the BSCALE/BZERO keywords are
present in the header and either of their values is not the default
value (BSCALE=1, BZERO=0).</p>
</blockquote>
<p>由于 <code>astropy.io.fits</code> 的特性, 读取 'Scaled Image Data'
时, 调用 <code>.data</code> 将自动对数据进行缩放: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">physical value = BSCALE * (storage value) + BZERO</span><br></pre></td></tr></table></figure>
<code>astropy.io.fits.open</code> 中使用
<code>do_not_scale_image_data=True</code> 可禁用这一步骤.</p>
<p>见 <a
target="_blank" rel="noopener" href="http://docs.astropy.org/en/stable/io/fits/appendix/faq.html#why-is-an-image-containing-integer-data-being-converted-unexpectedly-to-floats">astropy.io.fits
FAQ</a></p>
<p>数据类型:</p>
<table>
<thead>
<tr>
<th style="text-align: center;">BITPIX</th>
<th style="text-align: left;">Numpy Data Type</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: center;">8</td>
<td style="text-align: left;">numpy.uint8 (unsigned integer)</td>
</tr>
<tr>
<td style="text-align: center;">16</td>
<td style="text-align: left;">numpy.int16</td>
</tr>
<tr>
<td style="text-align: center;">32</td>
<td style="text-align: left;">numpy.int32</td>
</tr>
<tr>
<td style="text-align: center;">-32</td>
<td style="text-align: left;">numpy.float32</td>
</tr>
<tr>
<td style="text-align: center;">-64</td>
<td style="text-align: left;">numpy.float64</td>
</tr>
</tbody>
</table>
<p>可以使用 Astropy 的命令行工具在 shell 中查看信息:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">fname = <span class="string">&#x27;data/hmi.B_720s.20150827_052400_TAI.field.fits&#x27;</span></span><br><span class="line">!fitsinfo &#123;fname&#125;</span><br></pre></td></tr></table></figure>
<pre><code>Filename: data/hmi.B_720s.20150827_052400_TAI.field.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU       6   ()      
  1                1 CompImageHDU    155   (4096, 4096)   int32   </code></pre>
<p>可以看到该文件存储的数据类型是整形.</p>
<p>用命令行工具查看关键字 'BITPIX':</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!fitsheader -e <span class="number">1</span> --keyword BITPIX &#123;fname&#125;</span><br></pre></td></tr></table></figure>
<pre><code># HDU 1 in data/hmi.B_720s.20150827_052400_TAI.field.fits:
BITPIX  =                   32 / data type of original image                    </code></pre>
<p>使用 <code>astropy.io.fits</code>:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> astropy.io <span class="keyword">import</span> fits</span><br><span class="line">hdulist = fits.<span class="built_in">open</span>(fname)</span><br><span class="line">hdu = hdulist[<span class="number">1</span>]</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.header[<span class="string">&#x27;BITPIX&#x27;</span>]</span><br></pre></td></tr></table></figure>
<pre><code>32</code></pre>
<p>'BSCALE' 不为零则为 'scaled':</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.header[<span class="string">&#x27;BSCALE&#x27;</span>]</span><br></pre></td></tr></table></figure>
<pre><code>0.01</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.header[<span class="string">&#x27;BZERO&#x27;</span>]</span><br></pre></td></tr></table></figure>
<pre><code>0.0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdulist.verify(<span class="string">&#x27;silentfix+warn&#x27;</span>)  <span class="comment"># 调用 `.data` 时如果出错, 需要先进行这一步修复</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.data.dtype  <span class="comment"># 已自动变换为 &#x27;physical value&#x27;, 同时 `.header` 将被修改</span></span><br></pre></td></tr></table></figure>
<pre><code>dtype(&#39;float64&#39;)</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.data[<span class="number">1000</span>, <span class="number">1000</span>]</span><br></pre></td></tr></table></figure>
<pre><code>142.83</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.data[<span class="number">0</span>,<span class="number">0</span>]  <span class="comment"># -2147483648 被转为 nan</span></span><br></pre></td></tr></table></figure>
<pre><code>nan</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.header[<span class="string">&#x27;BITPIX&#x27;</span>]  <span class="comment"># 值被改变了. 同时 &#x27;BSCALE&#x27;, &#x27;BZERO&#x27; 被删除</span></span><br></pre></td></tr></table></figure>
<pre><code>-64</code></pre>
<p>手动 scale:</p>
<p>'BSCALE' 虽然之前已被删除, 但值仍存储在 <code>._orig_bscale</code>
中. <code>.scale</code> 将使用这个值.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.scale(<span class="string">&#x27;int32&#x27;</span>)  <span class="comment"># 在此之后 `.data` 将变换回 &#x27;storage value&#x27;</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu._orig_bscale</span><br></pre></td></tr></table></figure>
<pre><code>0.01</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu._orig_bzero</span><br></pre></td></tr></table></figure>
<pre><code>0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.data[<span class="number">1000</span>, <span class="number">1000</span>]</span><br></pre></td></tr></table></figure>
<pre><code>14283</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.data[<span class="number">0</span>, <span class="number">0</span>]  <span class="comment"># nan 被转为 -2147483648</span></span><br></pre></td></tr></table></figure>
<pre><code>-2147483648</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">hdu.header[<span class="string">&#x27;BITPIX&#x27;</span>]  <span class="comment"># 值再次被改变了</span></span><br></pre></td></tr></table></figure>
<pre><code>32</code></pre>
<p>使用 SunPy 处理时, 'BITPIX', 'BSCALE', 'BZERO' 的值被保留,
<code>.data</code> 仍进行了 scale 的过程.</p>
<p>针对不同文件, 如果 SunPy 的程序内部使用 <code>astropy.io.fits</code>
处理文件时调用了 <code>.data</code> 再返回 header, 即
<code>astropy.io.fits</code> 已经如上所述改变了 header, 那么 SunPy
所返回的 header 中 'BITPIX', 'BSCALE', 'BZERO' 可能已经被改变.</p>
<p>下面的例子中得到的 header 是最初的值:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sunpy.<span class="built_in">map</span></span><br><span class="line">smap = sunpy.<span class="built_in">map</span>.Map(<span class="string">&#x27;data/hmi.B_720s.20150827_052400_TAI.field.fits&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.meta[<span class="string">&#x27;BITPIX&#x27;</span>]  <span class="comment"># 得到的是未被改变的 header</span></span><br></pre></td></tr></table></figure>
<pre><code>32</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.meta[<span class="string">&#x27;BSCALE&#x27;</span>]</span><br></pre></td></tr></table></figure>
<pre><code>0.01</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.meta[<span class="string">&#x27;BZERO&#x27;</span>]</span><br></pre></td></tr></table></figure>
<pre><code>0.0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.data[<span class="number">1000</span>, <span class="number">1000</span>]  <span class="comment"># 这一步并不改变 `.meta` 的值</span></span><br></pre></td></tr></table></figure>
<pre><code>142.83</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.meta[<span class="string">&#x27;BITPIX&#x27;</span>]  <span class="comment"># 不变</span></span><br></pre></td></tr></table></figure>
<pre><code>32</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.meta[<span class="string">&#x27;BSCALE&#x27;</span>]  <span class="comment"># 不变</span></span><br></pre></td></tr></table></figure>
<pre><code>0.01</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.meta[<span class="string">&#x27;BZERO&#x27;</span>]  <span class="comment"># 不变</span></span><br></pre></td></tr></table></figure>
<pre><code>0.0</code></pre>
<h3 id="坐标和单位"><a href="#坐标和单位"
class="headerlink"></a>坐标和单位</h3>
<p><strong>SunPy map</strong> <a
target="_blank" rel="noopener" href="http://docs.sunpy.org/en/stable/code_ref/map.html#using-map-objects"
class="uri">http://docs.sunpy.org/en/stable/code_ref/map.html#using-map-objects</a>
&gt;A number of the <strong>properties</strong> of this class are
returned as <strong>two-value named tuples</strong> that can either be -
indexed by
position: <strong><font color=blue>[0]</font>, <font color=blue>[1]</font></strong>
- be accessed by the names: - pixel
axes: <strong><font color=blue>.x</font>, <font color=blue>.y</font></strong><br>
x and y refer to the FITS axes (x for columns y for rows) - spatial
axes: <strong><font color=blue>.axis1</font>, <font color=blue>.axis2</font></strong><br>
axis1 corresponds to the coordinate axis for x and axis2 corresponds to
y.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.dimensions</span><br></pre></td></tr></table></figure>
<pre><code>PixelPair(x=&lt;Quantity 4096. pix&gt;, y=&lt;Quantity 4096. pix&gt;)</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.dimensions.x  <span class="comment"># 得到一个 `astropy.units.quantity.Quantity`, 包含 value 和 unit</span></span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(4096 \; \mathrm{pix}\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.dimensions.x.unit</span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(\mathrm{pix}\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.dimensions.x.value</span><br></pre></td></tr></table></figure>
<pre><code>4096.0</code></pre>
<p><code>astropy.units</code> 的使用方法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> astropy.units <span class="keyword">as</span> u</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">u.AA</span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(\mathrm{\mathring{A}}\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="number">4096</span> * u.pix  <span class="comment"># same as `u.pixel`</span></span><br></pre></td></tr></table></figure>
<p><span class="math inline">\(4096 \; \mathrm{pix}\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(<span class="number">4096</span>, <span class="number">4096</span>) * u.pix  <span class="comment"># 注意这里是 `astropy.units` 的运算, 和 list 运算规则不同</span></span><br></pre></td></tr></table></figure>
<p><span class="math inline">\([4096,~4096] \; \mathrm{pix}\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.dimensions.x.unit <span class="keyword">is</span> u.pix  <span class="comment"># 说明 x 是单位是 u.pix</span></span><br></pre></td></tr></table></figure>
<pre><code>True</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">type</span>(smap.center)</span><br></pre></td></tr></table></figure>
<pre><code>/home/lydia/miniconda3/lib/python3.6/site-packages/sunpy/map/mapbase.py:669: Warning: Missing metadata for heliographic longitude: assuming longitude of 0 degrees
  lon=self.heliographic_longitude,





astropy.coordinates.sky_coordinate.SkyCoord</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">list</span>((<span class="number">0</span>, <span class="number">0</span>) * u.pix)</span><br></pre></td></tr></table></figure>
<pre><code>[&lt;Quantity 0. pix&gt;, &lt;Quantity 0. pix&gt;]</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.pixel_to_world(*(<span class="number">4096</span>, <span class="number">4096</span>) * u.pix)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;SkyCoord (Helioprojective: obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;): (Tx, Ty) in arcsec
    (-1040.36199634, -1030.86554911)&gt;</code></pre>
<p>查看 <code>SkyCoord</code> 的帮助:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> astropy.coordinates</span><br><span class="line"><span class="built_in">help</span>(astropy.coordinates.sky_coordinate.SkyCoord)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.center.Tx</span><br></pre></td></tr></table></figure>
<p><span
class="math inline">\(\mathrm{-7.65399^{\prime\prime}}\)</span></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.pixel_to_world(*(<span class="number">2000</span>, <span class="number">2000</span>) * u.pix)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;SkyCoord (Helioprojective: obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;): (Tx, Ty) in arcsec
    (16.55031204, 26.53575639)&gt;</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.pixel_to_world(*(<span class="number">2000</span>, <span class="number">2000</span>) * u.pix).transform_to(<span class="string">&#x27;heliographic_stonyhurst&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&lt;SkyCoord (HeliographicStonyhurst: obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, km)
    (1.00568591, 8.68202918, 696000.0000022)&gt;</code></pre>
<p>查看坐标信息:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">smap.coordinate_frame</span><br></pre></td></tr></table></figure>
<pre><code>/home/lydia/miniconda3/lib/python3.6/site-packages/sunpy/map/mapbase.py:669: Warning: Missing metadata for heliographic longitude: assuming longitude of 0 degrees
  lon=self.heliographic_longitude,





&lt;Helioprojective Frame (obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;)&gt;</code></pre>
<p>出现这个 Warning 时:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">smap.meta[<span class="string">&#x27;hgln_obs&#x27;</span>] = <span class="number">0.</span>; smap.meta[<span class="string">&#x27;hgln_obs&#x27;</span>] = <span class="number">0.</span>; smap.meta[<span class="string">&#x27;hgln_obs&#x27;</span>] = <span class="number">0.</span></span><br><span class="line">smap.coordinate_frame</span><br></pre></td></tr></table></figure>
<pre><code>&lt;Helioprojective Frame (obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;)&gt;</code></pre>
<h3 id="语法对比"><a href="#语法对比"
class="headerlink"></a>语法对比</h3>
<p>比较 <code>plothmi.py</code> 与对应 IDL 程序的语法:</p>
<p>下面的语句中, 为了简便和方便对比, 使用了自定义的一些函数. 导入方法:
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> usr_sunpy <span class="keyword">import</span> read_sdo, plot_map, plot_vmap, image_to_helio</span><br></pre></td></tr></table></figure></p>
<p>读取数据 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; IDL</span><br><span class="line">read_sdo,&lt;fname&gt;,index,data</span><br><span class="line">index2map,index,data,mapa</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="comment"># 为简化过程而自定义的函数, 读入时打印文件名和数组大小</span></span><br><span class="line">mapa = read_sdo(&lt;fname&gt;)</span><br></pre></td></tr></table></figure></p>
<p>旋转 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">; IDL</span><br><span class="line">; 2 表示180°</span><br><span class="line">mapbx.data = rotate(mapbx,2)</span><br><span class="line">mapby.data = rotate(mapbx,2)</span><br><span class="line">mapbz.data = rotate(mapbx,2)</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="comment"># 利用 &#x27;crota2&#x27; 的值确定角度</span></span><br><span class="line">mapbx = mapbx.rotate(order=<span class="number">1</span>)</span><br><span class="line">mapby = mapby.rotate(order=<span class="number">1</span>)</span><br><span class="line">mapbz = mapbz.rotate(order=<span class="number">1</span>)</span><br></pre></td></tr></table></figure></p>
<p>截取 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">; IDL</span><br><span class="line">sub_map,mapbx,smapbx,xrange=[500,800.0],yrange=[-500,-100.0]</span><br><span class="line">sub_map,mapby,smapby,ref_map=smapbx</span><br><span class="line">sub_map,mapbz,smapbz,ref_map=smapbx</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="comment"># 左下到右上</span></span><br><span class="line">bl = SkyCoord(<span class="number">500</span>*u.arcsec, -<span class="number">500</span>*u.arcsec, frame=mapbz.coordinate_frame)</span><br><span class="line">tr = SkyCoord(<span class="number">800</span>*u.arcsec, -<span class="number">100.</span>*u.arcsec, frame=mapbz.coordinate_frame)</span><br><span class="line">smapbx = mapbx.submap(bl, tr)</span><br><span class="line">smapby = mapby.submap(bl, tr)</span><br><span class="line">smapbz = mapbz.submap(bl, tr)</span><br></pre></td></tr></table></figure></p>
<p>绘图 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">; IDL</span><br><span class="line">plot_map,smapbz,dmax=2000,dmin=-2000,color=0,charsize=1.8,...</span><br><span class="line">plot_vmap,/over,smapbx,smapby,mapbz=smapbz,limit=180,scale=0.012,iskip=15,jskip=15,...</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="comment"># 主要调用的是 matplotlib</span></span><br><span class="line">fig = plt.figure()</span><br><span class="line">ax = fig.add_subplot(<span class="number">111</span>, projection=smapbz) <span class="comment"># 使用 smapbz 中定义的坐标系统</span></span><br><span class="line">plot_map(ax, smapbz)</span><br><span class="line">plot_vmap(ax, smapbx, smapby, smapbz, iskip=iskip, jskip=jskip, cmin=<span class="number">100.</span>, vmax=<span class="number">500.</span>, cmap=<span class="string">&#x27;binary&#x27;</span>, ...)</span><br></pre></td></tr></table></figure></p>
<p>坐标变换 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">; IDL</span><br><span class="line">; magnetic_modeling_codes/.../05projection_modified_version.pro</span><br></pre></td></tr></table></figure> <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Python</span></span><br><span class="line"><span class="comment"># `image_to_helio`(变换为 Helioprojective(Cartesian) system)</span></span><br><span class="line"><span class="comment"># 调用自定义的旋转矩阵函数 `proj_matrix`, 参考文献与原IDL程序相同</span></span><br><span class="line">hx, hy = image_to_helio(smapbz)  <span class="comment"># numpy 数组</span></span><br><span class="line">smapbx_h, smapby_h, smapbz_h = image_to_helio(smapbx, smapby, smapbz) <span class="comment"># sunpy `Map`</span></span><br><span class="line"></span><br><span class="line">plot_map(ax, smapbz_h, coords=(hx, hy))</span><br><span class="line">plot_vmap(ax, smapbx_h, smapby_h, smapbz_h, coords=(hx, hy), ...)</span><br></pre></td></tr></table></figure></p>
<h2 id="插值-拟合"><a href="#插值-拟合" class="headerlink"></a>插值,
拟合</h2>
<p>选择不限于这里列举的包, 以后也可能会有更合适的方法出现.</p>
<p>相关安装见 <a href="/installpy.html#其他">Python 安装和配置</a></p>
<h3 id="插值"><a href="#插值" class="headerlink"></a>插值</h3>
<ul>
<li><p>numpy <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">f = interp1d(x, y, kind=&#x27;cubic&#x27;[, fill_value=&#x27;extrapolate&#x27;])</span><br><span class="line">x2 = np.linspace(...)</span><br><span class="line">y2 = f(x2)</span><br></pre></td></tr></table></figure> 见 <a
target="_blank" rel="noopener" href="https://github.com/lydiazly/python-intro/blob/master/examples/test_plot.py">examples/test_plot.py</a></p></li>
<li><p>scipy <a
target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy/tutorial/interpolate.html"
class="uri">https://docs.scipy.org/doc/scipy/tutorial/interpolate.html</a></p></li>
</ul>
<h3 id="求极值"><a href="#求极值" class="headerlink"></a>求极值</h3>
<ul>
<li>PeakUtils <a target="_blank" rel="noopener" href="http://peakutils.readthedocs.io/en/latest/"
class="uri">http://peakutils.readthedocs.io/en/latest/</a></li>
</ul>
<p>官方例图
(http://peakutils.readthedocs.io/en/latest/tutorial_a.html):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> peakutils</span><br><span class="line">indexes = peakutils.indexes(y, thres=<span class="number">0.5</span>, min_dist=<span class="number">30</span>)</span><br></pre></td></tr></table></figure>
<p><img data-src='/advance/tut_a_2.png' width='500' /></p>
<p>Enhancing the resolution by interpolation: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">peaks_x = peakutils.interpolate(x, y, ind=indexes)</span><br></pre></td></tr></table></figure></p>
<h3 id="拟合"><a href="#拟合" class="headerlink"></a>拟合</h3>
<ul>
<li>LMFIT (Non-Linear Least-Squares Minimization and Curve-Fitting)</li>
</ul>
<p>下载 <a target="_blank" rel="noopener" href="https://github.com/lmfit/lmfit-py"
class="uri">https://github.com/lmfit/lmfit-py</a></p>
<p>文档 <a target="_blank" rel="noopener" href="http://lmfit.github.io/lmfit-py/"
class="uri">http://lmfit.github.io/lmfit-py/</a></p>
<p>有现成模型, 也可以自定义模型.<br>
可以方便地叠加不同拟合模型(比如多个高斯, 线性加高斯, 等等).<br> 例子见
<a
target="_blank" rel="noopener" href="https://github.com/lydiazly/python-intro/raw/master/examples/lmfits.zip">examples/lmfits</a>
(来自 <a
target="_blank" rel="noopener" href="http://lmfit.github.io/lmfit-py/builtin_models.html#example-1-fit-peak-data-to-gaussian-lorentzian-and-voigt-profiles">LMFIT网站示例</a>
)</p>
<p>使用内置模型:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lmfit.models <span class="keyword">import</span> GaussianModel  <span class="comment"># 内置的模型</span></span><br><span class="line"></span><br><span class="line">data = np.loadtxt(<span class="string">&#x27;test_peak.dat&#x27;</span>)</span><br><span class="line">x = data[:, <span class="number">0</span>]</span><br><span class="line">y = data[:, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">mod = GaussianModel()  <span class="comment"># 实例化一个模型</span></span><br><span class="line">pars = mod.guess(y, x=x)  <span class="comment"># 给初值</span></span><br><span class="line">out = mod.fit(y, pars, x=x)  <span class="comment"># 拟合结果</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(out.fit_report())  <span class="comment"># 拟合结果的详细信息</span></span><br><span class="line">plt.plot(x, out.init_fit, <span class="string">&#x27;k--&#x27;</span>)</span><br><span class="line">plt.plot(x, out.best_fit, <span class="string">&#x27;r-&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">%matplotlib inline</span><br><span class="line">%run examples/lmfits/fit_peak.py</span><br></pre></td></tr></table></figure>
<pre><code>[[Model]]
    Model(voigt)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 21
    # data points      = 401
    # variables        = 4
    chi-square         = 10.9301767
    reduced chi-square = 0.02753193
    Akaike info crit   = -1436.57602
    Bayesian info crit = -1420.60017
[[Variables]]
    sigma:      0.89518909 +/- 0.01415450 (1.58%) (init = 0.8775)
    center:     9.24374847 +/- 0.00441903 (0.05%) (init = 9.25)
    amplitude:  34.1914737 +/- 0.17946860 (0.52%) (init = 65.43358)
    gamma:      0.52540198 +/- 0.01857955 (3.54%) (init = 0.7)
    fwhm:       3.22385343 +/- 0.05097475 (1.58%) == &#39;3.6013100*sigma&#39;
    height:     10.0872204 +/- 0.03482130 (0.35%) == &#39;amplitude*wofz((1j*gamma)/(sigma*sqrt(2))).real/(sigma*sqrt(2*pi))&#39;
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(sigma, gamma)     = -0.928
    C(amplitude, gamma) =  0.821
    C(sigma, amplitude) = -0.651</code></pre>
<figure>
<img data-src="/advance/advance_279_1.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<p>多个模型叠加:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> lmfit.models <span class="keyword">import</span> ExponentialModel, GaussianModel</span><br><span class="line"></span><br><span class="line">data = np.loadtxt(<span class="string">&#x27;NIST_Gauss2.dat&#x27;</span>)</span><br><span class="line">x = data[:, <span class="number">0</span>]</span><br><span class="line">y = data[:, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">exp_mod = ExponentialModel(prefix=<span class="string">&#x27;exp_&#x27;</span>)</span><br><span class="line">gauss1 = GaussianModel(prefix=<span class="string">&#x27;g1_&#x27;</span>)</span><br><span class="line">gauss2 = GaussianModel(prefix=<span class="string">&#x27;g2_&#x27;</span>)</span><br><span class="line"></span><br><span class="line">pars1 = exp_mod.guess(y, x=x)  <span class="comment"># 分段设参数的方法见下面的脚本文件</span></span><br><span class="line">pars2 = gauss1.guess(y, x=x)</span><br><span class="line">pars3 = gauss2.guess(y, x=x)</span><br><span class="line"></span><br><span class="line">pars = pars1 + pars2 + pars3  <span class="comment"># 叠加参数</span></span><br><span class="line">mod = gauss1 + gauss2 + exp_mod  <span class="comment"># 叠加模型</span></span><br><span class="line"></span><br><span class="line">out = mod.fit(y, pars, x=x)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(out.fit_report())</span><br><span class="line">plt.plot(x, y, <span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">plt.plot(x, out.init_fit, <span class="string">&#x27;k--&#x27;</span>)</span><br><span class="line">plt.plot(x, out.best_fit, <span class="string">&#x27;r-&#x27;</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%capture output</span><br><span class="line">%matplotlib inline</span><br><span class="line">%run examples/lmfits/fit_peaks.py</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output.outputs[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<figure>
<img data-src="/advance/advance_283_0.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">%%capture output</span><br><span class="line">%matplotlib inline</span><br><span class="line">%run examples/lmfits/fit_peaks_components.py</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">output.outputs[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<figure>
<img data-src="/advance/advance_285_0.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<p>自定义模型的方法见 <a
target="_blank" rel="noopener" href="http://lmfit.github.io/lmfit-py/builtin_models.html#user-defined-models">LMFIT网站示例</a></p>
<h3 id="其他"><a href="#其他" class="headerlink"></a>其他</h3>
<ul>
<li>Sherpa(Modeling and Fitting) <a
target="_blank" rel="noopener" href="http://cxc.cfa.harvard.edu/contrib/sherpa/"
class="uri">http://cxc.cfa.harvard.edu/contrib/sherpa/</a><br></li>
<li>2-D Fitting in Sherpa <a
target="_blank" rel="noopener" href="https://python4astronomers.github.io/fitting/image.html"
class="uri">https://python4astronomers.github.io/fitting/image.html</a><br></li>
<li><em>etc.</em></li>
</ul>
<h2 id="copy-注意事项"><a href="#copy-注意事项"
class="headerlink"></a>copy 注意事项</h2>
<p><strong>"shallow copy"</strong> vs <strong>"deep copy"</strong></p>
<ul>
<li>对于 list 的情况</li>
</ul>
<p>演示插件 <a target="_blank" rel="noopener" href="https://github.com/lgpage/nbtutor"
class="uri">https://github.com/lgpage/nbtutor</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%%nbtutor -r -f -i</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line">a = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line">b = a</span><br><span class="line">c = deepcopy(a)</span><br><span class="line">d = a[:] <span class="comment"># 列表的切片是深拷贝</span></span><br><span class="line">b[<span class="number">0</span>] = -<span class="number">1</span></span><br><span class="line">c[<span class="number">1</span>] = -<span class="number">2</span></span><br><span class="line">d[<span class="number">2</span>] = -<span class="number">3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(a), <span class="built_in">id</span>(b), <span class="built_in">id</span>(c), <span class="built_in">id</span>(d))</span><br></pre></td></tr></table></figure>
<pre><code>23284866388232 23284866388232 23284855519880 23284856061064</code></pre>
<p><a target="_blank" rel="noopener" href="http://t.cn/RgK1OHf">网页版演示</a></p>
<p><img data-src='/advance/nbtutor3.png' width='550'/></p>
<ul>
<li>对于 dict 的情况</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%%nbtutor -r -f -i</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line">a = &#123;<span class="number">1</span>:<span class="number">1</span>, <span class="number">2</span>:<span class="number">2</span>, <span class="number">3</span>:<span class="number">3</span>&#125;</span><br><span class="line">b = a</span><br><span class="line">c = a.copy()  <span class="comment"># 深拷贝</span></span><br><span class="line">d = deepcopy(a)</span><br><span class="line">b[<span class="number">1</span>] = -<span class="number">1</span></span><br><span class="line">c[<span class="number">2</span>] = -<span class="number">2</span></span><br><span class="line">d[<span class="number">3</span>] = -<span class="number">3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(a), <span class="built_in">id</span>(b), <span class="built_in">id</span>(c), <span class="built_in">id</span>(d))</span><br></pre></td></tr></table></figure>
<pre><code>22492371132064 22492371132064 22492397510376 22492397507280</code></pre>
<p><a target="_blank" rel="noopener" href="http://t.cn/RgKrHOx">网页版演示</a></p>
<p><img data-src='/advance/nbtutor4.png' width='550'/></p>
<ul>
<li>对于 set 的情况</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%%nbtutor -r -f -i</span><br><span class="line"><span class="keyword">from</span> copy <span class="keyword">import</span> deepcopy</span><br><span class="line">a = &#123;<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>&#125;</span><br><span class="line">b = a</span><br><span class="line">c = a.copy()  <span class="comment"># 深拷贝</span></span><br><span class="line">d = deepcopy(a)</span><br><span class="line">b.add(<span class="number">4</span>)</span><br><span class="line">c.add(<span class="number">5</span>)</span><br><span class="line">d.add(<span class="number">6</span>)</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">id</span>(a), <span class="built_in">id</span>(b), <span class="built_in">id</span>(c), <span class="built_in">id</span>(d))</span><br></pre></td></tr></table></figure>
<pre><code>22492476895528 22492476895528 22492476895304 22492374233384</code></pre>
<p><a target="_blank" rel="noopener" href="http://t.cn/RgKd3E7">网页版演示</a></p>
<p><img data-src='/advance/nbtutor5.png' width='550'/></p>
<ul>
<li>对于 numpy 的情况</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">%%nbtutor -r -f -i</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">a = np.arange(<span class="number">1</span>, <span class="number">4</span>)</span><br><span class="line">b = a[:] <span class="comment"># 浅拷贝!</span></span><br><span class="line">c = a.copy()  <span class="comment"># 深拷贝, 同 deepcopy(a)</span></span><br><span class="line">d = a[[<span class="number">0</span>, <span class="number">2</span>]]  <span class="comment"># 花式切片是深拷贝</span></span><br><span class="line">b[<span class="number">0</span>] = -<span class="number">1</span></span><br><span class="line">c[<span class="number">1</span>] = -<span class="number">2</span></span><br><span class="line">d[<span class="number">1</span>] = -<span class="number">3</span></span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># id 虽各不同, 但 .__array_interface__[&#x27;data&#x27;][0] 可能相同</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> (a, b, c, d):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">id</span>(i), i.__array_interface__[<span class="string">&#x27;data&#x27;</span>][<span class="number">0</span>])</span><br></pre></td></tr></table></figure>
<pre><code>22928831926400 93879086511872
22928831928960 93879086511872
22928829201984 93879072448320
22928829199344 93879078700736</code></pre>
<p><a target="_blank" rel="noopener" href="http://t.cn/Rg9hST6">网页版演示</a> (<strong>Site
Error</strong>: Ruby and Python+Anaconda backends are permanently
unavailable)</p>
<p>参见之前的 <a href="#矩阵">np.matrix, np.asmatrix</a></p>
<h2 id="其他格式文件读写"><a href="#其他格式文件读写"
class="headerlink"></a>其他格式文件读写</h2>
<h3 id="用-pandas-读-csv"><a href="#用-pandas-读-csv"
class="headerlink"></a>用 pandas 读 csv</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br><span class="line">data = pd.read_csv(<span class="string">&quot;data/data.csv&quot;</span>)</span><br><span class="line">data</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
col1
</th>
<th>
col2
</th>
<th>
col3
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
row1
</td>
<td>
1
</td>
<td>
10.0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
row2
</td>
<td>
2
</td>
<td>
0.2
</td>
</tr>
<tr>
<th>
2
</th>
<td>
row3
</td>
<td>
3
</td>
<td>
300.0
</td>
</tr>
</tbody>
</table>
</div>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.columns</span><br></pre></td></tr></table></figure>
<pre><code>Index([&#39;col1&#39;, &#39;col2&#39;, &#39;col3&#39;], dtype=&#39;object&#39;)</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data.col1</span><br></pre></td></tr></table></figure>
<pre><code>0    row1
1    row2
2    row3
Name: col1, dtype: object</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">data[<span class="string">&#x27;col1&#x27;</span>]</span><br></pre></td></tr></table></figure>
<pre><code>0    row1
1    row2
2    row3
Name: col1, dtype: object</code></pre>
<p>只取一部分:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">data = pd.read_csv(<span class="string">&quot;data/data.csv&quot;</span>, nrows=<span class="number">2</span>, usecols=(<span class="number">0</span>,<span class="number">2</span>))</span><br><span class="line">data</span><br></pre></td></tr></table></figure>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
col1
</th>
<th>
col3
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
row1
</td>
<td>
10.0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
row2
</td>
<td>
0.2
</td>
</tr>
</tbody>
</table>
</div>
<p>对于超大文件, 参见: <a
target="_blank" rel="noopener" href="https://www.dataquest.io/blog/pandas-big-data/"
class="uri">https://www.dataquest.io/blog/pandas-big-data/</a></p>
<h3 id="fortran-二进制文件读写"><a href="#fortran-二进制文件读写"
class="headerlink"></a>Fortran 二进制文件读写</h3>
<h4 id="unformatted-sequential"><a href="#unformatted-sequential"
class="headerlink"></a>Unformatted (sequential)</h4>
<p>使用 <code>scipy.io.FortranFile</code><br> 参考: <a
target="_blank" rel="noopener" href="https://docs.scipy.org/doc/scipy-0.15.1/reference/generated/scipy.io.FortranFile.read_record.html"
class="uri">https://docs.scipy.org/doc/scipy-0.15.1/reference/generated/scipy.io.FortranFile.read_record.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python (write)</span></span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> FortranFile</span><br><span class="line">var1 = <span class="number">1.1</span>  <span class="comment"># &#x27;&lt;f8&#x27;</span></span><br><span class="line">var2 = <span class="number">0</span>  <span class="comment"># &#x27;&lt;i8&#x27;</span></span><br><span class="line">arr = np.arange(<span class="number">6.</span>).reshape((<span class="number">2</span>, <span class="number">3</span>))  <span class="comment"># &#x27;(2, 3)&lt;f8&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(var1, var2)</span><br><span class="line"><span class="built_in">print</span>(arr)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;arr[0, 1] = <span class="subst">&#123;arr[<span class="number">0</span>, <span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 多行存入</span></span><br><span class="line"><span class="keyword">with</span> FortranFile(<span class="string">&#x27;data/data_fortran1-1.dat&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write_record(var1)</span><br><span class="line">    f.write_record(var2)</span><br><span class="line">    f.write_record(arr)</span><br><span class="line"><span class="comment"># 单行存入</span></span><br><span class="line"><span class="keyword">with</span> FortranFile(<span class="string">&#x27;data/data_fortran1-2.dat&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write_record(var1, var2, arr)</span><br></pre></td></tr></table></figure>
<pre><code>1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]
arr[0, 1] = 1.0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python (read)</span></span><br><span class="line"><span class="keyword">from</span> scipy.io <span class="keyword">import</span> FortranFile</span><br><span class="line"><span class="comment"># 多行存入的情况</span></span><br><span class="line"><span class="keyword">with</span> FortranFile(<span class="string">&#x27;data/data_fortran1-1.dat&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    var1 = <span class="built_in">float</span>(f.read_record(<span class="string">&#x27;&lt;f8&#x27;</span>))</span><br><span class="line">    var2 = <span class="built_in">int</span>(f.read_record(<span class="string">&#x27;&lt;i8&#x27;</span>))  <span class="comment"># 注意精度(上面python存入的是默认&#x27;int64&#x27;)</span></span><br><span class="line">    arr = f.read_record(<span class="string">&#x27;(2, 3)&lt;f8&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;data_fortran1-1.dat&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(var1, var2)</span><br><span class="line"><span class="built_in">print</span>(arr)</span><br><span class="line"><span class="comment"># 单行存入的情况</span></span><br><span class="line"><span class="keyword">with</span> FortranFile(<span class="string">&#x27;data/data_fortran1-2.dat&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line"><span class="comment">#     data = f.read_record(&#x27;&lt;f8, &lt;i8, (2, 3)&lt;f8&#x27;)  # 不指定名称</span></span><br><span class="line">    data = f.read_record([(<span class="string">&#x27;var1&#x27;</span>, <span class="string">&#x27;&lt;f8&#x27;</span>), (<span class="string">&#x27;var2&#x27;</span>, <span class="string">&#x27;&lt;i8&#x27;</span>),</span><br><span class="line">                         (<span class="string">&#x27;arr&#x27;</span>, <span class="string">&#x27;(2, 3)&lt;f8&#x27;</span>)])  <span class="comment"># 指定名称: (name, dtype)</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\ndata_fortran1-2.dat&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;keys = <span class="subst">&#123;data.dtype.names&#125;</span>&#x27;</span>)  <span class="comment"># 如读取时未指定名称则为 [&#x27;f0&#x27;, &#x27;f1&#x27;, ...]</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">float</span>(data[<span class="string">&#x27;var1&#x27;</span>]), <span class="built_in">int</span>(data[<span class="string">&#x27;var2&#x27;</span>]))</span><br><span class="line"><span class="built_in">print</span>(data[<span class="string">&#x27;arr&#x27;</span>])</span><br></pre></td></tr></table></figure>
<pre><code>data_fortran1-1.dat
1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]

data_fortran1-2.dat
keys = (&#39;var1&#39;, &#39;var2&#39;, &#39;arr&#39;)
1.1 0
[[[0. 1. 2.]
  [3. 4. 5.]]]</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%%bash</span><br><span class="line"><span class="built_in">cd</span> examples/</span><br><span class="line">ifort -o test_read_seq test_read_seq.f90</span><br><span class="line">./test_read_seq</span><br></pre></td></tr></table></figure>
<pre><code> data_fortran1-1.dat
   1.1  0.0
   0.0  1.0  2.0
   3.0  4.0  5.0
 arr(2, 1) =   1.0

 data_fortran1-2.dat
   1.1  0.0
   0.0  1.0  2.0
   3.0  4.0  5.0
 arr(2, 1) =   1.0</code></pre>
<p>见 Structured arrays: <a
target="_blank" rel="noopener" href="https://docs.scipy.org/doc/numpy/user/basics.rec.html"
class="uri">https://docs.scipy.org/doc/numpy/user/basics.rec.html</a></p>
<h4 id="unformatted-stream"><a href="#unformatted-stream"
class="headerlink"></a>Unformatted (stream)</h4>
<p><code>struct</code> 参考 <a
target="_blank" rel="noopener" href="https://docs.python.org/3/library/struct.html"
class="uri">https://docs.python.org/3/library/struct.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python (write)</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line">var1 = <span class="number">1.1</span>  <span class="comment"># &#x27;&lt;f8&#x27;</span></span><br><span class="line">var2 = <span class="number">0</span>  <span class="comment"># &#x27;&lt;i8&#x27;</span></span><br><span class="line">arr = np.arange(<span class="number">6.</span>).reshape((<span class="number">2</span>, <span class="number">3</span>))  <span class="comment"># &#x27;(2, 3)&lt;f8&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(var1, var2)</span><br><span class="line"><span class="built_in">print</span>(arr)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;arr[0, 1] = <span class="subst">&#123;arr[<span class="number">0</span>, <span class="number">1</span>]&#125;</span>&#x27;</span>)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data/data_fortran2.dat&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(struct.pack(<span class="string">&#x27;d&#x27;</span>, var1))</span><br><span class="line">    f.write(struct.pack(<span class="string">&#x27;i&#x27;</span>, var2))  <span class="comment"># 注意 `struct` 的 &#x27;i&#x27; 是 &#x27;&lt;i4&#x27;</span></span><br><span class="line">    arr.tofile(f)</span><br></pre></td></tr></table></figure>
<pre><code>1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]
arr[0, 1] = 1.0</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># python (read)</span></span><br><span class="line"><span class="comment"># 使用 `np.fromfile`, 读入的是 `ndarray`</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;data/data_fortran2.dat&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    var1 = <span class="built_in">float</span>(np.fromfile(f, dtype=<span class="string">&#x27;&lt;f8&#x27;</span>, count=<span class="number">1</span>))</span><br><span class="line">    var2 = <span class="built_in">int</span>(np.fromfile(f, dtype=<span class="string">&#x27;&lt;i4&#x27;</span>, count=<span class="number">1</span>))</span><br><span class="line">    arr = np.fromfile(f, dtype=<span class="string">&#x27;&lt;f8&#x27;</span>).reshape(<span class="number">2</span>, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">print</span>(var1, var2)</span><br><span class="line"><span class="built_in">print</span>(arr)</span><br></pre></td></tr></table></figure>
<pre><code>1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]</code></pre>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">%%bash</span><br><span class="line"><span class="built_in">cd</span> examples/</span><br><span class="line">ifort -o test_read_stream test_read_stream.f90</span><br><span class="line">./test_read_stream</span><br></pre></td></tr></table></figure>
<pre><code>  1.1 0.0
  0.0 1.0 2.0
  3.0 4.0 5.0
 arr(2, 1) =  1.0</code></pre>
<h3 id="hdf5-文件读写-ncdf-cdf-文件读取"><a
href="#hdf5-文件读写-ncdf-cdf-文件读取" class="headerlink"></a>HDF5
文件读写, NCDF, CDF 文件读取</h3>
<h4 id="读写-hdf5-文件-读-ncdf-文件"><a
href="#读写-hdf5-文件-读-ncdf-文件" class="headerlink"></a>读写 HDF5
文件, 读 NCDF 文件</h4>
<p>HDF5 格式介绍 <a
target="_blank" rel="noopener" href="https://portal.hdfgroup.org/display/HDF5/Introduction+to+HDF5"
class="uri">https://portal.hdfgroup.org/display/HDF5/Introduction+to+HDF5</a></p>
<p>相关包: <code>h5py</code> 或 <code>pandas</code> +
<code>pytables</code>
(http://www.pytables.org/usersguide/datatypes.html)</p>
<p>安装见 <a href="/installpy.html#其他">Python 安装和配置</a></p>
<ul>
<li>查看</li>
</ul>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ h5dump -H &lt;filename&gt;.hdf5</span><br><span class="line">$ ncdump -h &lt;filename&gt;.ncdf</span><br></pre></td></tr></table></figure>
<ul>
<li>用 <code>h5py</code> 读写:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> h5py</span><br><span class="line">arr = np.arange(<span class="number">10000</span>).reshape(<span class="number">50</span>,-<span class="number">1</span>)</span><br><span class="line"><span class="keyword">with</span> h5py.File(<span class="string">&#x27;test.hdf5&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f[<span class="string">&#x27;data&#x27;</span>] = arr</span><br><span class="line">    <span class="comment"># 或</span></span><br><span class="line">    <span class="comment"># f.create_dataset(&#x27;data&#x27;, data=arr)</span></span><br><span class="line">    <span class="comment"># 其中 compression=&#x27;gzip&#x27;, compression_opts=[0-9], 可分条目用不同压缩</span></span><br><span class="line">    f[<span class="string">&#x27;lb&#x27;</span>] = <span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">100</span>))</span><br></pre></td></tr></table></figure>
<p> 读纯 HDF5/NCDF 文件: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">f = h5py.File(<span class="string">&#x27;test.hdf5&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">keys = <span class="built_in">list</span>(f.keys())  <span class="comment"># [&#x27;data&#x27;, &#x27;lb&#x27;]</span></span><br><span class="line">items = <span class="built_in">list</span>(f.items())</span><br><span class="line">a = f[<span class="string">&#x27;data&#x27;</span>].value</span><br></pre></td></tr></table></figure>  读 pandas 存的文件:
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">a = f[<span class="string">&#x27;data&#x27;</span>][<span class="string">&#x27;block0_values&#x27;</span>].value</span><br><span class="line">f.close()</span><br><span class="line"><span class="comment"># f[&#x27;&lt;key&gt;&#x27;] 得到的是 Dataset 或 Group 的引用</span></span><br><span class="line"><span class="comment"># 用 f[&#x27;&lt;key&gt;&#x27;].value 或切片 f[&#x27;&lt;key&gt;&#x27;][:] 得到原来的格式</span></span><br><span class="line"><span class="comment"># f[&#x27;&lt;key&gt;&#x27;] 可替代为f.get(&#x27;&lt;key&gt;&#x27;)</span></span><br><span class="line"><span class="comment"># 关闭之后 f[&#x27;data&#x27;] 的引用失效, 因此存出数据要加上.value或[:]保存数据, 或使用 deepcopy</span></span><br></pre></td></tr></table></figure>  打印读取的信息: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pprint <span class="keyword">import</span> pprint</span><br><span class="line">pprint([(<span class="string">f&#x27;<span class="subst">&#123;k:&gt;<span class="number">20</span>&#125;</span>&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;<span class="built_in">str</span>(f[k].shape):&gt;<span class="number">20</span>&#125;</span>&#x27;</span>, <span class="string">f&#x27;<span class="subst">&#123;<span class="built_in">str</span>(f[k].dtype):&gt;<span class="number">20</span>&#125;</span>&#x27;</span>) <span class="keyword">for</span> k <span class="keyword">in</span> f.keys()])</span><br><span class="line">pprint([(<span class="string">f&#x27;<span class="subst">&#123;k:&gt;<span class="number">20</span>&#125;</span>&#x27;</span>, <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">str</span>(f[k][<span class="string">&#x27;block0_values&#x27;</span>].shape):&gt;<span class="number">20</span>&#125;</span>&quot;</span>, <span class="string">f&quot;<span class="subst">&#123;<span class="built_in">str</span>(f[k][<span class="string">&#x27;block0_values&#x27;</span>].dtype):&gt;<span class="number">20</span>&#125;</span>&quot;</span>) <span class="keyword">for</span> k <span class="keyword">in</span> f.keys()])</span><br></pre></td></tr></table></figure></p>
<ul>
<li>用pandas读写:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> pandas <span class="keyword">as</span> pd</span><br></pre></td></tr></table></figure>
<p> 写: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">arr2 = pd.DataFrame(arr)</span><br><span class="line"><span class="comment"># complevel=[0-9], complib=&#123;&#x27;zlib&#x27;, &#x27;lzo&#x27;, &#x27;bzip2&#x27;, &#x27;blosc&#x27;&#125;</span></span><br><span class="line"><span class="keyword">with</span> pd.HDFStore(<span class="string">&#x27;test2.hdf5&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f[<span class="string">&#x27;data&#x27;</span>] = arr2</span><br><span class="line">    f[<span class="string">&#x27;lb&#x27;</span>] = pd.DataFrame(<span class="built_in">list</span>(<span class="built_in">range</span>(<span class="number">100</span>)))</span><br></pre></td></tr></table></figure>  读 pandas 写的文件: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">f = pd.HDFStore(<span class="string">&#x27;test2.hdf5&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">keys = f.keys()  <span class="comment"># [&#x27;/data&#x27;, &#x27;/lb&#x27;], 存在子目录</span></span><br><span class="line">items = <span class="built_in">list</span>(f.items())</span><br><span class="line">a = f.data.values  <span class="comment"># a = f.&lt;key&gt; 得到的是 DataFrame 的引用, f.&lt;key&gt;.values 得到原来的格式</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></p>
<ul>
<li>读纯 HDF5/NCDF 文件:<br> 比如 h5py 写的文件, 目录结构和 pandas
写的不同, 要用<code>.root</code><br> 其他软件生成的文件可能不能读</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">f = pd.HDFStore(<span class="string">&#x27;test.hdf5&#x27;</span>, <span class="string">&#x27;r&#x27;</span>)</span><br><span class="line">keys = <span class="built_in">list</span>(f.root._v_children.keys())  <span class="comment"># [&#x27;data&#x27;, &#x27;lb&#x27;]</span></span><br><span class="line">items = <span class="built_in">list</span>(f.root._v_children.items())  <span class="comment"># [&#x27;data&#x27;, &#x27;lb&#x27;], 有些文件没有.items</span></span><br><span class="line">a = f.root.data.read()</span><br><span class="line"><span class="comment"># f.root 得到 tables.group.RootGroup, f.root.&lt;key&gt; 得到tables.group.CArray</span></span><br><span class="line"><span class="comment"># f.get_node(&#x27;&lt;key&gt;&#x27;) 得到 tables.group.CArray</span></span><br><span class="line"><span class="comment"># f.root.&lt;key&gt; 可替代为 f[&#x27;&lt;key&gt;&#x27;] (有些文件不行)</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>
<p> 打印 (以免数据有 None, 用 <code>np.shape</code>): <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">pprint([(<span class="string">f&#x27;<span class="subst">&#123;k&#125;</span>&#x27;</span>                      .rjust(<span class="number">20</span>),</span><br><span class="line">         <span class="string">f&#x27;<span class="subst">&#123;np.shape(f.get_node(k))&#125;</span>&#x27;</span>.rjust(<span class="number">20</span>),</span><br><span class="line">         <span class="string">f&#x27;<span class="subst">&#123;np.dtype(f.get_node(k))&#125;</span>&#x27;</span>.rjust(<span class="number">20</span>))</span><br><span class="line">         <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">list</span>(f.root._v_children.keys())])</span><br></pre></td></tr></table></figure>
 Bug: 无法读出 <code>H5T_STRING</code></p>
<h4 id="大小比较"><a href="#大小比较"
class="headerlink"></a>大小比较</h4>
<p>用于比较的文件名说明:</p>
<table>
<thead>
<tr>
<th style="text-align: left;">Filename</th>
<th style="text-align: left;">Method</th>
</tr>
</thead>
<tbody>
<tr>
<td style="text-align: left;"><em>xxx</em>_np.npy</td>
<td style="text-align: left;"><strong><code>np.save</code></strong></td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_np.npz</td>
<td
style="text-align: left;"><strong><code>np.savez_compressed</code></strong></td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_compimg.fits</td>
<td style="text-align: left;"><strong>FITS</strong> CompImageHDU
(compressed)</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_prim.fits</td>
<td style="text-align: left;"><strong>FITS</strong> PrimaryHDU</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_h5py_0.hdf5</td>
<td style="text-align: left;"><strong><code>h5py</code></strong> no
compression</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_h5py_gzip.hdf5</td>
<td style="text-align: left;"><strong><code>h5py</code></strong>
compression='gzip', compression_opts=9</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_h5py_lzf.hdf5</td>
<td style="text-align: left;"><strong><code>h5py</code></strong>
compression='lzf'</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_pd_0.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong> no
compression</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_pd_blosc.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='blosc', complevel=9</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_pd_bzip2.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='bzip2', complevel=9</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_pd_lzo.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='lzo', complevel=9</td>
</tr>
<tr>
<td style="text-align: left;"><em>xxx</em>_pd_zlib.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='zlib', complevel=9</td>
</tr>
</tbody>
</table>
<ul>
<li>对于相关性强的数组</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%run examples/test_hdf5.py</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/test_*.np*</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/test_h5py_*.hdf5</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/test_pd_*.hdf5</span><br></pre></td></tr></table></figure>
<pre><code>array: 15.3 M

7.7M    data/test_np.npy
1.3M    data/test_np.npz

16M data/test_h5py_0.hdf5
2.9M    data/test_h5py_gzip.hdf5
7.7M    data/test_h5py_lzf.hdf5

16M data/test_pd_0.hdf5
272K    data/test_pd_blosc.hdf5
248K    data/test_pd_bzip2.hdf5
256K    data/test_pd_lzo.hdf5
172K    data/test_pd_zlib.hdf5</code></pre>
<ul>
<li>随机数数组</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">%run examples/test_hdf5_2.py</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/test_*.np*</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/test_h5py_*.hdf5</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/test_pd_*.hdf5</span><br></pre></td></tr></table></figure>
<pre><code>array: 15.3 M

7.7M    data/test_np.npy
7.2M    data/test_np.npz

16M data/test_h5py_0.hdf5
8.0M    data/test_h5py_gzip.hdf5
9.5M    data/test_h5py_lzf.hdf5

16M data/test_pd_0.hdf5
7.7M    data/test_pd_blosc.hdf5
7.2M    data/test_pd_bzip2.hdf5
7.7M    data/test_pd_lzo.hdf5
7.1M    data/test_pd_zlib.hdf5</code></pre>
<ul>
<li>从 FITS 文件读取再转存</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fname = <span class="string">&#x27;data/hmi.B_720s.20150827_052400_TAI.field.fits&#x27;</span></span><br><span class="line">%run examples/test_fits_hdf5.py &#123;fname&#125;</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h &#123;fname&#125;</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_*.np*</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_*.fits</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_h5py_*.hdf5</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_pd_*.hdf5</span><br></pre></td></tr></table></figure>
<pre><code>array: 64.0 M

21M data/hmi.B_720s.20150827_052400_TAI.field.fits

65M data/fits_np.npy
27M data/fits_np.npz

21M data/fits_compimg.fits
65M data/fits_prim.fits

65M data/fits_h5py_0.hdf5
27M data/fits_h5py_gzip.hdf5
40M data/fits_h5py_lzf.hdf5

65M data/fits_pd_0.hdf5
23M data/fits_pd_blosc.hdf5
21M data/fits_pd_bzip2.hdf5
23M data/fits_pd_lzo.hdf5
20M data/fits_pd_zlib.hdf5</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">fname = <span class="string">&#x27;data/hmi.B_720s.20150827_052400_TAI.disambig.fits&#x27;</span></span><br><span class="line">%run examples/test_fits_hdf5.py &#123;fname&#125;</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h &#123;fname&#125;</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_*.np*</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_*.fits</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_h5py_*.hdf5</span><br><span class="line"><span class="built_in">print</span>()</span><br><span class="line">!du -h data/fits_pd_*.hdf5</span><br></pre></td></tr></table></figure>
<pre><code>array: 32.0 M

5.4M    data/hmi.B_720s.20150827_052400_TAI.disambig.fits

33M data/fits_np.npy
5.2M    data/fits_np.npz

5.4M    data/fits_compimg.fits
33M data/fits_prim.fits

33M data/fits_h5py_0.hdf5
5.3M    data/fits_h5py_gzip.hdf5
9.7M    data/fits_h5py_lzf.hdf5

33M data/fits_pd_0.hdf5
9.5M    data/fits_pd_blosc.hdf5
4.1M    data/fits_pd_bzip2.hdf5
7.6M    data/fits_pd_lzo.hdf5
4.8M    data/fits_pd_zlib.hdf5</code></pre>
<h4 id="读取-cdf-文件"><a href="#读取-cdf-文件"
class="headerlink"></a>读取 CDF 文件</h4>
<p>相关包 <code>cdflib</code>, 安装见 <a
href="/installpy.html#其他">Python 安装和配置#其他</a>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> cdflib</span><br><span class="line">f = cdflib.CDF(<span class="string">&quot;&lt;filename&gt;.cdf&quot;</span>)</span><br><span class="line">f.cdf_info()  <span class="comment"># 总体信息</span></span><br><span class="line">f.varinq(<span class="string">&#x27;&lt;key&gt;&#x27;</span>)  <span class="comment"># 变量信息</span></span><br><span class="line">f.varget(<span class="string">&#x27;&lt;key&gt;&#x27;</span>)  <span class="comment"># 值</span></span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure></p>
<h3 id="numpy-to-vtk"><a href="#numpy-to-vtk"
class="headerlink"></a>NumPy to VTK</h3>
<p>参考 <a
target="_blank" rel="noopener" href="https://pyscience.wordpress.com/2014/09/06/numpy-to-vtk-converting-your-numpy-arrays-to-vtk-arrays-and-files/"
class="uri">https://pyscience.wordpress.com/2014/09/06/numpy-to-vtk-converting-your-numpy-arrays-to-vtk-arrays-and-files/</a><br>
以及 <a href="/installpy.html#其他">Python 安装和配置</a> <br><br>
e.g.<br> 运行 <a
target="_blank" rel="noopener" href="https://github.com/lydiazly/python-intro/blob/master/examples/field2dvtk.py">examples/field2dvtk.py</a>
,<br> 打开Paraview, 选择 state 文件 'field2d.pvsm', 再选择数据文件
'field2d.vtr'</p>
<h3 id="matlab-mat-文件读写"><a href="#matlab-mat-文件读写"
class="headerlink"></a>Matlab mat 文件读写</h3>
<p>(未测试) <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> scipy.io</span><br><span class="line">scipy.io.loadmat(<span class="string">&quot;&lt;filename&gt;&quot;</span>, mdict=<span class="literal">None</span>, appendmat=<span class="literal">True</span>, **kwargs)</span><br><span class="line"><span class="comment"># 如果 appendmat=True，则文件名不需要&#x27;.mat&#x27;后缀)</span></span><br><span class="line">scipy.io.savemat(<span class="string">&quot;&lt;filename&gt;&quot;</span>, mdict, appendmat=<span class="literal">True</span>, <span class="built_in">format</span>=<span class="string">&#x27;5&#x27;</span>,</span><br><span class="line">                 long_field_names=<span class="literal">False</span>, do_compression=<span class="literal">False</span>, oned_as=<span class="string">&#x27;row&#x27;</span>)</span><br></pre></td></tr></table></figure></p>
<h2 id="脚本相关"><a href="#脚本相关"
class="headerlink"></a>脚本相关</h2>
<h3 id="脚本结构"><a href="#脚本结构"
class="headerlink"></a>脚本结构</h3>
<p>文件头: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br></pre></td></tr></table></figure></p>
<p>脚本结构: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">假设这个文件的名称为 mymodule.py</span></span><br><span class="line"><span class="string">使用 `imort mymodule` 导入</span></span><br><span class="line"><span class="string">这些文字会出现在 `help(mymodule)` 或 `pydoc mymodule` 中</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">c = <span class="number">1</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func1</span>(<span class="params">x, y, *args, **kwargs</span>):</span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    这个注释必须缩进</span></span><br><span class="line"><span class="string">    args: a tuple - (arg1, arg2, ...)</span></span><br><span class="line"><span class="string">    kwargs: a dict - &#123;key1 : val1, key2 : val2&#125;</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">global</span> c</span><br><span class="line">    <span class="keyword">return</span> x + y + c</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">func2</span>(<span class="params">x</span>):</span><br><span class="line">    a = func1(x, x)</span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"><span class="keyword">def</span> <span class="title function_">_func3</span>(<span class="params">x</span>):  <span class="comment"># `from xxx import *` 将不会导入这个函数</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span>  <span class="comment"># return 不写时返回 None</span></span><br><span class="line"><span class="keyword">def</span> <span class="title function_">main</span>():</span><br><span class="line">    <span class="comment"># your code here</span></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure> <code>import</code> 这个文档时,
<code>__name__</code> 为模块名, 因此 <code>main()</code> 不执行</p>
<p><code>help()</code> 也可以查看模块内的函数文档:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> usr_sunpy</span><br><span class="line"><span class="built_in">help</span>(usr_sunpy.plot_map)</span><br></pre></td></tr></table></figure>
<h3 id="try-...-except-...-语法"><a href="#try-...-except-...-语法"
class="headerlink"></a>try ... except ... 语法</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    ...</span><br><span class="line"><span class="keyword">except</span> ValueError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ValueError:&#x27;</span>, e)</span><br><span class="line"><span class="keyword">except</span> ZeroDivisionError <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;ZeroDivisionError:&#x27;</span>, e)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;no error!&#x27;</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;finally...&#x27;</span>)</span><br></pre></td></tr></table></figure>
<p>见 <a href="#paraview-脚本">Paraview 的例子</a></p>
<h3 id="paraview-脚本"><a href="#paraview-脚本"
class="headerlink"></a>Paraview 脚本</h3>
<p>官方文档 <a
target="_blank" rel="noopener" href="https://www.paraview.org/ParaView/Doc/Nightly/www/py-doc/index.html"
class="uri">https://www.paraview.org/ParaView/Doc/Nightly/www/py-doc/index.html</a>
<br><br> * 记录语句: 1. Tools -&gt; Start Trace 2. 进行各种操作 3. Tools
-&gt; Stop Trace 之后得到一个包含刚才操作命令的脚本,
参考其中的语句就可以写自己的脚本了. <br><br> * 需要导入的模块:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">from paraview.simple import *</span><br></pre></td></tr></table></figure>
<p><br> * 使用 pvpython (默认渲染) pvbatch (默认不渲染) 来执行脚本:</p>
<figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pvbatch myscript.py</span><br></pre></td></tr></table></figure>
<p>也可以使用文件头 <code>#!/usr/bin/env pvbatch</code>,
加执行权限后直接执行: <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">./myscript.py</span><br></pre></td></tr></table></figure> 注意: 打包的 paraview 所使用的
python 是 paraview 自带的 python2.7</p>
<p><img data-src='/advance/Screenshot_20180618-151438.png' width='700' /></p>
<ul>
<li>常用语句:</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">view = GetActiveView()</span><br><span class="line">scene = GetAnimationScene()</span><br></pre></td></tr></table></figure>
<p><code>view.ViewTime</code> 修改时 <code>scene.AnimationTime</code>
不变 <code>scene.AnimationTime</code> 修改时 <code>view.ViewTime</code>
也同时被改变</p>
<p>注意: filter 必须是显示状态 (<code>Show(&lt;filter&gt;)</code>)
才能修改时间</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># e.g.</span></span><br><span class="line">!code -n examples/stat1.py</span><br></pre></td></tr></table></figure>
<ul>
<li>字体选择参考路径:<br>
<ul>
<li>/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf</li>
<li>/home/<user>/miniconda3/lib/python3.6/site-packages/matplotlib/mpl-data/fonts/ttf/DejaVuSans.ttf</li>
</ul></li>
<li>python 调用问题 (paraview 5.5.0+ 没有这个问题):</li>
</ul>
<p>paraview 某个版本之后就默认使用 python 2.7.11+.<br>
运行之前先修改环境变量 ( <code>PYTHONPATH</code> 和
<code>PYTHONSTARTUP</code>), <br>
运行结束结束后恢复这两个变量即可.<br><br> 这个过程可以使用脚本
(而不用alias): <figure class="highlight sh"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="built_in">unset</span> PYTHONSTARTUP  <span class="comment"># 如果有的话</span></span><br><span class="line"><span class="built_in">export</span> PYTHONPATH=/&lt;your_path&gt;/ParaView/lib/python2.7/site-packages</span><br><span class="line">/&lt;your_path&gt;/ParaView/bin/paraview <span class="variable">$@</span></span><br></pre></td></tr></table></figure> 用这个脚本替代原有 <code>paraview</code>,
<code>pvpython</code> 和 <code>pvbatch</code> 命令.</p>
<h3 id="python-2---3-的转换"><a href="#python-2---3-的转换"
class="headerlink"></a>Python 2 -&gt; 3 的转换</h3>
<p>比较推荐的安全的检查方式:</p>
<ul>
<li><p>备份的原文件且自动生成转换过的文件 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ 2to3 -w filename</span><br></pre></td></tr></table></figure></p></li>
<li><p>手动比较, 在需要的地方对照修改 filename.bak<br> 主要查看 print,
range, map 等函数.<br> 添加<br>
 <code>from __future__ import division, print_function</code><br> 在其他
import 前. <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$ sudo apt-get install meld</span><br><span class="line">$ meld filename filename.bak</span><br></pre></td></tr></table></figure></p></li>
<li><p>确认无误后, 将手动修改的文件复制回去 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$ mv -v filename.bak filename</span><br></pre></td></tr></table></figure></p></li>
</ul>
<p>python 内查看版本的方法, 可用于 <code>if</code> 语句等 (更推荐用
<code>try...except...</code> 语法):</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="built_in">print</span>(sys.version_info &gt;= (<span class="number">3</span>, <span class="number">0</span>))</span><br><span class="line"><span class="built_in">print</span>(sys.version_info.major &gt;= <span class="number">3</span>)</span><br></pre></td></tr></table></figure>
<h3 id="执行-shell-命令"><a href="#执行-shell-命令"
class="headerlink"></a>执行 shell 命令</h3>
<p><a target="_blank" rel="noopener" href="https://docs.python.org/3/library/subprocess.html"
class="uri">https://docs.python.org/3/library/subprocess.html</a></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"></span><br><span class="line">fname = <span class="string">&#x27;installpy.ipynb&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 默认是以列表形式传递参数</span></span><br><span class="line">subprocess.run([<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-l&quot;</span>, fname]) <span class="comment"># doesn&#x27;t capture output</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 输出结果需要 `decode(&#x27;ascii&#x27;)` 转码</span></span><br><span class="line"><span class="built_in">print</span>(subprocess.run([<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-l&quot;</span>, fname], stdout=subprocess.PIPE)</span><br><span class="line">                    .stdout.decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line"><span class="built_in">print</span>(subprocess.check_output([<span class="string">&quot;ls&quot;</span>, <span class="string">&quot;-l&quot;</span>, fname]).decode(<span class="string">&#x27;ascii&#x27;</span>))</span><br></pre></td></tr></table></figure>
<pre><code>-rw-rw-r-- 1 lydia lydia 142508 Jun 24 16:21 installpy.ipynb

-rw-rw-r-- 1 lydia lydia 142508 Jun 24 16:21 installpy.ipynb</code></pre>
<p>利用 bash 的特长来做一些字符串操作:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 使用整行命令需要 `shell=True`, 虽然并不是推荐的做法, 但偶尔使用无妨 (见官方文档)</span></span><br><span class="line"><span class="comment"># `r`用来取消转义</span></span><br><span class="line"><span class="comment"># `echo`使用`-n`来去掉输出的 &#x27;\n&#x27;</span></span><br><span class="line">fname_head = subprocess.check_output(<span class="string">r&quot;echo -n %s | sed &#x27;s/\.ipynb//&#x27;&quot;</span></span><br><span class="line">                                     % fname, shell=<span class="literal">True</span>).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="comment"># 或使用 strip 去掉 &#x27;\n&#x27;</span></span><br><span class="line">fname_head = subprocess.check_output(<span class="string">r&quot;echo %s | sed &#x27;s/\.ipynb//&#x27;&quot;</span></span><br><span class="line">             % fname, shell=<span class="literal">True</span>).strip().decode(<span class="string">&#x27;ascii&#x27;</span>)  </span><br><span class="line"><span class="built_in">print</span>(fname_head)</span><br></pre></td></tr></table></figure>
<pre><code>installpy</code></pre>
<p>字符串编码见 <a
target="_blank" rel="noopener" href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431664106267f12e9bef7ee14cf6a8776a479bdec9b9000">廖雪峰的网站</a></p>
<ul>
<li>得到命令执行的路径</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line">os.getcwd()</span><br></pre></td></tr></table></figure>
<pre><code>&#39;/home/lydia/codes/zly/python/python-intro&#39;</code></pre>
<ul>
<li>得到脚本文件所在的路径(仅脚本中使用)</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.split(os.path.abspath(__file__))[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>
<p>或 <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.dirname(os.path.abspath(__file__))</span><br></pre></td></tr></table></figure></p>
<p>其中 <code>os.path.split</code> 和 <code>os.path.dirname</code>
的用法:</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.split(<span class="string">&#x27;your/path/filename&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>(&#39;your/path&#39;, &#39;filename&#39;)</code></pre>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">os.path.dirname(<span class="string">&#x27;your/path/filename&#x27;</span>)</span><br></pre></td></tr></table></figure>
<pre><code>&#39;your/path&#39;</code></pre>
<p><code>os.path.dirname</code> 类似于 bash 的 <code>dirname</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">!dirname <span class="string">&#x27;your/path/filename&#x27;</span></span><br></pre></td></tr></table></figure>
<pre><code>your/path</code></pre>
<h3 id="脚本选项"><a href="#脚本选项"
class="headerlink"></a>脚本选项</h3>
<p>推荐 <code>argparse</code>, 在过去的其他方法的基础上有所增强 <a
target="_blank" rel="noopener" href="https://docs.python.org/3/library/argparse.html"
class="uri">https://docs.python.org/3/library/argparse.html</a></p>
<p>脚本内: <figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> argparse</span><br><span class="line">parser = argparse.ArgumentParser(description=<span class="string">&#x27;Process some integers.&#x27;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&#x27;integers&#x27;</span>, metavar=<span class="string">&#x27;N&#x27;</span>, <span class="built_in">type</span>=<span class="built_in">int</span>, nargs=<span class="string">&#x27;+&#x27;</span>,</span><br><span class="line">                    <span class="built_in">help</span>=<span class="string">&#x27;an integer for the accumulator&#x27;</span>)</span><br><span class="line">parser.add_argument(<span class="string">&#x27;--sum&#x27;</span>, dest=<span class="string">&#x27;accumulate&#x27;</span>, action=<span class="string">&#x27;store_const&#x27;</span>,</span><br><span class="line">                    const=<span class="built_in">sum</span>, default=<span class="built_in">max</span>,</span><br><span class="line">                    <span class="built_in">help</span>=<span class="string">&#x27;sum the integers (default: find the max)&#x27;</span>)</span><br><span class="line">args = parser.parse_args()</span><br><span class="line"><span class="built_in">print</span>(args.accumulate(args.integers))</span><br></pre></td></tr></table></figure> Shell: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">$ python prog.py -h</span><br><span class="line">usage: prog.py [-h] [--sum] N [N ...]</span><br><span class="line">Process some integers.</span><br><span class="line">positional arguments:</span><br><span class="line"> N           an integer for the accumulator</span><br><span class="line">optional arguments:</span><br><span class="line"> -h, --help  show this help message and exit</span><br><span class="line"> --sum       sum the integers (default: find the max)</span><br></pre></td></tr></table></figure></p>
<h3 id="处理-warnings"><a href="#处理-warnings"
class="headerlink"></a>处理 warnings</h3>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># Suppress warnings of NaNs:</span></span><br><span class="line"><span class="keyword">with</span> np.errstate(invalid=<span class="string">&#x27;ignore&#x27;</span>):</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"><span class="comment"># Suppress other warnings, e.g.</span></span><br><span class="line"><span class="keyword">import</span> warnings</span><br><span class="line"><span class="keyword">with</span> warnings.catch_warnings():</span><br><span class="line">    warnings.simplefilter(<span class="string">&quot;ignore&quot;</span>)</span><br><span class="line">    ...</span><br><span class="line">    ...</span><br><span class="line"><span class="comment"># Or</span></span><br><span class="line">warnings.simplefilter(<span class="string">&quot;ignore&quot;</span>, category=xxx)  <span class="comment"># UserWarning, FutureWarning, etc.</span></span><br><span class="line">...</span><br><span class="line">...</span><br></pre></td></tr></table></figure>
<h2 id="urllib-requests"><a href="#urllib-requests"
class="headerlink"></a>urllib, requests</h2>
<p>示例和文件来自 <a target="_blank" rel="noopener" href="http://python4astronomers.github.io"
class="uri">http://python4astronomers.github.io</a></p>
<p>注意 python3 不再使用 <code>urllib2</code></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 方法1</span></span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line">url = <span class="string">&#x27;http://python4astronomers.github.io/_downloads/myidlfile.sav&#x27;</span></span><br><span class="line">urllib.request.urlretrieve(url, <span class="string">&#x27;myidlfile.sav&#x27;</span>)</span><br><span class="line"><span class="comment"># 方法2</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;myidlfile.sav&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(urllib.request.urlopen(url).read())</span><br><span class="line"><span class="comment"># 方法3</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;myidlfile.sav&#x27;</span>, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(requests.get(url).content)</span><br><span class="line"><span class="comment"># 分块下载</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line">r = requests.get(&lt;url&gt;)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(filename, <span class="string">&#x27;wb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> chunk <span class="keyword">in</span> r.iter_content(chunk_size=<span class="number">128</span>):</span><br><span class="line">        f.write(chunk)</span><br></pre></td></tr></table></figure>

    </div>

    
    
    

    <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/python/" rel="tag"><i class="fa fa-tag"></i> python</a>
              <a href="/tags/jupyter/" rel="tag"><i class="fa fa-tag"></i> jupyter</a>
              <a href="/tags/conda/" rel="tag"><i class="fa fa-tag"></i> conda</a>
              <a href="/tags/astropy/" rel="tag"><i class="fa fa-tag"></i> astropy</a>
              <a href="/tags/sunpy/" rel="tag"><i class="fa fa-tag"></i> sunpy</a>
              <a href="/tags/astronomy/" rel="tag"><i class="fa fa-tag"></i> astronomy</a>
          </div>

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/main" rel="prev" title="Python 简易教程 (lecture for Solar Group)">
                  <i class="fa fa-angle-left"></i> Python 简易教程 (lecture for Solar Group)
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/fido" rel="next" title="Example: Downloading Data Using Fido">
                  Example: Downloading Data Using Fido <i class="fa fa-angle-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">

  <div class="copyright">
    &copy; 2018 – 
    <span itemprop="copyrightYear">2024</span>
    <span class="with-love">
      <i class=""></i>
    </span>
    <span class="author" itemprop="copyrightHolder">Lydia Zhang</span>
  </div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="Total Visitors">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="Total Views">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/" rel="noopener" target="_blank">NexT.Gemini</a>
  </div>

    </div>
  </footer>

  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>
  <div class="sidebar-dimmer"></div>
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up fa-lg"></i>
    <span>0%</span>
  </div>
  <div class="reading-progress-bar"></div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


  
  <script src="https://cdnjs.cloudflare.com/ajax/libs/animejs/3.2.1/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/next-theme-pjax/0.6.0/pjax.min.js" integrity="sha256-vxLn1tSKWD4dqbMRyv940UYw4sXgMtYcK6reefzZrao=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/medium-zoom/1.1.0/medium-zoom.min.js" integrity="sha256-ZgMyDAIYDYGxbcpJcfUnYwNevG/xi9OHKaR/8GK+jWc=" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/lozad.js/1.16.0/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/sidebar.js"></script><script src="/js/next-boot.js"></script><script src="/js/pjax.js"></script>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/hexo-generator-searchdb/1.4.1/search.js" integrity="sha256-1kfA5uHPf65M5cphT2dvymhkuyHPQp5A53EGZOnOLmc=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>







  
  <script data-pjax async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdnjs.cloudflare.com/ajax/libs/mathjax/3.2.2/es5/tex-mml-chtml.js","integrity":"sha256-MASABpB4tYktI2Oitl4t+78w/lyA+D7b/s9GEP0JOGI="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
