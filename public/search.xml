<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>Python 进阶 (lecture for Solar Group)</title>
    <url>//advance.html</url>
    <content><![CDATA[<p><a
href="/downloads/notebooks/python-intro.zip"><i class="fas fa-download"></i>
Jupyter Notebook</a></p>
<h2 id="anaconda">Anaconda</h2>
<blockquote>
<p>A <strong>conda package</strong> is a compressed tarball file that
contains system-level libraries, Python or other modules, executable
programs and other components. <strong>Conda</strong> keeps track of the
dependencies between packages and platforms.<br>
(https://conda.io/docs/user-guide/concepts.html)</p>
</blockquote>
<ul>
<li>凡使用 <span style="color:blue">pip install</span>
安装的包均为编译安装, <span style="color:blue">conda install</span>
安装的则为编译好的二进制包.</li>
<li>conda 包可以打包其他语言, pip 包容易出现系统依赖问题</li>
<li>conda 包的依赖管理更完善</li>
<li>conda 环境下仍可使用 pip 进行安装, 但所使用的 pip 命令和系统中的 pip
互不影响, 安装的包的位置也在 conda 本身的目录下.</li>
<li>每个环境互不影响, 各环境下的包虽然必须分别安装 (也可以 clone
一个现有环境),<br> 但如果有不同环境中有重复的包 conda 将默认使用
<em>hard link</em>.</li>
</ul>
<p>(更多讨论参考 <a
href="http://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/)"
class="uri">http://jakevdp.github.io/blog/2016/08/25/conda-myths-and-misconceptions/)</a>
<span id="more"></span></p>
<p><img src='/advance/Screenshot_20180617-181206.png' width='650'/></p>
<ul>
<li>python 位置 (未使用 conda 时)</li>
</ul>
<p>使用 <pre class="line-numbers language-none"><code class="language-none">$ python -m site<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> 可以看到有哪些目录.</p>
<p>三个部分:</p>
<ul>
<li><strong>root</strong>
<pre>
/<span style="color:#800080"><b>usr</b></span>/lib/...
/<span style="color:#800080"><b>usr</b></span>/bin/...
</pre></li>
<li><strong>user</strong>
<pre>
/home/&lt;user&gt;/<span style="color:#800080"><b>.local</b></span>/lib/...
/home/&lt;user&gt;/<span style="color:#800080"><b>.local</b></span>/bin/...
</pre></li>
<li><strong>anaconda/miniconda</strong>
<pre>
/home/&lt;user&gt;/<b><span style="color:#800080">miniconda3</span></b>/</span>/lib/...
/home/&lt;user&gt;/<b><span style="color:#800080">miniconda3</span></b>/</span>/bin/...
</pre></li>
<li>conda 目录结构 (安装之后自动修改了软连接,
修改环境变量后系统优先使用这个位置)</li>
</ul>
<pre>
/home/&lt;user&gt;/<span style="color:#800080"><b>miniconda3/</b></span>
    ├── <span style="color:navy"><b>pkgs/</b></span>
    ├── <span style="color:dimgray"><b>bin/</b></span>
    │        ├── <span style="color:magenta">python</span> -&gt; <span style="color:green">python3.6</span>
    │        ├── <span style="color:magenta">python3</span> -&gt; <span style="color:green">python3.6</span>
    │        ├── <span style="color:green">python3.6</span>
    │        ├── <span style="color:green">jupyter</span>
    │        ├── <span style="color:green">h5dump</span>
    │        └── ...
    ├── <span style="color:dimgray"><b>include/</b></span>
    ├── <span style="color:dimgray"><b>lib/</b></span>
    ├── <span style="color:dimgray"><b>share/</b></span>
    ├── <span style="color:navy"><b>envs</b></span>
    │        ├── <span style="color:blue"><b>env1/</b></span>
    │        │        ├── <span style="color:dimgray"><b>bin/</b></span>
    │        │        ├── <span style="color:dimgray"><b>include/</b></span>
    │        │        ├── <span style="color:dimgray"><b>lib/</b></span>
    │        │        ├── <span style="color:dimgray"><b>share/</b></span>
    │        │        └── ...
    │        ├── <span style="color:blue"><b>env2/</b></span>
    │        └── ...
    └── ...
</pre>
<h2 id="ipython-jupyter">IPython &amp; Jupyter</h2>
<p>参考文档 <a href="http://jupyter-notebook.readthedocs.io/en/stable/"
class="uri">http://jupyter-notebook.readthedocs.io/en/stable/</a></p>
<ul>
<li>配置文件路径</li>
</ul>
<p>一般用户配置文件在 <code>~/.jupyter</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">!jupyter <span class="token operator">-</span><span class="token operator">-</span>paths<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>config:
    /home/lydia/.jupyter
    /home/lydia/miniconda3/etc/jupyter
    /usr/local/etc/jupyter
    /etc/jupyter
data:
    /home/lydia/.local/share/jupyter
    /home/lydia/miniconda3/share/jupyter
    /usr/local/share/jupyter
    /usr/share/jupyter
runtime:
    /run/user/1000/jupyter</code></pre>
<ul>
<li>列出所有 magic functions:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>lsmagic<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>运行脚本:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>run script<span class="token punctuation">.</span>py
<span class="token operator">%</span>run script<span class="token punctuation">.</span>ipynb<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>在单个 Cell 中调用其他语言 (子进程):</li>
</ul>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">%%sh
cd ~&#x2F;miniconda3&#x2F;
pwd<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>/home/lydia/miniconda3</code></pre>
<p>可以看到实际并未改变当前目录 (因为是子进程):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;/home/lydia/codes/zly/python/python-intro&#39;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>script idl
cd<span class="token punctuation">,</span> current<span class="token operator">=</span>d
<span class="token keyword">print</span><span class="token punctuation">,</span> d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>/home/lydia/codes/zly/python/python-intro


IDL Version 8.2.1 (linux x86_64 m64). (c) 2012, Exelis Visual Information Solutions, Inc.</code></pre>
<ul>
<li>逐行使用 bash 命令 (注意不加 '!' 的区别):</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">!idl <span class="token operator">-</span>e field3dgui<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">!ls <span class="token punctuation">.</span><span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>得到的结果可以存入变量:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">current<span class="token punctuation">,</span> <span class="token operator">=</span> !pwd  <span class="token comment"># returns a list</span>
current<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#39;/home/lydia/python-intro&#39;</code></pre>
<p>下面这两句不能写在一个 Cell 中:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cd <span class="token operator">-</span>q <span class="token operator">~</span><span class="token operator">/</span>miniconda3<span class="token operator">/</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">pwd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;/home/lydia/miniconda3&#39;</code></pre>
<p>用 <code>&#123;var&#125;</code> (推荐) 或 <code>$var</code> (不推荐) 调用当前
ipython 环境的变量:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cd <span class="token punctuation">&#123;</span>current<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>/home/lydia/codes/zly/python/python-intro</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cd <span class="token string">"$current"</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>/home/lydia/codes/zly/python/python-intro</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cd $current<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>/home/lydia/codes/zly/python/python-intro</code></pre>
<p>见 <a
href="http://mmcdan.github.io/posts/interacting-with-the-shell-via-jupyter-notebook/"
class="uri">http://mmcdan.github.io/posts/interacting-with-the-shell-via-jupyter-notebook/</a></p>
<ul>
<li>列出当前的变量信息</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span>
b <span class="token operator">=</span> <span class="token string">'x'</span>

<span class="token operator">%</span>whos <span class="token builtin">int</span> <span class="token builtin">str</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>Variable   Type    Data/Info
----------------------------
a          int     1
b          str     x</code></pre>
<h2 id="语法细节">语法细节</h2>
<h3 id="python2-python3">python2 &amp; python3</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>python2
<span class="token keyword">print</span> <span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span>
<span class="token keyword">print</span> <span class="token number">1</span> <span class="token operator">//</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>0
0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>python3
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token number">1</span> <span class="token operator">//</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>0.5
0</code></pre>
<p>详见 <a href="#Python-2--%3E-3-的转换">Python 2 -&gt; 3
的转换</a></p>
<h3 id="list-tuple">list, tuple</h3>
<ul>
<li>对 list 或 tuple, 当只有一个元素时, 注意加逗号:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>list</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>list</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>int</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token punctuation">)</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>tuple</code></pre>
<ul>
<li>赋值, 星号 (<code>*</code>) 表达式用来展开 list/tuple, 双星号
(<code>**</code>) 用来展开 dict (常用于函数参数表):</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">*</span>c <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>(0, 1, [2, 3])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">,</span> <span class="token operator">*</span>_ <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span> <span class="token comment"># 或 a, = ...</span>
a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>0</code></pre>
<h3 id="dict">dict</h3>
<ul>
<li>dict 改变某个 key 但 value 不变的方法</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span>
d<span class="token punctuation">[</span><span class="token string">'c'</span><span class="token punctuation">]</span> <span class="token operator">=</span> d<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token string">'b'</span><span class="token punctuation">)</span>  <span class="token comment"># 利用 `pop` 返回值, 更改 key 值</span>
d<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>&#123;&#39;a&#39;: 1, &#39;c&#39;: 2&#125;</code></pre>
<ul>
<li>dict 求并集</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d1 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span>
d2 <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span> <span class="token punctuation">:</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'c'</span> <span class="token punctuation">:</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'d'</span> <span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">dict</span><span class="token punctuation">(</span>d1<span class="token punctuation">,</span> <span class="token operator">**</span>d2<span class="token punctuation">)</span>  <span class="token comment"># 重复的 key 取后一个的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;&#39;a&#39;: -1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">dict</span><span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span>d1<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">+</span> <span class="token builtin">list</span><span class="token punctuation">(</span>d2<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 注意其中的 list</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;&#39;a&#39;: -1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d1<span class="token punctuation">.</span>update<span class="token punctuation">(</span>d2<span class="token punctuation">)</span>
d1<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#123;&#39;a&#39;: -1, &#39;b&#39;: 2, &#39;c&#39;: 3, &#39;d&#39;: 4&#125;</code></pre>
<h3 id="set">set</h3>
<ul>
<li>set 基本操作</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span> <span class="token comment"># one element only</span>
s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#123;1, 2, 3&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s<span class="token punctuation">.</span>update<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># iterable: list/tuple/set/...</span>
s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#123;1, 2, 3, 4, 5&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s<span class="token punctuation">.</span>remove<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#123;2, 3, 4, 5&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s<span class="token punctuation">.</span>discard<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>  <span class="token comment"># No error if not exist</span>
s<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#123;2, 3, 4, 5&#125;</code></pre>
<ul>
<li>set 求交集, 并集, 差集, 对称差集, 子集</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>intersection<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;2&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">&amp;</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 或用 and</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;2&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>union<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;1, 2, 3&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">|</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 或用 or</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;1, 2, 3&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>difference<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;1&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">-</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 在前不在后</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;1&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>symmetric_difference<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;1, 3&#125;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">^</span> <span class="token punctuation">&#123;</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 不同时在两边</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#123;1, 3&#125;</code></pre>
<ul>
<li>属于, 包含于(子集)</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">2</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># list/tuple/set</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">4</span> <span class="token keyword">not</span> <span class="token keyword">in</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># list/tuple/set</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>issubset<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span> <span class="token operator">&lt;=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span><span class="token punctuation">.</span>issuperset<span class="token punctuation">(</span><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span> <span class="token operator">>=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<h3 id="一些特性的演示">一些特性的演示</h3>
<p>插件 <a href="https://github.com/lgpage/nbtutor"
class="uri">https://github.com/lgpage/nbtutor</a><br> 网页版 <a
href="http://pythontutor.com/"
class="uri">http://pythontutor.com/</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>reload_ext nbtutor<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f
l1<span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span>
l2 <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><a href="http://t.cn/Rg9J3bf">网页版演示</a></p>
<p><img src='/advance/nbtutor1.png' width='550'/></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f <span class="token operator">-</span>i
a <span class="token operator">=</span> <span class="token number">3</span>
b <span class="token operator">=</span> <span class="token number">4</span>
t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token punctuation">[</span>a<span class="token punctuation">,</span> b<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># list in tuple</span>
a <span class="token operator">=</span> <span class="token string">'x'</span> <span class="token comment"># change element in list</span>
t<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token string">'xx'</span> <span class="token comment"># change element in tuple</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>t<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>(1, 2, [&#39;xx&#39;, 4])</code></pre>
<p><a href="http://t.cn/Rg9idUn">网页版演示</a></p>
<p><img src='/advance/nbtutor2.png' width='550'/></p>
<h3 id="包含判断的单行循环">包含判断的单行循环</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
<span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> l <span class="token keyword">if</span> i <span class="token operator">></span> <span class="token number">2</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>[3, 4, 5]</code></pre>
<p>例如用 <code>globals()</code> 来得到字符串形式的变量名 (python
的变量没有提供这个功能的关键字, 因为"变量名"存储在namespaces中)</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">namestr</span><span class="token punctuation">(</span>obj<span class="token punctuation">,</span> namespace<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> <span class="token punctuation">[</span>name <span class="token keyword">for</span> name <span class="token keyword">in</span> namespace <span class="token keyword">if</span> namespace<span class="token punctuation">[</span>name<span class="token punctuation">]</span> <span class="token keyword">is</span> obj<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
a <span class="token operator">=</span> <span class="token number">1</span>
b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token keyword">for</span> var <span class="token keyword">in</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>namestr<span class="token punctuation">(</span>var<span class="token punctuation">,</span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string"> = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>var<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>a = 1
b = 2</code></pre>
<h3 id="单行-if-三元关系运算">单行 if (三元关系运算)</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span>
b <span class="token operator">=</span> <span class="token string">'y'</span> <span class="token keyword">if</span> a <span class="token operator">></span> <span class="token number">0</span> <span class="token keyword">else</span> <span class="token string">'n'</span>
b<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>&#39;y&#39;</code></pre>
<h3 id="循环-迭代器-生成器">循环, 迭代器, 生成器</h3>
<p>Python 的 for 循环不使用索引变量, 而使用遍历<strong>迭代器</strong>
(iterator) 的方式处理<strong>可迭代对象</strong> (range, set 等):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>遍历的方式是使用 <code>iter</code> 和 <code>next</code> 函数:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token builtin">iter</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 生成一个 range_iterator 对象</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">next</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 转换为 list</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>[0, 1, 2, 3, 4]</code></pre>
<p><code>enumerate</code> 函数适合需要同时使用索引和内容时使用:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i<span class="token punctuation">,</span> item <span class="token keyword">in</span> <span class="token builtin">enumerate</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># enumerate()是一个迭代器</span>
    i <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    item <span class="token operator">=</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>  <span class="token comment"># l[i] = ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>生成器:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">(</span>i<span class="token operator">**</span><span class="token number">2</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 产生一个生成器, 可转化成 list, tuple</span>
a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&lt;generator object &lt;genexpr&gt; at 0x14da87e652b0&gt;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">next</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment"># 生成器也是迭代器</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>4</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>  <span class="token comment"># 产生一个 list</span>
a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>[0, 1, 2]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 转化成 tuple</span>
<span class="token builtin">tuple</span><span class="token punctuation">(</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>(0, 1, 2)</code></pre>
<h3 id="函数定义">函数定义</h3>
<ul>
<li>一般的函数定义:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">func</span><span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># func1(x, y, arg1, arg2, ..., key1=val1, key2=val2, ...)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token keyword">return</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span> <span class="token comment"># 没有 return 或为空 则返回 None</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<ul>
<li>单行函数 lambda</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">return</span> x <span class="token operator">+</span> y
f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>3</code></pre>
<p>用 <code>lambda</code> 语法来定义:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> <span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">+</span> y
f<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>3</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token keyword">lambda</span> x<span class="token punctuation">,</span> y<span class="token punctuation">:</span> x <span class="token operator">+</span> y<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 不一定需要定义函数名称</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>3</code></pre>
<h3 id="命名空间和变量作用域">命名空间和变量作用域</h3>
<p><a
href="https://sebastianraschka.com/Articles/2014_python_scope_and_namespaces.html"
class="uri">https://sebastianraschka.com/Articles/2014_python_scope_and_namespaces.html</a></p>
<p><img src='/advance/scope_resolution_1.png' width='400' /></p>
<ul>
<li>Built-in Functions <a
href="https://docs.python.org/3/library/functions.html"
class="uri">https://docs.python.org/3/library/functions.html</a></li>
<li>Built-in Constants <a
href="https://docs.python.org/3/library/constants.html"
class="uri">https://docs.python.org/3/library/constants.html</a></li>
</ul>
<p><code>globals()</code> 以 dict 形式返回当前所有全局变量,
包括导入的包名, ipython/jupyter 的 <code>In</code>, <code>Out</code>
等.<br> python 以 name -&gt; obj 的形式存储这些变量.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span>
b <span class="token operator">=</span> <span class="token number">2</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span> <span class="token keyword">is</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">i <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">def</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    i <span class="token operator">=</span> <span class="token number">2</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">'local'</span><span class="token punctuation">)</span>
    <span class="token keyword">return</span>
f<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">,</span> <span class="token string">'global'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>2 local
1 global</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">i <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">pass</span>
i  <span class="token comment"># 值被改变了 (“leaking”)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>3</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">i <span class="token operator">=</span> <span class="token number">1</span>
<span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
i  <span class="token comment"># 用这种方式就不会发生“leaking”</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>1</code></pre>
<p>有关函数中的变量作用方式细节, 参考这里提到的例子: <a
href="https://stackoverflow.com/a/575887">stackoverflow</a></p>
<blockquote>
<ul>
<li><p>Any time you see <font color=blue><strong>varname
=</strong></font>, you're <strong>creating a new name</strong> binding
within the function's scope.<br>Whatever value <code>varname</code> was
bound to before is lost within this scope.</p></li>
<li><p>Any time you see
<font color=blue><strong>varname.foo()</strong></font>, you're
<strong>calling a method</strong> on <code>varname</code>. The method
may alter <code>varname</code> (e.g. <code>list.append</code>). <br>
<code>varname</code> (or, rather, the object that <code>varname</code>
names) may exist in more than one scope, and since it's the same object,
<br><strong>any changes will be visible in all scopes</strong>.</p></li>
</ul>
</blockquote>
<h2 id="numpy">NumPy</h2>
<h3 id="numpy-的数据类型-dtype">numpy 的数据类型 dtype</h3>
<p><a href="https://www.tutorialspoint.com/numpy/numpy_data_types.htm"
class="uri">https://www.tutorialspoint.com/numpy/numpy_data_types.htm</a>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int64<span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'i8'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'&lt;i8'</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int64<span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'int'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'int64'</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>int64<span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'>i8'</span><span class="token punctuation">)</span>
<span class="token boolean">False</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'f8'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'&lt;f8'</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'float'</span><span class="token punctuation">)</span> <span class="token keyword">is</span> np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span><span class="token string">'float64'</span><span class="token punctuation">)</span>
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> 见 <a
href="#Fortran-二进制文件读写">Fortran 二进制文件读写</a> 中的应用.</p>
<h3 id="np.arange-参数为浮点数时要注意的细节">np.arange
参数为浮点数时要注意的细节</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">1.8</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span>  <span class="token comment"># 默认不包含 `stop` 这个点</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([0. , 0.3, 0.6, 0.9, 1.2, 1.5])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">2.1</span><span class="token punctuation">,</span> <span class="token number">0.3</span><span class="token punctuation">)</span>  <span class="token comment"># 这里却包括了, 为什么?</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([0. , 0.3, 0.6, 0.9, 1.2, 1.5, 1.8, 2.1])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">'%.16f'</span> <span class="token operator">%</span> <span class="token number">2.1</span>  <span class="token comment"># 因为浮点数计算方式产生的精度问题</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;2.1000000000000001&#39;</code></pre>
<p>看一个求和的例子中同样的问题 (用 <code>list</code> 和
<code>numpy.ndarray</code> 效果一样):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%.17f'</span> <span class="token operator">%</span> <span class="token number">0.1</span><span class="token punctuation">)</span>
<span class="token comment"># sum([0.1, ..., 0.1])</span>

<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%.17f'</span> <span class="token operator">%</span> <span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 因为同样问题, 累积了误差</span>

<span class="token keyword">import</span> math
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'%.17f'</span> <span class="token operator">%</span> math<span class="token punctuation">.</span>fsum<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>0.10000000000000001
0.99999999999999989
1.00000000000000000</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">sum</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>False</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">math<span class="token punctuation">.</span>fsum<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">math<span class="token punctuation">.</span>fsum<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0.1</span><span class="token punctuation">]</span> <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1.0</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<p>参考 <a href="https://docs.python.org/3/tutorial/floatingpoint.html"
class="uri">https://docs.python.org/3/tutorial/floatingpoint.html</a></p>
<p>建议是: 使用整数; 对浮点数的情况, stop 值设得略小一些
(比如减去步长的一般) 以防止改点被包含, 或使用 <code>np.linspace</code>
代替.</p>
<h3 id="矩阵">矩阵</h3>
<p><code>np.matrix</code>(矩阵) 是 <code>np.ndarray</code>(数组)
的一个子类, 继承了父级的方法, 也定义了新的方法 (例如矩阵运算).</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">issubclass</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>matrix<span class="token punctuation">,</span> np<span class="token punctuation">.</span>ndarray<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>matrix([[0, 1, 2],
        [3, 4, 5]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span><span class="token string">"0 1 2; 3 4 5"</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>matrix([[0, 1, 2],
        [3, 4, 5]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">type</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>numpy.matrixlib.defmatrix.matrix</code></pre>
<p><code>np.asmatrix</code> (或简写作 <code>np.mat</code>) 相当于
<code>np.matrix(data, copy=False)</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> np<span class="token punctuation">.</span>matrix<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>
x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>array([[1, 2],
       [3, 4]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
m <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>x<span class="token punctuation">)</span>
m<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">5</span>
x<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>array([[5, 2],
       [3, 4]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x<span class="token punctuation">.</span>__array_interface__<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">==</span> m<span class="token punctuation">.</span>__array_interface__<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<p>注意: <code>np.matrix</code> 既是一个类名也是一个函数名, 而
<code>np.mat</code>, <code>np.asmatrix</code> 只是函数名.</p>
<h3 id="数组和矩阵运算">数组和矩阵运算</h3>
<h4 id="数组运算">数组运算</h4>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">.</span><span class="token builtin">max</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>11</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">*</span> a  <span class="token comment"># 注意这是对应位置的元素间的运算</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[  0,   1,   4,   9],
       [ 16,  25,  36,  49],
       [ 64,  81, 100, 121]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">**</span> <span class="token number">2</span>  <span class="token comment"># 注意这是对应位置的元素间的运算</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[  0,   1,   4,   9],
       [ 16,  25,  36,  49],
       [ 64,  81, 100, 121]])</code></pre>
<h4 id="使用数组进行矩阵运算">使用数组进行矩阵运算</h4>
<p><code>scipy.linalg</code> 与 <code>numpy.linalg</code> 的比较: <a
href="https://scipy.github.io/devdocs/tutorial/linalg.html"
class="uri">https://scipy.github.io/devdocs/tutorial/linalg.html</a>
&gt;* <code>scipy.linalg</code> contains <strong>all</strong> the
functions in <code>numpy.linalg</code> plus some other more
<strong>advanced</strong> ones not contained in
<code>numpy.linalg</code> * Despite its convenience, the use of the
<code>numpy.matrix</code> class is <strong>discouraged</strong>. *
<code>scipy.linalg</code> operations can be applied
<strong>equally</strong> to <code>numpy.matrix</code> or to 2D
<code>numpy.ndarray</code> objects.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>diagflat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[1., 0., 0.],
       [0., 2., 0.],
       [0., 0., 3.]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">b <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[-1., -1., -1.],
       [ 0.,  0.,  0.]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>linalg <span class="token keyword">import</span> inv
inv<span class="token punctuation">(</span>a<span class="token punctuation">)</span>  <span class="token comment"># 求逆</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>array([[ 1.        ,  0.        , -0.        ],
       [ 0.        ,  0.5       , -0.        ],
       [ 0.        ,  0.        ,  0.33333333]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">.</span>dot<span class="token punctuation">(</span>b<span class="token punctuation">.</span>T<span class="token punctuation">)</span>  <span class="token comment"># 矩阵内积</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[-1.,  0.],
       [-2.,  0.],
       [-3.,  0.]])</code></pre>
<h4 id="直接使用矩阵类型进行运算">直接使用矩阵类型进行运算</h4>
<p>使用 numpy 的矩阵类型 <code>numpy.matrix</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>diagflat<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>matrix([[1., 0., 0.],
        [0., 2., 0.],
        [0., 0., 3.]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">b <span class="token operator">=</span> np<span class="token punctuation">.</span>mat<span class="token punctuation">(</span>np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> b<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>matrix([[-1., -1., -1.],
        [ 0.,  0.,  0.]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">*</span> b<span class="token punctuation">.</span>T  <span class="token comment"># 矩阵内积, 注意与数组的运算符定义不同</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>matrix([[-1.,  0.],
        [-2.,  0.],
        [-3.,  0.]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a @ b<span class="token punctuation">.</span>T  <span class="token comment"># 矩阵内积的新写法, python 3.5+</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>matrix([[-1.,  0.],
        [-2.,  0.],
        [-3.,  0.]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">.</span>I  <span class="token comment"># 求逆</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>matrix([[ 1.        ,  0.        , -0.        ],
        [ 0.        ,  0.5       , -0.        ],
        [ 0.        ,  0.        ,  0.33333333]])</code></pre>
<h3 id="用作坐标格点的数组的几种形式">用作坐标格点的数组的几种形式</h3>
<ul>
<li><strong><code>np.meshgrid</code></strong></li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">;</span> x
array<span class="token punctuation">(</span><span class="token punctuation">[</span> <span class="token number">0.</span><span class="token punctuation">,</span>  <span class="token number">1.</span><span class="token punctuation">,</span>  <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">;</span> y
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># X, Y 形状相同: N x M 矩阵, shape=(N, M)</span>
<span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> Y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> X                         <span class="token comment"># X[j, :] 表示同一层 y[j] 对应的不同 x 值</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">#  0_____x</span>
       <span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">#  |</span>
       <span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment">#  |y</span>
       <span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> Y
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">3.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>          <span class="token comment"># Y[:, i] 表示同一层 x[i] 对应的不同 y 值</span>
       <span class="token punctuation">[</span><span class="token number">4.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">6.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>可用来计算坐标的函数 (例如磁场的表达式等等, 见 <a
href="examples/streamplot.py">examples/streamplot.py</a> )
<pre class="line-numbers language-python" data-language="python"><code class="language-python">U <span class="token operator">=</span>   <span class="token punctuation">(</span>np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>k1 <span class="token operator">*</span> X<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>k1 <span class="token operator">*</span> Y<span class="token punctuation">)</span>
     <span class="token operator">-</span> np<span class="token punctuation">.</span>cos<span class="token punctuation">(</span>k2 <span class="token operator">*</span> X<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>k2 <span class="token operator">*</span> Y<span class="token punctuation">)</span><span class="token punctuation">)</span>
V <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">-</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>k1 <span class="token operator">*</span> X<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>k1 <span class="token operator">*</span> Y<span class="token punctuation">)</span>
     <span class="token operator">+</span> np<span class="token punctuation">.</span>sin<span class="token punctuation">(</span>k2 <span class="token operator">*</span> X<span class="token punctuation">)</span> <span class="token operator">*</span> np<span class="token punctuation">.</span>exp<span class="token punctuation">(</span><span class="token operator">-</span>k2 <span class="token operator">*</span> Y<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
y <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
X<span class="token punctuation">,</span> Y <span class="token operator">=</span> np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> indexing<span class="token operator">=</span><span class="token string">'ij'</span><span class="token punctuation">)</span>
Y<span class="token punctuation">.</span>shape<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>(3, 4)</code></pre>
<ul>
<li><strong><code>np.mgrid</code></strong></li>
</ul>
<p><code>j</code> 标记默认是虚数单位,
但在这里表示前面的数字是格点数.<br> 格点数使用变量
<em><code>n</code></em> 时, 可写成:
<em><code>n</code></em><code>*1j + 1j</code>, 1不能省
(否则j定义为变量)<br> 类似的 <code>np.ogrid</code> 可参见 numpy
相关文档</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> x <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> y <span class="token operator">=</span> np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>

<span class="token comment"># 下面三行等价</span>
<span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> Y <span class="token operator">=</span> np<span class="token punctuation">.</span>mgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">3j</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token number">6</span><span class="token punctuation">:</span><span class="token number">4j</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> Y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span>i<span class="token punctuation">.</span>astype<span class="token punctuation">(</span>np<span class="token punctuation">.</span>float64<span class="token punctuation">)</span> <span class="token keyword">for</span> i <span class="token keyword">in</span> np<span class="token punctuation">.</span>mgrid<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> X<span class="token punctuation">,</span> Y <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span>np<span class="token punctuation">.</span>meshgrid<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> indexing<span class="token operator">=</span><span class="token string">'ij'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># np.mgrid[0:2:3j, 3:6:4j] 得到的数据类型为 'float64'</span>
<span class="token comment"># np.mgrid[0:3, 3:6] 得到的数据类型为 'int64'</span>
<span class="token comment"># np.meshgrid(x, y, indexing='ij') 得到一个 list, 数据格式同x, y</span>

<span class="token comment"># X, Y 形状相同: M x N 矩阵, shape=(M, N)</span>
<span class="token operator">>></span><span class="token operator">></span> X                      <span class="token comment"># X[i, :] 表示 x[i]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">,</span> <span class="token number">0.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">#  0_____y</span>
       <span class="token punctuation">[</span><span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">,</span> <span class="token number">1.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>   <span class="token comment">#  |</span>
       <span class="token punctuation">[</span><span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">,</span> <span class="token number">2.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment">#  |x</span>
<span class="token operator">>></span><span class="token operator">></span> Y                      <span class="token comment"># Y[:, j] 表示 y[j]</span>
array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
       <span class="token punctuation">[</span><span class="token number">3.</span><span class="token punctuation">,</span> <span class="token number">4.</span><span class="token punctuation">,</span> <span class="token number">5.</span><span class="token punctuation">,</span> <span class="token number">6.</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="mask">mask</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">9</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[0, 1, 2],
       [3, 4, 5],
       [6, 7, 8]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">></span> <span class="token number">4</span>  <span class="token comment"># mask</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[False, False, False],
       [False, False,  True],
       [ True,  True,  True]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">4</span><span class="token punctuation">)</span>  <span class="token comment"># 得到 tuple(col_indexs, row_indexs)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>(array([1, 2, 2, 2]), array([2, 0, 1, 2]))</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">zip</span><span class="token punctuation">(</span><span class="token operator">*</span>np<span class="token punctuation">.</span>where<span class="token punctuation">(</span>a <span class="token operator">></span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 也可以用 np.array(np.where(a > 4)).T</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>[(1, 2), (2, 0), (2, 1), (2, 2)]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">[</span>a <span class="token operator">></span> <span class="token number">4</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span> a  <span class="token comment"># same as a[np.where(a > 4)]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[ 0,  1,  2],
       [ 3,  4, -1],
       [-1, -1, -1]])</code></pre>
<h3 id="其他对数组元素的处理">其他对数组元素的处理</h3>
<p>处理含有 NaN 的数据:</p>
<p>e.g. 求最值可使用 <code>np.nanmin(...)</code> 和
<code>np.nanmax(...)</code></p>
<h2 id="matplotlib">Matplotlib</h2>
<ul>
<li>官方教程 <a
href="https://matplotlib.org/tutorials/introductory/usage.html"
class="uri">https://matplotlib.org/tutorials/introductory/usage.html</a></li>
</ul>
<p><img src='/advance/anatomy.png' width='600' /></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token comment"># current figure</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># current `Axes`</span>
im <span class="token operator">=</span> plt<span class="token punctuation">.</span>gci<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># current artist(图像内容), 可由诸如 plt.imshow(...) 得到</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<ul>
<li><p>得到当前 backend: <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token operator">>></span><span class="token operator">></span> plt<span class="token punctuation">.</span>get_backend<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre> 或 <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> maplotlib <span class="token keyword">as</span> mpl
<span class="token operator">>></span><span class="token operator">></span> mpl<span class="token punctuation">.</span>get_backend<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li>
<li><p>选择 backend (在导入其他 matplotlib 模块之前):
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> matplotlib
<span class="token operator">>></span><span class="token operator">></span> matplotlib<span class="token punctuation">.</span>use<span class="token punctuation">(</span><span class="token string">'TkAgg'</span><span class="token punctuation">)</span>  <span class="token comment"># 'Qt5Agg', 'TkAgg', 'Agg', ...</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li>
<li><p>用户配置文档 <code>matplotlibrc</code><br> 通常的位置:
<code>~/.config/matplotlib/matplotlibrc</code> (Linux)</p></li>
<li><p>用 <code>zorder</code> 来控制图层:</p></li>
</ul>
<p>这个例子中也展示了加入一个动态的竖线的方法,
这条线在保存后的图像中不会显示.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>matplotlib
<span class="token operator">%</span>run <span class="token operator">-</span>e <span class="token string">'examples/test_plot.py'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>使用 <a
href="https://github.com/joferkington/mpldatacursor">这个工具</a>
动态标注光标位置的值:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>matplotlib
<span class="token operator">%</span>run <span class="token operator">-</span>e <span class="token string">'examples/test_imshow.py'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>点击图像后在命令行显示光标处信息的例子</li>
</ul>
<p>命令行脚本: <a
href="examples/test_imshow_click.py">examples/test_imshow_click.py</a>
(jupyter 中无法使用)</p>
<ul>
<li>布局问题 <a
href="https://matplotlib.org/tutorials/intermediate/constrainedlayout_guide.html"
class="uri">https://matplotlib.org/tutorials/intermediate/constrainedlayout_guide.html</a></li>
<li>绘制平行投影的3D图 <a
href="https://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html"
class="uri">https://matplotlib.org/mpl_toolkits/mplot3d/tutorial.html</a></li>
<li>更复杂的 3D 可转存可视化数据用其他软件或使用 Mayavi
(http://docs.enthought.com/mayavi/mayavi)</li>
</ul>
<h2 id="sunpy-示例">SunPy 示例</h2>
<h3 id="示例文件">示例文件</h3>
<ul>
<li><p>读取 fits, submap, 作图 <a
href="https://lydiazly.coding.me/python-notes/example_plothmi.html">example_plothmi</a></p></li>
<li><p>投影 <a
href="https://lydiazly.coding.me/python-notes/example_projection.html">example_projection</a></p></li>
<li><p>下载数据 <a
href="https://lydiazly.coding.me/python-notes/fido.html">fido</a>, <a
href="https://lydiazly.coding.me/python-notes/jsoc.html">jsoc</a></p></li>
</ul>
<p>注意: 这些例子只是提供一个使用参考, 不一定是最优的.</p>
<h3 id="示例中的-fits-读取方法">示例中的 fits 读取方法</h3>
<p>更多 FITS 的读取方法参见 <a href="main.html#FITS-文件读取">Python
简易教程#FITS-文件读取</a><br> 另见 <a
href="http://docs.astropy.org/en/stable/io/fits/usage/scripts.html">Astropy
的命令行工具</a></p>
<p>读取<code>HMIMap</code> 的例子:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 导入 `sunpy.map` 的时间会略有点长</span>
<span class="token keyword">import</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span>
smap <span class="token operator">=</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">.</span>Map<span class="token punctuation">(</span><span class="token string">'data/hmi.B_720s.20150827_052400_TAI.field.fits'</span><span class="token punctuation">)</span>
<span class="token builtin">type</span><span class="token punctuation">(</span>smap<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>sunpy.map.sources.sdo.HMIMap</code></pre>
<p>这是 <code>GenericMap</code> 的一个子类:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">issubclass</span><span class="token punctuation">(</span>sunpy<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">.</span>sources<span class="token punctuation">.</span>sdo<span class="token punctuation">.</span>HMIMap<span class="token punctuation">,</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">.</span>mapbase<span class="token punctuation">.</span>GenericMap<span class="token punctuation">)</span>
<span class="token boolean">True</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta  <span class="token comment"># headers</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">type</span><span class="token punctuation">(</span>smap<span class="token punctuation">.</span>data<span class="token punctuation">)</span>  <span class="token comment"># 索引从 0 开始</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>numpy.ndarray</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape  <span class="token comment"># (dimy, dimx)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>(4096, 4096)</code></pre>
<p><code>smap.data[i, j]</code> 中的 i 为 Y 轴, 单位为 pixel:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
plt<span class="token punctuation">.</span>imshow<span class="token punctuation">(</span>smap<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">,</span> origin<span class="token operator">=</span><span class="token string">'lower'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
plt<span class="token punctuation">.</span>show<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<figure>
<img src="/advance/advance_205_0.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<h3 id="关于-scaled-image-data">关于 Scaled Image Data</h3>
<p>这一部分将更仔细地检查 Astropy 对示例中的 FITS 文件的处理.</p>
<p>参见 <a
href="http://docs.astropy.org/en/stable/io/fits/usage/image.html#scaled-data"
class="uri">http://docs.astropy.org/en/stable/io/fits/usage/image.html#scaled-data</a></p>
<blockquote>
<p>Images are scaled only when either of the BSCALE/BZERO keywords are
present in the header and either of their values is not the default
value (BSCALE=1, BZERO=0).</p>
</blockquote>
<p>由于 <code>astropy.io.fits</code> 的特性, 读取 'Scaled Image Data'
时, 调用 <code>.data</code> 将自动对数据进行缩放: <pre class="line-numbers language-python" data-language="python"><code class="language-python">physical value <span class="token operator">=</span> BSCALE <span class="token operator">*</span> <span class="token punctuation">(</span>storage value<span class="token punctuation">)</span> <span class="token operator">+</span> BZERO<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<code>astropy.io.fits.open</code> 中使用
<code>do_not_scale_image_data=True</code> 可禁用这一步骤.</p>
<p>见 <a
href="http://docs.astropy.org/en/stable/io/fits/appendix/faq.html#why-is-an-image-containing-integer-data-being-converted-unexpectedly-to-floats">astropy.io.fits
FAQ</a></p>
<p>数据类型:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: center;">BITPIX</th>
<th style="text-align: left;">Numpy Data Type</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: center;">8</td>
<td style="text-align: left;">numpy.uint8 (unsigned integer)</td>
</tr>
<tr class="even">
<td style="text-align: center;">16</td>
<td style="text-align: left;">numpy.int16</td>
</tr>
<tr class="odd">
<td style="text-align: center;">32</td>
<td style="text-align: left;">numpy.int32</td>
</tr>
<tr class="even">
<td style="text-align: center;">-32</td>
<td style="text-align: left;">numpy.float32</td>
</tr>
<tr class="odd">
<td style="text-align: center;">-64</td>
<td style="text-align: left;">numpy.float64</td>
</tr>
</tbody>
</table>
<p>可以使用 Astropy 的命令行工具在 shell 中查看信息:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fname <span class="token operator">=</span> <span class="token string">'data/hmi.B_720s.20150827_052400_TAI.field.fits'</span>
!fitsinfo <span class="token punctuation">&#123;</span>fname<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>Filename: data/hmi.B_720s.20150827_052400_TAI.field.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU       6   ()      
  1                1 CompImageHDU    155   (4096, 4096)   int32   </code></pre>
<p>可以看到该文件存储的数据类型是整形.</p>
<p>用命令行工具查看关键字 'BITPIX':</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">!fitsheader <span class="token operator">-</span>e <span class="token number">1</span> <span class="token operator">-</span><span class="token operator">-</span>keyword BITPIX <span class="token punctuation">&#123;</span>fname<span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code># HDU 1 in data/hmi.B_720s.20150827_052400_TAI.field.fits:
BITPIX  =                   32 / data type of original image                    </code></pre>
<p>使用 <code>astropy.io.fits</code>:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> astropy<span class="token punctuation">.</span>io <span class="token keyword">import</span> fits
hdulist <span class="token operator">=</span> fits<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
hdu <span class="token operator">=</span> hdulist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'BITPIX'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>32</code></pre>
<p>'BSCALE' 不为零则为 'scaled':</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'BSCALE'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0.01</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'BZERO'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0.0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdulist<span class="token punctuation">.</span>verify<span class="token punctuation">(</span><span class="token string">'silentfix+warn'</span><span class="token punctuation">)</span>  <span class="token comment"># 调用 `.data` 时如果出错, 需要先进行这一步修复</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>data<span class="token punctuation">.</span>dtype  <span class="token comment"># 已自动变换为 'physical value', 同时 `.header` 将被修改</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>dtype(&#39;float64&#39;)</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>142.83</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># -2147483648 被转为 nan</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>nan</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'BITPIX'</span><span class="token punctuation">]</span>  <span class="token comment"># 值被改变了. 同时 'BSCALE', 'BZERO' 被删除</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>-64</code></pre>
<p>手动 scale:</p>
<p>'BSCALE' 虽然之前已被删除, 但值仍存储在 <code>._orig_bscale</code>
中. <code>.scale</code> 将使用这个值.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>scale<span class="token punctuation">(</span><span class="token string">'int32'</span><span class="token punctuation">)</span>  <span class="token comment"># 在此之后 `.data` 将变换回 'storage value'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>_orig_bscale<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0.01</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>_orig_bzero<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>14283</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>  <span class="token comment"># nan 被转为 -2147483648</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>-2147483648</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdu<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'BITPIX'</span><span class="token punctuation">]</span>  <span class="token comment"># 值再次被改变了</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>32</code></pre>
<p>使用 SunPy 处理时, 'BITPIX', 'BSCALE', 'BZERO' 的值被保留,
<code>.data</code> 仍进行了 scale 的过程.</p>
<p>针对不同文件, 如果 SunPy 的程序内部使用 <code>astropy.io.fits</code>
处理文件时调用了 <code>.data</code> 再返回 header, 即
<code>astropy.io.fits</code> 已经如上所述改变了 header, 那么 SunPy
所返回的 header 中 'BITPIX', 'BSCALE', 'BZERO' 可能已经被改变.</p>
<p>下面的例子中得到的 header 是最初的值:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span>
smap <span class="token operator">=</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">.</span>Map<span class="token punctuation">(</span><span class="token string">'data/hmi.B_720s.20150827_052400_TAI.field.fits'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'BITPIX'</span><span class="token punctuation">]</span>  <span class="token comment"># 得到的是未被改变的 header</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>32</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'BSCALE'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0.01</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'BZERO'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0.0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token number">1000</span><span class="token punctuation">,</span> <span class="token number">1000</span><span class="token punctuation">]</span>  <span class="token comment"># 这一步并不改变 `.meta` 的值</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>142.83</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'BITPIX'</span><span class="token punctuation">]</span>  <span class="token comment"># 不变</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>32</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'BSCALE'</span><span class="token punctuation">]</span>  <span class="token comment"># 不变</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0.01</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'BZERO'</span><span class="token punctuation">]</span>  <span class="token comment"># 不变</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0.0</code></pre>
<h3 id="坐标和单位">坐标和单位</h3>
<p><strong>SunPy map</strong> <a
href="http://docs.sunpy.org/en/stable/code_ref/map.html#using-map-objects"
class="uri">http://docs.sunpy.org/en/stable/code_ref/map.html#using-map-objects</a>
&gt;A number of the <strong>properties</strong> of this class are
returned as <strong>two-value named tuples</strong> that can either be -
indexed by
position: <strong><font color=blue>[0]</font>, <font color=blue>[1]</font></strong>
- be accessed by the names: - pixel
axes: <strong><font color=blue>.x</font>, <font color=blue>.y</font></strong><br>
x and y refer to the FITS axes (x for columns y for rows) - spatial
axes: <strong><font color=blue>.axis1</font>, <font color=blue>.axis2</font></strong><br>
axis1 corresponds to the coordinate axis for x and axis2 corresponds to
y.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>dimensions<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>PixelPair(x=&lt;Quantity 4096. pix&gt;, y=&lt;Quantity 4096. pix&gt;)</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>dimensions<span class="token punctuation">.</span>x  <span class="token comment"># 得到一个 `astropy.units.quantity.Quantity`, 包含 value 和 unit</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>(4096 ; )</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>dimensions<span class="token punctuation">.</span>x<span class="token punctuation">.</span>unit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>()</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>dimensions<span class="token punctuation">.</span>x<span class="token punctuation">.</span>value<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>4096.0</code></pre>
<p><code>astropy.units</code> 的使用方法:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> astropy<span class="token punctuation">.</span>units <span class="token keyword">as</span> u<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">u<span class="token punctuation">.</span>AA<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>()</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">4096</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>pix  <span class="token comment"># same as `u.pixel`</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>(4096 ; )</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>pix  <span class="token comment"># 注意这里是 `astropy.units` 的运算, 和 list 运算规则不同</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>([4096,~4096] ; )</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>dimensions<span class="token punctuation">.</span>x<span class="token punctuation">.</span>unit <span class="token keyword">is</span> u<span class="token punctuation">.</span>pix  <span class="token comment"># 说明 x 是单位是 u.pix</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">type</span><span class="token punctuation">(</span>smap<span class="token punctuation">.</span>center<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>/home/lydia/miniconda3/lib/python3.6/site-packages/sunpy/map/mapbase.py:669: Warning: Missing metadata for heliographic longitude: assuming longitude of 0 degrees
  lon=self.heliographic_longitude,





astropy.coordinates.sky_coordinate.SkyCoord</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>pix<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>[&lt;Quantity 0. pix&gt;, &lt;Quantity 0. pix&gt;]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>pixel_to_world<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">4096</span><span class="token punctuation">,</span> <span class="token number">4096</span><span class="token punctuation">)</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>pix<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&lt;SkyCoord (Helioprojective: obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;): (Tx, Ty) in arcsec
    (-1040.36199634, -1030.86554911)&gt;</code></pre>
<p>查看 <code>SkyCoord</code> 的帮助:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> astropy<span class="token punctuation">.</span>coordinates
<span class="token builtin">help</span><span class="token punctuation">(</span>astropy<span class="token punctuation">.</span>coordinates<span class="token punctuation">.</span>sky_coordinate<span class="token punctuation">.</span>SkyCoord<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>center<span class="token punctuation">.</span>Tx<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>()</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>pixel_to_world<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>pix<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&lt;SkyCoord (Helioprojective: obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;): (Tx, Ty) in arcsec
    (16.55031204, 26.53575639)&gt;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>pixel_to_world<span class="token punctuation">(</span><span class="token operator">*</span><span class="token punctuation">(</span><span class="token number">2000</span><span class="token punctuation">,</span> <span class="token number">2000</span><span class="token punctuation">)</span> <span class="token operator">*</span> u<span class="token punctuation">.</span>pix<span class="token punctuation">)</span><span class="token punctuation">.</span>transform_to<span class="token punctuation">(</span><span class="token string">'heliographic_stonyhurst'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&lt;SkyCoord (HeliographicStonyhurst: obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, km)
    (1.00568591, 8.68202918, 696000.0000022)&gt;</code></pre>
<p>查看坐标信息:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>coordinate_frame<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>/home/lydia/miniconda3/lib/python3.6/site-packages/sunpy/map/mapbase.py:669: Warning: Missing metadata for heliographic longitude: assuming longitude of 0 degrees
  lon=self.heliographic_longitude,





&lt;Helioprojective Frame (obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;)&gt;</code></pre>
<p>出现这个 Warning 时:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'hgln_obs'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.</span><span class="token punctuation">;</span> smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'hgln_obs'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.</span><span class="token punctuation">;</span> smap<span class="token punctuation">.</span>meta<span class="token punctuation">[</span><span class="token string">'hgln_obs'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token number">0.</span>
smap<span class="token punctuation">.</span>coordinate_frame<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&lt;Helioprojective Frame (obstime=2015-08-27 05:22:21.800000, rsun=696000000.0 m, observer=&lt;HeliographicStonyhurst Coordinate (obstime=2015-08-27 05:22:21.800000): (lon, lat, radius) in (deg, deg, m)
    (0., 7.089004, 1.51196988e+11)&gt;)&gt;</code></pre>
<h3 id="语法对比">语法对比</h3>
<p>比较 <code>plothmi.py</code> 与对应 IDL 程序的语法:</p>
<p>下面的语句中, 为了简便和方便对比, 使用了自定义的一些函数. 导入方法:
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> usr_sunpy <span class="token keyword">import</span> read_sdo<span class="token punctuation">,</span> plot_map<span class="token punctuation">,</span> plot_vmap<span class="token punctuation">,</span> image_to_helio<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>读取数据 <pre class="line-numbers language-idl" data-language="idl"><code class="language-idl">; IDL
read_sdo,&lt;fname&gt;,index,data
index2map,index,data,mapa<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Python</span>
<span class="token comment"># 为简化过程而自定义的函数, 读入时打印文件名和数组大小</span>
mapa <span class="token operator">=</span> read_sdo<span class="token punctuation">(</span><span class="token operator">&lt;</span>fname<span class="token operator">></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>旋转 <pre class="line-numbers language-idl" data-language="idl"><code class="language-idl">; IDL
; 2 表示180°
mapbx.data &#x3D; rotate(mapbx,2)
mapby.data &#x3D; rotate(mapbx,2)
mapbz.data &#x3D; rotate(mapbx,2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Python</span>
<span class="token comment"># 利用 'crota2' 的值确定角度</span>
mapbx <span class="token operator">=</span> mapbx<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>order<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
mapby <span class="token operator">=</span> mapby<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>order<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span>
mapbz <span class="token operator">=</span> mapbz<span class="token punctuation">.</span>rotate<span class="token punctuation">(</span>order<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>截取 <pre class="line-numbers language-idl" data-language="idl"><code class="language-idl">; IDL
sub_map,mapbx,smapbx,xrange&#x3D;[500,800.0],yrange&#x3D;[-500,-100.0]
sub_map,mapby,smapby,ref_map&#x3D;smapbx
sub_map,mapbz,smapbz,ref_map&#x3D;smapbx<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Python</span>
<span class="token comment"># 左下到右上</span>
bl <span class="token operator">=</span> SkyCoord<span class="token punctuation">(</span><span class="token number">500</span><span class="token operator">*</span>u<span class="token punctuation">.</span>arcsec<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">500</span><span class="token operator">*</span>u<span class="token punctuation">.</span>arcsec<span class="token punctuation">,</span> frame<span class="token operator">=</span>mapbz<span class="token punctuation">.</span>coordinate_frame<span class="token punctuation">)</span>
tr <span class="token operator">=</span> SkyCoord<span class="token punctuation">(</span><span class="token number">800</span><span class="token operator">*</span>u<span class="token punctuation">.</span>arcsec<span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">100.</span><span class="token operator">*</span>u<span class="token punctuation">.</span>arcsec<span class="token punctuation">,</span> frame<span class="token operator">=</span>mapbz<span class="token punctuation">.</span>coordinate_frame<span class="token punctuation">)</span>
smapbx <span class="token operator">=</span> mapbx<span class="token punctuation">.</span>submap<span class="token punctuation">(</span>bl<span class="token punctuation">,</span> tr<span class="token punctuation">)</span>
smapby <span class="token operator">=</span> mapby<span class="token punctuation">.</span>submap<span class="token punctuation">(</span>bl<span class="token punctuation">,</span> tr<span class="token punctuation">)</span>
smapbz <span class="token operator">=</span> mapbz<span class="token punctuation">.</span>submap<span class="token punctuation">(</span>bl<span class="token punctuation">,</span> tr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>绘图 <pre class="line-numbers language-idl" data-language="idl"><code class="language-idl">; IDL
plot_map,smapbz,dmax&#x3D;2000,dmin&#x3D;-2000,color&#x3D;0,charsize&#x3D;1.8,...
plot_vmap,&#x2F;over,smapbx,smapby,mapbz&#x3D;smapbz,limit&#x3D;180,scale&#x3D;0.012,iskip&#x3D;15,jskip&#x3D;15,...<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Python</span>
<span class="token comment"># 主要调用的是 matplotlib</span>
fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> projection<span class="token operator">=</span>smapbz<span class="token punctuation">)</span> <span class="token comment"># 使用 smapbz 中定义的坐标系统</span>
plot_map<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> smapbz<span class="token punctuation">)</span>
plot_vmap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> smapbx<span class="token punctuation">,</span> smapby<span class="token punctuation">,</span> smapbz<span class="token punctuation">,</span> iskip<span class="token operator">=</span>iskip<span class="token punctuation">,</span> jskip<span class="token operator">=</span>jskip<span class="token punctuation">,</span> cmin<span class="token operator">=</span><span class="token number">100.</span><span class="token punctuation">,</span> vmax<span class="token operator">=</span><span class="token number">500.</span><span class="token punctuation">,</span> cmap<span class="token operator">=</span><span class="token string">'binary'</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>坐标变换 <pre class="line-numbers language-idl" data-language="idl"><code class="language-idl">; IDL
; magnetic_modeling_codes&#x2F;...&#x2F;05projection_modified_version.pro<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Python</span>
<span class="token comment"># `image_to_helio`(变换为 Helioprojective(Cartesian) system)</span>
<span class="token comment"># 调用自定义的旋转矩阵函数 `proj_matrix`, 参考文献与原IDL程序相同</span>
hx<span class="token punctuation">,</span> hy <span class="token operator">=</span> image_to_helio<span class="token punctuation">(</span>smapbz<span class="token punctuation">)</span>  <span class="token comment"># numpy 数组</span>
smapbx_h<span class="token punctuation">,</span> smapby_h<span class="token punctuation">,</span> smapbz_h <span class="token operator">=</span> image_to_helio<span class="token punctuation">(</span>smapbx<span class="token punctuation">,</span> smapby<span class="token punctuation">,</span> smapbz<span class="token punctuation">)</span> <span class="token comment"># sunpy `Map`</span>

plot_map<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> smapbz_h<span class="token punctuation">,</span> coords<span class="token operator">=</span><span class="token punctuation">(</span>hx<span class="token punctuation">,</span> hy<span class="token punctuation">)</span><span class="token punctuation">)</span>
plot_vmap<span class="token punctuation">(</span>ax<span class="token punctuation">,</span> smapbx_h<span class="token punctuation">,</span> smapby_h<span class="token punctuation">,</span> smapbz_h<span class="token punctuation">,</span> coords<span class="token operator">=</span><span class="token punctuation">(</span>hx<span class="token punctuation">,</span> hy<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="插值-拟合">插值, 拟合</h2>
<p>选择不限于这里列举的包, 以后也可能会有更合适的方法出现.</p>
<p>相关安装见 <a href="installpy.html#其他">Python 安装和配置</a></p>
<h3 id="插值">插值</h3>
<ul>
<li><p>numpy <pre class="line-numbers language-none"><code class="language-none">f &#x3D; interp1d(x, y, kind&#x3D;&#39;cubic&#39;[, fill_value&#x3D;&#39;extrapolate&#39;])
x2 &#x3D; np.linspace(...)
y2 &#x3D; f(x2)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre> 见 <a
href="examples/test_plot.py">examples/test_plot.py</a></p></li>
<li><p>scipy <a
href="https://docs.scipy.org/doc/scipy/reference/tutorial/interpolate.html"
class="uri">https://docs.scipy.org/doc/scipy/reference/tutorial/interpolate.html</a></p></li>
</ul>
<h3 id="求极值">求极值</h3>
<ul>
<li>PeakUtils <a href="http://peakutils.readthedocs.io/en/latest/"
class="uri">http://peakutils.readthedocs.io/en/latest/</a></li>
</ul>
<p>官方例图
(http://peakutils.readthedocs.io/en/latest/tutorial_a.html):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> peakutils
indexes <span class="token operator">=</span> peakutils<span class="token punctuation">.</span>indexes<span class="token punctuation">(</span>y<span class="token punctuation">,</span> thres<span class="token operator">=</span><span class="token number">0.5</span><span class="token punctuation">,</span> min_dist<span class="token operator">=</span><span class="token number">30</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><img src='/advance/tut_a_2.png' width='500' /></p>
<p>Enhancing the resolution by interpolation: <pre class="line-numbers language-python" data-language="python"><code class="language-python">peaks_x <span class="token operator">=</span> peakutils<span class="token punctuation">.</span>interpolate<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> ind<span class="token operator">=</span>indexes<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<h3 id="拟合">拟合</h3>
<ul>
<li>LMFIT (Non-Linear Least-Squares Minimization and Curve-Fitting)</li>
</ul>
<p>下载 <a href="https://github.com/lmfit/lmfit-py"
class="uri">https://github.com/lmfit/lmfit-py</a></p>
<p>文档 <a href="http://lmfit.github.io/lmfit-py/"
class="uri">http://lmfit.github.io/lmfit-py/</a></p>
<p>有现成模型, 也可以自定义模型.<br>
可以方便地叠加不同拟合模型(比如多个高斯, 线性加高斯, 等等).<br> 例子见
<a href="examples/lmfits.zip">examples/lmfits</a> (来自 <a
href="http://lmfit.github.io/lmfit-py/builtin_models.html#example-1-fit-peak-data-to-gaussian-lorentzian-and-voigt-profiles">LMFIT网站示例</a>
)</p>
<p>使用内置模型:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> lmfit<span class="token punctuation">.</span>models <span class="token keyword">import</span> GaussianModel  <span class="token comment"># 内置的模型</span>

data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'test_peak.dat'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>

mod <span class="token operator">=</span> GaussianModel<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 实例化一个模型</span>
pars <span class="token operator">=</span> mod<span class="token punctuation">.</span>guess<span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token operator">=</span>x<span class="token punctuation">)</span>  <span class="token comment"># 给初值</span>
out <span class="token operator">=</span> mod<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pars<span class="token punctuation">,</span> x<span class="token operator">=</span>x<span class="token punctuation">)</span>  <span class="token comment"># 拟合结果</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>fit_report<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 拟合结果的详细信息</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> out<span class="token punctuation">.</span>init_fit<span class="token punctuation">,</span> <span class="token string">'k--'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> out<span class="token punctuation">.</span>best_fit<span class="token punctuation">,</span> <span class="token string">'r-'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>matplotlib inline
<span class="token operator">%</span>run examples<span class="token operator">/</span>lmfits<span class="token operator">/</span>fit_peak<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>[[Model]]
    Model(voigt)
[[Fit Statistics]]
    # fitting method   = leastsq
    # function evals   = 21
    # data points      = 401
    # variables        = 4
    chi-square         = 10.9301767
    reduced chi-square = 0.02753193
    Akaike info crit   = -1436.57602
    Bayesian info crit = -1420.60017
[[Variables]]
    sigma:      0.89518909 +/- 0.01415450 (1.58%) (init = 0.8775)
    center:     9.24374847 +/- 0.00441903 (0.05%) (init = 9.25)
    amplitude:  34.1914737 +/- 0.17946860 (0.52%) (init = 65.43358)
    gamma:      0.52540198 +/- 0.01857955 (3.54%) (init = 0.7)
    fwhm:       3.22385343 +/- 0.05097475 (1.58%) == &#39;3.6013100*sigma&#39;
    height:     10.0872204 +/- 0.03482130 (0.35%) == &#39;amplitude*wofz((1j*gamma)/(sigma*sqrt(2))).real/(sigma*sqrt(2*pi))&#39;
[[Correlations]] (unreported correlations are &lt; 0.100)
    C(sigma, gamma)     = -0.928
    C(amplitude, gamma) =  0.821
    C(sigma, amplitude) = -0.651</code></pre>
<figure>
<img src="/advance/advance_279_1.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<p>多个模型叠加:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> lmfit<span class="token punctuation">.</span>models <span class="token keyword">import</span> ExponentialModel<span class="token punctuation">,</span> GaussianModel

data <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span><span class="token string">'NIST_Gauss2.dat'</span><span class="token punctuation">)</span>
x <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">]</span>
y <span class="token operator">=</span> data<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>

exp_mod <span class="token operator">=</span> ExponentialModel<span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">'exp_'</span><span class="token punctuation">)</span>
gauss1 <span class="token operator">=</span> GaussianModel<span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">'g1_'</span><span class="token punctuation">)</span>
gauss2 <span class="token operator">=</span> GaussianModel<span class="token punctuation">(</span>prefix<span class="token operator">=</span><span class="token string">'g2_'</span><span class="token punctuation">)</span>

pars1 <span class="token operator">=</span> exp_mod<span class="token punctuation">.</span>guess<span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token operator">=</span>x<span class="token punctuation">)</span>  <span class="token comment"># 分段设参数的方法见下面的脚本文件</span>
pars2 <span class="token operator">=</span> gauss1<span class="token punctuation">.</span>guess<span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token operator">=</span>x<span class="token punctuation">)</span>
pars3 <span class="token operator">=</span> gauss2<span class="token punctuation">.</span>guess<span class="token punctuation">(</span>y<span class="token punctuation">,</span> x<span class="token operator">=</span>x<span class="token punctuation">)</span>

pars <span class="token operator">=</span> pars1 <span class="token operator">+</span> pars2 <span class="token operator">+</span> pars3  <span class="token comment"># 叠加参数</span>
mod <span class="token operator">=</span> gauss1 <span class="token operator">+</span> gauss2 <span class="token operator">+</span> exp_mod  <span class="token comment"># 叠加模型</span>

out <span class="token operator">=</span> mod<span class="token punctuation">.</span>fit<span class="token punctuation">(</span>y<span class="token punctuation">,</span> pars<span class="token punctuation">,</span> x<span class="token operator">=</span>x<span class="token punctuation">)</span>

<span class="token keyword">print</span><span class="token punctuation">(</span>out<span class="token punctuation">.</span>fit_report<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token string">'b'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> out<span class="token punctuation">.</span>init_fit<span class="token punctuation">,</span> <span class="token string">'k--'</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>plot<span class="token punctuation">(</span>x<span class="token punctuation">,</span> out<span class="token punctuation">.</span>best_fit<span class="token punctuation">,</span> <span class="token string">'r-'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>capture output
<span class="token operator">%</span>matplotlib inline
<span class="token operator">%</span>run examples<span class="token operator">/</span>lmfits<span class="token operator">/</span>fit_peaks<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">output<span class="token punctuation">.</span>outputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<figure>
<img src="/advance/advance_283_0.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>capture output
<span class="token operator">%</span>matplotlib inline
<span class="token operator">%</span>run examples<span class="token operator">/</span>lmfits<span class="token operator">/</span>fit_peaks_components<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">output<span class="token punctuation">.</span>outputs<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<figure>
<img src="/advance/advance_285_0.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<p>自定义模型的方法见 <a
href="http://lmfit.github.io/lmfit-py/builtin_models.html#user-defined-models">LMFIT网站示例</a></p>
<h3 id="其他">其他</h3>
<ul>
<li>Sherpa(Modeling and Fitting) <a
href="http://cxc.cfa.harvard.edu/contrib/sherpa/"
class="uri">http://cxc.cfa.harvard.edu/contrib/sherpa/</a><br></li>
<li>2-D Fitting in Sherpa <a
href="https://python4astronomers.github.io/fitting/image.html"
class="uri">https://python4astronomers.github.io/fitting/image.html</a><br></li>
<li><em>etc.</em></li>
</ul>
<h2 id="copy-注意事项">copy 注意事项</h2>
<p><strong>"shallow copy"</strong> vs <strong>"deep copy"</strong></p>
<ul>
<li>对于 list 的情况</li>
</ul>
<p>演示插件 <a href="https://github.com/lgpage/nbtutor"
class="uri">https://github.com/lgpage/nbtutor</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f <span class="token operator">-</span>i
<span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy
a <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span>
b <span class="token operator">=</span> a
c <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
d <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># 列表的切片是深拷贝</span>
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
d<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>23284866388232 23284866388232 23284855519880 23284856061064</code></pre>
<p><a href="http://t.cn/RgK1OHf">网页版演示</a></p>
<p><img src='/advance/nbtutor3.png' width='550'/></p>
<ul>
<li>对于 dict 的情况</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f <span class="token operator">-</span>i
<span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy
a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">&#125;</span>
b <span class="token operator">=</span> a
c <span class="token operator">=</span> a<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 深拷贝</span>
d <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
b<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
c<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
d<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>22492371132064 22492371132064 22492397510376 22492397507280</code></pre>
<p><a href="http://t.cn/RgKrHOx">网页版演示</a></p>
<p><img src='/advance/nbtutor4.png' width='550'/></p>
<ul>
<li>对于 set 的情况</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f <span class="token operator">-</span>i
<span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy
a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>
b <span class="token operator">=</span> a
c <span class="token operator">=</span> a<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 深拷贝</span>
d <span class="token operator">=</span> deepcopy<span class="token punctuation">(</span>a<span class="token punctuation">)</span>
b<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">4</span><span class="token punctuation">)</span>
c<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>
d<span class="token punctuation">.</span>add<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">id</span><span class="token punctuation">(</span>d<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>22492476895528 22492476895528 22492476895304 22492374233384</code></pre>
<p><a href="http://t.cn/RgKd3E7">网页版演示</a></p>
<p><img src='/advance/nbtutor5.png' width='550'/></p>
<ul>
<li>对于 numpy 的情况</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f <span class="token operator">-</span>i
<span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span>
b <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token punctuation">]</span> <span class="token comment"># 浅拷贝!</span>
c <span class="token operator">=</span> a<span class="token punctuation">.</span>copy<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 深拷贝, 同 deepcopy(a)</span>
d <span class="token operator">=</span> a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># 花式切片是深拷贝</span>
b<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">1</span>
c<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">2</span>
d<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">-</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># id 虽各不同, 但 .__array_interface__['data'][0] 可能相同</span>
<span class="token keyword">for</span> i <span class="token keyword">in</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">,</span> c<span class="token punctuation">,</span> d<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">id</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span class="token punctuation">,</span> i<span class="token punctuation">.</span>__array_interface__<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>22928831926400 93879086511872
22928831928960 93879086511872
22928829201984 93879072448320
22928829199344 93879078700736</code></pre>
<p><a href="http://t.cn/Rg9hST6">网页版演示</a> (<strong>Site
Error</strong>: Ruby and Python+Anaconda backends are permanently
unavailable)</p>
<p>参见之前的 <a href="#矩阵">np.matrix, np.asmatrix</a></p>
<h2 id="其他格式文件读写">其他格式文件读写</h2>
<h3 id="用-pandas-读-csv">用 pandas 读 csv</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"data/data.csv"</span><span class="token punctuation">)</span>
data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
col1
</th>
<th>
col2
</th>
<th>
col3
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
row1
</td>
<td>
1
</td>
<td>
10.0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
row2
</td>
<td>
2
</td>
<td>
0.2
</td>
</tr>
<tr>
<th>
2
</th>
<td>
row3
</td>
<td>
3
</td>
<td>
300.0
</td>
</tr>
</tbody>
</table>
</div>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data<span class="token punctuation">.</span>columns<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>Index([&#39;col1&#39;, &#39;col2&#39;, &#39;col3&#39;], dtype=&#39;object&#39;)</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data<span class="token punctuation">.</span>col1<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0    row1
1    row2
2    row3
Name: col1, dtype: object</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data<span class="token punctuation">[</span><span class="token string">'col1'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>0    row1
1    row2
2    row3
Name: col1, dtype: object</code></pre>
<p>只取一部分:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">data <span class="token operator">=</span> pd<span class="token punctuation">.</span>read_csv<span class="token punctuation">(</span><span class="token string">"data/data.csv"</span><span class="token punctuation">,</span> nrows<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
data<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
<thead>
<tr style="text-align: right;">
<th>
</th>
<th>
col1
</th>
<th>
col3
</th>
</tr>
</thead>
<tbody>
<tr>
<th>
0
</th>
<td>
row1
</td>
<td>
10.0
</td>
</tr>
<tr>
<th>
1
</th>
<td>
row2
</td>
<td>
0.2
</td>
</tr>
</tbody>
</table>
</div>
<p>对于超大文件, 参见: <a
href="https://www.dataquest.io/blog/pandas-big-data/"
class="uri">https://www.dataquest.io/blog/pandas-big-data/</a></p>
<h3 id="fortran-二进制文件读写">Fortran 二进制文件读写</h3>
<h4 id="unformatted-sequential">Unformatted (sequential)</h4>
<p>使用 <code>scipy.io.FortranFile</code><br> 参考: <a
href="https://docs.scipy.org/doc/scipy-0.15.1/reference/generated/scipy.io.FortranFile.read_record.html"
class="uri">https://docs.scipy.org/doc/scipy-0.15.1/reference/generated/scipy.io.FortranFile.read_record.html</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python (write)</span>
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">import</span> FortranFile
var1 <span class="token operator">=</span> <span class="token number">1.1</span>  <span class="token comment"># '&lt;f8'</span>
var2 <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># '&lt;i8'</span>
arr <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6.</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># '(2, 3)&lt;f8'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'arr[0, 1] = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>

<span class="token comment"># 多行存入</span>
<span class="token keyword">with</span> FortranFile<span class="token punctuation">(</span><span class="token string">'data/data_fortran1-1.dat'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write_record<span class="token punctuation">(</span>var1<span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write_record<span class="token punctuation">(</span>var2<span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write_record<span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
<span class="token comment"># 单行存入</span>
<span class="token keyword">with</span> FortranFile<span class="token punctuation">(</span><span class="token string">'data/data_fortran1-2.dat'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write_record<span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">,</span> arr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]
arr[0, 1] = 1.0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python (read)</span>
<span class="token keyword">from</span> scipy<span class="token punctuation">.</span>io <span class="token keyword">import</span> FortranFile
<span class="token comment"># 多行存入的情况</span>
<span class="token keyword">with</span> FortranFile<span class="token punctuation">(</span><span class="token string">'data/data_fortran1-1.dat'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    var1 <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read_record<span class="token punctuation">(</span><span class="token string">'&lt;f8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    var2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read_record<span class="token punctuation">(</span><span class="token string">'&lt;i8'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 注意精度(上面python存入的是默认'int64')</span>
    arr <span class="token operator">=</span> f<span class="token punctuation">.</span>read_record<span class="token punctuation">(</span><span class="token string">'(2, 3)&lt;f8'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'data_fortran1-1.dat'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
<span class="token comment"># 单行存入的情况</span>
<span class="token keyword">with</span> FortranFile<span class="token punctuation">(</span><span class="token string">'data/data_fortran1-2.dat'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
<span class="token comment">#     data = f.read_record('&lt;f8, &lt;i8, (2, 3)&lt;f8')  # 不指定名称</span>
    data <span class="token operator">=</span> f<span class="token punctuation">.</span>read_record<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string">'var1'</span><span class="token punctuation">,</span> <span class="token string">'&lt;f8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">'var2'</span><span class="token punctuation">,</span> <span class="token string">'&lt;i8'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                         <span class="token punctuation">(</span><span class="token string">'arr'</span><span class="token punctuation">,</span> <span class="token string">'(2, 3)&lt;f8'</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 指定名称: (name, dtype)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\ndata_fortran1-2.dat'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'keys = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>data<span class="token punctuation">.</span>dtype<span class="token punctuation">.</span>names<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>  <span class="token comment"># 如读取时未指定名称则为 ['f0', 'f1', ...]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">float</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'var1'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'var2'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'arr'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>data_fortran1-1.dat
1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]

data_fortran1-2.dat
keys = (&#39;var1&#39;, &#39;var2&#39;, &#39;arr&#39;)
1.1 0
[[[0. 1. 2.]
  [3. 4. 5.]]]</code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
<span class="token builtin class-name">cd</span> examples/
ifort -o test_read_seq test_read_seq.f90
./test_read_seq<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code> data_fortran1-1.dat
   1.1  0.0
   0.0  1.0  2.0
   3.0  4.0  5.0
 arr(2, 1) =   1.0

 data_fortran1-2.dat
   1.1  0.0
   0.0  1.0  2.0
   3.0  4.0  5.0
 arr(2, 1) =   1.0</code></pre>
<p>见 Structured arrays: <a
href="https://docs.scipy.org/doc/numpy/user/basics.rec.html"
class="uri">https://docs.scipy.org/doc/numpy/user/basics.rec.html</a></p>
<h4 id="unformatted-stream">Unformatted (stream)</h4>
<p><code>struct</code> 参考 <a
href="https://docs.python.org/3/library/struct.html"
class="uri">https://docs.python.org/3/library/struct.html</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python (write)</span>
<span class="token keyword">import</span> struct
var1 <span class="token operator">=</span> <span class="token number">1.1</span>  <span class="token comment"># '&lt;f8'</span>
var2 <span class="token operator">=</span> <span class="token number">0</span>  <span class="token comment"># '&lt;i8'</span>
arr <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6.</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># '(2, 3)&lt;f8'</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'arr[0, 1] = </span><span class="token interpolation"><span class="token punctuation">&#123;</span>arr<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data/data_fortran2.dat'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'d'</span><span class="token punctuation">,</span> var1<span class="token punctuation">)</span><span class="token punctuation">)</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>struct<span class="token punctuation">.</span>pack<span class="token punctuation">(</span><span class="token string">'i'</span><span class="token punctuation">,</span> var2<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 注意 `struct` 的 'i' 是 '&lt;i4'</span>
    arr<span class="token punctuation">.</span>tofile<span class="token punctuation">(</span>f<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]
arr[0, 1] = 1.0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python (read)</span>
<span class="token comment"># 使用 `np.fromfile`, 读入的是 `ndarray`</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data/data_fortran2.dat'</span><span class="token punctuation">,</span> <span class="token string">'rb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    var1 <span class="token operator">=</span> <span class="token builtin">float</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'&lt;f8'</span><span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    var2 <span class="token operator">=</span> <span class="token builtin">int</span><span class="token punctuation">(</span>np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'&lt;i4'</span><span class="token punctuation">,</span> count<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    arr <span class="token operator">=</span> np<span class="token punctuation">.</span>fromfile<span class="token punctuation">(</span>f<span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token string">'&lt;f8'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>var1<span class="token punctuation">,</span> var2<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>1.1 0
[[0. 1. 2.]
 [3. 4. 5.]]</code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
<span class="token builtin class-name">cd</span> examples/
ifort -o test_read_stream test_read_stream.f90
./test_read_stream<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>  1.1 0.0
  0.0 1.0 2.0
  3.0 4.0 5.0
 arr(2, 1) =  1.0</code></pre>
<h3 id="hdf5-文件读写-ncdf-cdf-文件读取">HDF5 文件读写, NCDF, CDF
文件读取</h3>
<h4 id="读写-hdf5-文件-读-ncdf-文件">读写 HDF5 文件, 读 NCDF 文件</h4>
<p>HDF5 格式介绍 <a
href="https://portal.hdfgroup.org/display/HDF5/Introduction+to+HDF5"
class="uri">https://portal.hdfgroup.org/display/HDF5/Introduction+to+HDF5</a></p>
<p>相关包: <code>h5py</code> 或 <code>pandas</code> +
<code>pytables</code>
(http://www.pytables.org/usersguide/datatypes.html)</p>
<p>安装见 <a href="installpy.html#其他">Python 安装和配置</a></p>
<ul>
<li>查看</li>
</ul>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">$ h5dump -H &lt;filename&gt;.hdf5
$ ncdump -h &lt;filename&gt;.ncdf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>用 <code>h5py</code> 读写:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> h5py
arr <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">10000</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">50</span><span class="token punctuation">,</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
<span class="token keyword">with</span> h5py<span class="token punctuation">.</span>File<span class="token punctuation">(</span><span class="token string">'test.hdf5'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr
    <span class="token comment"># 或</span>
    <span class="token comment"># f.create_dataset('data', data=arr)</span>
    <span class="token comment"># 其中 compression='gzip', compression_opts=[0-9], 可分条目用不同压缩</span>
    f<span class="token punctuation">[</span><span class="token string">'lb'</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> 读纯 HDF5/NCDF 文件: <pre class="line-numbers language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> h5py<span class="token punctuation">.</span>File<span class="token punctuation">(</span><span class="token string">'test.hdf5'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
keys <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['data', 'lb']</span>
items <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>  读 pandas 存的文件:
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> f<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block0_values'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>value
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># f['&lt;key>'] 得到的是 Dataset 或 Group 的引用</span>
<span class="token comment"># 用 f['&lt;key>'].value 或切片 f['&lt;key>'][:] 得到原来的格式</span>
<span class="token comment"># f['&lt;key>'] 可替代为f.get('&lt;key>')</span>
<span class="token comment"># 关闭之后 f['data'] 的引用失效, 因此存出数据要加上.value或[:]保存数据, 或使用 deepcopy</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>  打印读取的信息: <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint
pprint<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">:</span><span class="token format-spec">>20</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">>20</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">.</span>dtype<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">>20</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> f<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
pprint<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">:</span><span class="token format-spec">>20</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block0_values'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">>20</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">,</span> <span class="token string-interpolation"><span class="token string">f"</span><span class="token interpolation"><span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>f<span class="token punctuation">[</span>k<span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'block0_values'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>dtype<span class="token punctuation">)</span><span class="token punctuation">:</span><span class="token format-spec">>20</span><span class="token punctuation">&#125;</span></span><span class="token string">"</span></span><span class="token punctuation">)</span> <span class="token keyword">for</span> k <span class="token keyword">in</span> f<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<ul>
<li>用pandas读写:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> 写: <pre class="line-numbers language-python" data-language="python"><code class="language-python">arr2 <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>arr<span class="token punctuation">)</span>
<span class="token comment"># complevel=[0-9], complib=&#123;'zlib', 'lzo', 'bzip2', 'blosc'&#125;</span>
<span class="token keyword">with</span> pd<span class="token punctuation">.</span>HDFStore<span class="token punctuation">(</span><span class="token string">'test2.hdf5'</span><span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span> <span class="token operator">=</span> arr2
    f<span class="token punctuation">[</span><span class="token string">'lb'</span><span class="token punctuation">]</span> <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span><span class="token builtin">list</span><span class="token punctuation">(</span><span class="token builtin">range</span><span class="token punctuation">(</span><span class="token number">100</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>  读 pandas 写的文件: <pre class="line-numbers language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> pd<span class="token punctuation">.</span>HDFStore<span class="token punctuation">(</span><span class="token string">'test2.hdf5'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
keys <span class="token operator">=</span> f<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># ['/data', '/lb'], 存在子目录</span>
items <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> f<span class="token punctuation">.</span>data<span class="token punctuation">.</span>values  <span class="token comment"># a = f.&lt;key> 得到的是 DataFrame 的引用, f.&lt;key>.values 得到原来的格式</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<ul>
<li>读纯 HDF5/NCDF 文件:<br> 比如 h5py 写的文件, 目录结构和 pandas
写的不同, 要用<code>.root</code><br> 其他软件生成的文件可能不能读</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> pd<span class="token punctuation">.</span>HDFStore<span class="token punctuation">(</span><span class="token string">'test.hdf5'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span>
keys <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>root<span class="token punctuation">.</span>_v_children<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['data', 'lb']</span>
items <span class="token operator">=</span> <span class="token builtin">list</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>root<span class="token punctuation">.</span>_v_children<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ['data', 'lb'], 有些文件没有.items</span>
a <span class="token operator">=</span> f<span class="token punctuation">.</span>root<span class="token punctuation">.</span>data<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment"># f.root 得到 tables.group.RootGroup, f.root.&lt;key> 得到tables.group.CArray</span>
<span class="token comment"># f.get_node('&lt;key>') 得到 tables.group.CArray</span>
<span class="token comment"># f.root.&lt;key> 可替代为 f['&lt;key>'] (有些文件不行)</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p> 打印 (以免数据有 None, 用 <code>np.shape</code>): <pre class="line-numbers language-python" data-language="python"><code class="language-python">pprint<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>k<span class="token punctuation">&#125;</span></span><span class="token string">'</span></span>                      <span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>np<span class="token punctuation">.</span>shape<span class="token punctuation">(</span>f<span class="token punctuation">.</span>get_node<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
         <span class="token string-interpolation"><span class="token string">f'</span><span class="token interpolation"><span class="token punctuation">&#123;</span>np<span class="token punctuation">.</span>dtype<span class="token punctuation">(</span>f<span class="token punctuation">.</span>get_node<span class="token punctuation">(</span>k<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">.</span>rjust<span class="token punctuation">(</span><span class="token number">20</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
         <span class="token keyword">for</span> k <span class="token keyword">in</span> <span class="token builtin">list</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>root<span class="token punctuation">.</span>_v_children<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
 Bug: 无法读出 <code>H5T_STRING</code></p>
<h4 id="大小比较">大小比较</h4>
<p>用于比较的文件名说明:</p>
<table>
<thead>
<tr class="header">
<th style="text-align: left;">Filename</th>
<th style="text-align: left;">Method</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td style="text-align: left;"><em>xxx</em>_np.npy</td>
<td style="text-align: left;"><strong><code>np.save</code></strong></td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>xxx</em>_np.npz</td>
<td
style="text-align: left;"><strong><code>np.savez_compressed</code></strong></td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>xxx</em>_compimg.fits</td>
<td style="text-align: left;"><strong>FITS</strong> CompImageHDU
(compressed)</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>xxx</em>_prim.fits</td>
<td style="text-align: left;"><strong>FITS</strong> PrimaryHDU</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>xxx</em>_h5py_0.hdf5</td>
<td style="text-align: left;"><strong><code>h5py</code></strong> no
compression</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>xxx</em>_h5py_gzip.hdf5</td>
<td style="text-align: left;"><strong><code>h5py</code></strong>
compression='gzip', compression_opts=9</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>xxx</em>_h5py_lzf.hdf5</td>
<td style="text-align: left;"><strong><code>h5py</code></strong>
compression='lzf'</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>xxx</em>_pd_0.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong> no
compression</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>xxx</em>_pd_blosc.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='blosc', complevel=9</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>xxx</em>_pd_bzip2.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='bzip2', complevel=9</td>
</tr>
<tr class="odd">
<td style="text-align: left;"><em>xxx</em>_pd_lzo.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='lzo', complevel=9</td>
</tr>
<tr class="even">
<td style="text-align: left;"><em>xxx</em>_pd_zlib.hdf5</td>
<td style="text-align: left;"><strong><code>pandas</code></strong>
complib='zlib', complevel=9</td>
</tr>
</tbody>
</table>
<ul>
<li>对于相关性强的数组</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>run examples<span class="token operator">/</span>test_hdf5<span class="token punctuation">.</span>py
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>test_<span class="token operator">*</span><span class="token punctuation">.</span>np<span class="token operator">*</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>test_h5py_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>test_pd_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>array: 15.3 M

7.7M    data/test_np.npy
1.3M    data/test_np.npz

16M data/test_h5py_0.hdf5
2.9M    data/test_h5py_gzip.hdf5
7.7M    data/test_h5py_lzf.hdf5

16M data/test_pd_0.hdf5
272K    data/test_pd_blosc.hdf5
248K    data/test_pd_bzip2.hdf5
256K    data/test_pd_lzo.hdf5
172K    data/test_pd_zlib.hdf5</code></pre>
<ul>
<li>随机数数组</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>run examples<span class="token operator">/</span>test_hdf5_2<span class="token punctuation">.</span>py
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>test_<span class="token operator">*</span><span class="token punctuation">.</span>np<span class="token operator">*</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>test_h5py_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>test_pd_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>array: 15.3 M

7.7M    data/test_np.npy
7.2M    data/test_np.npz

16M data/test_h5py_0.hdf5
8.0M    data/test_h5py_gzip.hdf5
9.5M    data/test_h5py_lzf.hdf5

16M data/test_pd_0.hdf5
7.7M    data/test_pd_blosc.hdf5
7.2M    data/test_pd_bzip2.hdf5
7.7M    data/test_pd_lzo.hdf5
7.1M    data/test_pd_zlib.hdf5</code></pre>
<ul>
<li>从 FITS 文件读取再转存</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fname <span class="token operator">=</span> <span class="token string">'data/hmi.B_720s.20150827_052400_TAI.field.fits'</span>
<span class="token operator">%</span>run examples<span class="token operator">/</span>test_fits_hdf5<span class="token punctuation">.</span>py <span class="token punctuation">&#123;</span>fname<span class="token punctuation">&#125;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h <span class="token punctuation">&#123;</span>fname<span class="token punctuation">&#125;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_<span class="token operator">*</span><span class="token punctuation">.</span>np<span class="token operator">*</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_<span class="token operator">*</span><span class="token punctuation">.</span>fits
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_h5py_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_pd_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>array: 64.0 M

21M data/hmi.B_720s.20150827_052400_TAI.field.fits

65M data/fits_np.npy
27M data/fits_np.npz

21M data/fits_compimg.fits
65M data/fits_prim.fits

65M data/fits_h5py_0.hdf5
27M data/fits_h5py_gzip.hdf5
40M data/fits_h5py_lzf.hdf5

65M data/fits_pd_0.hdf5
23M data/fits_pd_blosc.hdf5
21M data/fits_pd_bzip2.hdf5
23M data/fits_pd_lzo.hdf5
20M data/fits_pd_zlib.hdf5</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fname <span class="token operator">=</span> <span class="token string">'data/hmi.B_720s.20150827_052400_TAI.disambig.fits'</span>
<span class="token operator">%</span>run examples<span class="token operator">/</span>test_fits_hdf5<span class="token punctuation">.</span>py <span class="token punctuation">&#123;</span>fname<span class="token punctuation">&#125;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h <span class="token punctuation">&#123;</span>fname<span class="token punctuation">&#125;</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_<span class="token operator">*</span><span class="token punctuation">.</span>np<span class="token operator">*</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_<span class="token operator">*</span><span class="token punctuation">.</span>fits
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_h5py_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
!du <span class="token operator">-</span>h data<span class="token operator">/</span>fits_pd_<span class="token operator">*</span><span class="token punctuation">.</span>hdf5<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>array: 32.0 M

5.4M    data/hmi.B_720s.20150827_052400_TAI.disambig.fits

33M data/fits_np.npy
5.2M    data/fits_np.npz

5.4M    data/fits_compimg.fits
33M data/fits_prim.fits

33M data/fits_h5py_0.hdf5
5.3M    data/fits_h5py_gzip.hdf5
9.7M    data/fits_h5py_lzf.hdf5

33M data/fits_pd_0.hdf5
9.5M    data/fits_pd_blosc.hdf5
4.1M    data/fits_pd_bzip2.hdf5
7.6M    data/fits_pd_lzo.hdf5
4.8M    data/fits_pd_zlib.hdf5</code></pre>
<h4 id="读取-cdf-文件">读取 CDF 文件</h4>
<p>相关包 <code>cdflib</code>, 安装见 <a
href="installpy.html#其他">Python 安装和配置#其他</a>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> cdflib
f <span class="token operator">=</span> cdflib<span class="token punctuation">.</span>CDF<span class="token punctuation">(</span><span class="token string">"&lt;filename>.cdf"</span><span class="token punctuation">)</span>
f<span class="token punctuation">.</span>cdf_info<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 总体信息</span>
f<span class="token punctuation">.</span>varinq<span class="token punctuation">(</span><span class="token string">'&lt;key>'</span><span class="token punctuation">)</span>  <span class="token comment"># 变量信息</span>
f<span class="token punctuation">.</span>varget<span class="token punctuation">(</span><span class="token string">'&lt;key>'</span><span class="token punctuation">)</span>  <span class="token comment"># 值</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h3 id="numpy-to-vtk">NumPy to VTK</h3>
<p>参考 <a
href="https://pyscience.wordpress.com/2014/09/06/numpy-to-vtk-converting-your-numpy-arrays-to-vtk-arrays-and-files/"
class="uri">https://pyscience.wordpress.com/2014/09/06/numpy-to-vtk-converting-your-numpy-arrays-to-vtk-arrays-and-files/</a><br>
以及 <a href="installpy.html#其他">Python 安装和配置</a> <br><br>
e.g.<br> 运行 <a
href="examples/field2dvtk.py">examples/field2dvtk.py</a> ,<br>
打开Paraview, 选择 state 文件 'field2d.pvsm', 再选择数据文件
'field2d.vtr'</p>
<h3 id="matlab-mat-文件读写">Matlab mat 文件读写</h3>
<p>(未测试) <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> scipy<span class="token punctuation">.</span>io
scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>loadmat<span class="token punctuation">(</span><span class="token string">"&lt;filename>"</span><span class="token punctuation">,</span> mdict<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span> appendmat<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span>
<span class="token comment"># 如果 appendmat=True，则文件名不需要'.mat'后缀)</span>
scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>savemat<span class="token punctuation">(</span><span class="token string">"&lt;filename>"</span><span class="token punctuation">,</span> mdict<span class="token punctuation">,</span> appendmat<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> <span class="token builtin">format</span><span class="token operator">=</span><span class="token string">'5'</span><span class="token punctuation">,</span>
                 long_field_names<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> do_compression<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">,</span> oned_as<span class="token operator">=</span><span class="token string">'row'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h2 id="脚本相关">脚本相关</h2>
<h3 id="脚本结构">脚本结构</h3>
<p>文件头: <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>脚本结构: <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
<span class="token comment"># -*- coding: utf-8 -*-</span>
<span class="token triple-quoted-string string">"""
假设这个文件的名称为 mymodule.py
使用 `imort mymodule` 导入
这些文字会出现在 `help(mymodule)` 或 `pydoc mymodule` 中
"""</span>
c <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">def</span> <span class="token function">func1</span><span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">,</span> <span class="token operator">*</span>args<span class="token punctuation">,</span> <span class="token operator">**</span>kwargs<span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token triple-quoted-string string">"""
    这个注释必须缩进
    args: a tuple - (arg1, arg2, ...)
    kwargs: a dict - &#123;key1 : val1, key2 : val2&#125;
    """</span>
    <span class="token keyword">global</span> c
    <span class="token keyword">return</span> x <span class="token operator">+</span> y <span class="token operator">+</span> c
<span class="token keyword">def</span> <span class="token function">func2</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>
    a <span class="token operator">=</span> func1<span class="token punctuation">(</span>x<span class="token punctuation">,</span> x<span class="token punctuation">)</span>
    <span class="token keyword">return</span> a
<span class="token keyword">def</span> <span class="token function">_func3</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span class="token punctuation">:</span>  <span class="token comment"># `from xxx import *` 将不会导入这个函数</span>
    <span class="token keyword">pass</span>
    <span class="token keyword">return</span>  <span class="token comment"># return 不写时返回 None</span>
<span class="token keyword">def</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token comment"># your code here</span>
<span class="token keyword">if</span> __name__ <span class="token operator">==</span> <span class="token string">"__main__"</span><span class="token punctuation">:</span>
    main<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <code>import</code> 这个文档时,
<code>__name__</code> 为模块名, 因此 <code>main()</code> 不执行</p>
<p><code>help()</code> 也可以查看模块内的函数文档:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> usr_sunpy
<span class="token builtin">help</span><span class="token punctuation">(</span>usr_sunpy<span class="token punctuation">.</span>plot_map<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<h3 id="try-...-except-...-语法">try ... except ... 语法</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">try</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token keyword">except</span> ValueError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ValueError:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
<span class="token keyword">except</span> ZeroDivisionError <span class="token keyword">as</span> e<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'ZeroDivisionError:'</span><span class="token punctuation">,</span> e<span class="token punctuation">)</span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'no error!'</span><span class="token punctuation">)</span>
<span class="token keyword">finally</span><span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'finally...'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>见 <a href="#Paraview-脚本">Paraview 的例子</a></p>
<h3 id="paraview-脚本">Paraview 脚本</h3>
<p>官方文档 <a
href="https://www.paraview.org/ParaView/Doc/Nightly/www/py-doc/index.html"
class="uri">https://www.paraview.org/ParaView/Doc/Nightly/www/py-doc/index.html</a>
<br><br> * 记录语句: 1. Tools -&gt; Start Trace 2. 进行各种操作 3. Tools
-&gt; Stop Trace 之后得到一个包含刚才操作命令的脚本,
参考其中的语句就可以写自己的脚本了. <br><br> * 需要导入的模块:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">from paraview.simple import *<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p><br> * 使用 pvpython (默认渲染) pvbatch (默认不渲染) 来执行脚本:</p>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">pvbatch myscript.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>也可以使用文件头 <code>#!/usr/bin/env pvbatch</code>,
加执行权限后直接执行: <pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">.&#x2F;myscript.py<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> 注意: 打包的 paraview 所使用的
python 是 paraview 自带的 python2.7</p>
<p><img src='/advance/Screenshot_20180618-151438.png' width='700' /></p>
<ul>
<li>常用语句:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">view <span class="token operator">=</span> GetActiveView<span class="token punctuation">(</span><span class="token punctuation">)</span>
scene <span class="token operator">=</span> GetAnimationScene<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p><code>view.ViewTime</code> 修改时 <code>scene.AnimationTime</code>
不变 <code>scene.AnimationTime</code> 修改时 <code>view.ViewTime</code>
也同时被改变</p>
<p>注意: filter 必须是显示状态 (<code>Show(&lt;filter&gt;)</code>)
才能修改时间</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># e.g.</span>
!code <span class="token operator">-</span>n examples<span class="token operator">/</span>stat1<span class="token punctuation">.</span>py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>字体选择参考路径:<br>
<ul>
<li>/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf</li>
<li>/home/<user>/miniconda3/lib/python3.6/site-packages/matplotlib/mpl-data/fonts/ttf/DejaVuSans.ttf</li>
</ul></li>
<li>python 调用问题 (paraview 5.5.0+ 没有这个问题):</li>
</ul>
<p>paraview 某个版本之后就默认使用 python 2.7.11+.<br>
运行之前先修改环境变量 ( <code>PYTHONPATH</code> 和
<code>PYTHONSTARTUP</code>), <br>
运行结束结束后恢复这两个变量即可.<br><br> 这个过程可以使用脚本
(而不用alias): <pre class="line-numbers language-sh" data-language="sh"><code class="language-sh">#!&#x2F;bin&#x2F;bash
unset PYTHONSTARTUP  # 如果有的话
export PYTHONPATH&#x3D;&#x2F;&lt;your_path&gt;&#x2F;ParaView&#x2F;lib&#x2F;python2.7&#x2F;site-packages
&#x2F;&lt;your_path&gt;&#x2F;ParaView&#x2F;bin&#x2F;paraview $@<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> 用这个脚本替代原有 <code>paraview</code>,
<code>pvpython</code> 和 <code>pvbatch</code> 命令.</p>
<h3 id="python-2---3-的转换">Python 2 -&gt; 3 的转换</h3>
<p>比较推荐的安全的检查方式:</p>
<ul>
<li><p>备份的原文件且自动生成转换过的文件 <pre class="line-numbers language-none"><code class="language-none">$ 2to3 -w filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li>
<li><p>手动比较, 在需要的地方对照修改 filename.bak<br> 主要查看 print,
range, map 等函数.<br> 添加<br>
 <code>from __future__ import division, print_function</code><br> 在其他
import 前. <pre class="line-numbers language-none"><code class="language-none">$ sudo apt-get install meld
$ meld filename filename.bak<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p></li>
<li><p>确认无误后, 将手动修改的文件复制回去 <pre class="line-numbers language-none"><code class="language-none">$ mv -v filename.bak filename<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p></li>
</ul>
<p>python 内查看版本的方法, 可用于 <code>if</code> 语句等 (更推荐用
<code>try...except...</code> 语法):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">print</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>version_info <span class="token operator">>=</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>version_info<span class="token punctuation">.</span>major <span class="token operator">>=</span> <span class="token number">3</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="执行-shell-命令">执行 shell 命令</h3>
<p><a href="https://docs.python.org/3/library/subprocess.html"
class="uri">https://docs.python.org/3/library/subprocess.html</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> subprocess

fname <span class="token operator">=</span> <span class="token string">'installpy.ipynb'</span>

<span class="token comment"># 默认是以列表形式传递参数</span>
subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ls"</span><span class="token punctuation">,</span> <span class="token string">"-l"</span><span class="token punctuation">,</span> fname<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token comment"># doesn't capture output</span>

<span class="token comment"># 输出结果需要 `decode('ascii')` 转码</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>run<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ls"</span><span class="token punctuation">,</span> <span class="token string">"-l"</span><span class="token punctuation">,</span> fname<span class="token punctuation">]</span><span class="token punctuation">,</span> stdout<span class="token operator">=</span>subprocess<span class="token punctuation">.</span>PIPE<span class="token punctuation">)</span>
                    <span class="token punctuation">.</span>stdout<span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token string">"ls"</span><span class="token punctuation">,</span> <span class="token string">"-l"</span><span class="token punctuation">,</span> fname<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>-rw-rw-r-- 1 lydia lydia 142508 Jun 24 16:21 installpy.ipynb

-rw-rw-r-- 1 lydia lydia 142508 Jun 24 16:21 installpy.ipynb</code></pre>
<p>利用 bash 的特长来做一些字符串操作:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 使用整行命令需要 `shell=True`, 虽然并不是推荐的做法, 但偶尔使用无妨 (见官方文档)</span>
<span class="token comment"># `r`用来取消转义</span>
<span class="token comment"># `echo`使用`-n`来去掉输出的 '\n'</span>
fname_head <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">r"echo -n %s | sed 's/\.ipynb//'"</span>
                                     <span class="token operator">%</span> fname<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>
<span class="token comment"># 或使用 strip 去掉 '\n'</span>
fname_head <span class="token operator">=</span> subprocess<span class="token punctuation">.</span>check_output<span class="token punctuation">(</span><span class="token string">r"echo %s | sed 's/\.ipynb//'"</span>
             <span class="token operator">%</span> fname<span class="token punctuation">,</span> shell<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>decode<span class="token punctuation">(</span><span class="token string">'ascii'</span><span class="token punctuation">)</span>  
<span class="token keyword">print</span><span class="token punctuation">(</span>fname_head<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>installpy</code></pre>
<p>字符串编码见 <a
href="https://www.liaoxuefeng.com/wiki/0014316089557264a6b348958f449949df42a6d3a2e542c000/001431664106267f12e9bef7ee14cf6a8776a479bdec9b9000">廖雪峰的网站</a></p>
<ul>
<li>得到命令执行的路径</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> os
os<span class="token punctuation">.</span>getcwd<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#39;/home/lydia/codes/zly/python/python-intro&#39;</code></pre>
<ul>
<li>得到脚本文件所在的路径(仅脚本中使用)</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>或 <pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span>os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>abspath<span class="token punctuation">(</span>__file__<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<p>其中 <code>os.path.split</code> 和 <code>os.path.dirname</code>
的用法:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">'your/path/filename'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>(&#39;your/path&#39;, &#39;filename&#39;)</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">os<span class="token punctuation">.</span>path<span class="token punctuation">.</span>dirname<span class="token punctuation">(</span><span class="token string">'your/path/filename'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;your/path&#39;</code></pre>
<p><code>os.path.dirname</code> 类似于 bash 的 <code>dirname</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">!dirname <span class="token string">'your/path/filename'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>your/path</code></pre>
<h3 id="脚本选项">脚本选项</h3>
<p>推荐 <code>argparse</code>, 在过去的其他方法的基础上有所增强 <a
href="https://docs.python.org/3/library/argparse.html"
class="uri">https://docs.python.org/3/library/argparse.html</a></p>
<p>脚本内: <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> argparse
parser <span class="token operator">=</span> argparse<span class="token punctuation">.</span>ArgumentParser<span class="token punctuation">(</span>description<span class="token operator">=</span><span class="token string">'Process some integers.'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'integers'</span><span class="token punctuation">,</span> metavar<span class="token operator">=</span><span class="token string">'N'</span><span class="token punctuation">,</span> <span class="token builtin">type</span><span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> nargs<span class="token operator">=</span><span class="token string">'+'</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'an integer for the accumulator'</span><span class="token punctuation">)</span>
parser<span class="token punctuation">.</span>add_argument<span class="token punctuation">(</span><span class="token string">'--sum'</span><span class="token punctuation">,</span> dest<span class="token operator">=</span><span class="token string">'accumulate'</span><span class="token punctuation">,</span> action<span class="token operator">=</span><span class="token string">'store_const'</span><span class="token punctuation">,</span>
                    const<span class="token operator">=</span><span class="token builtin">sum</span><span class="token punctuation">,</span> default<span class="token operator">=</span><span class="token builtin">max</span><span class="token punctuation">,</span>
                    <span class="token builtin">help</span><span class="token operator">=</span><span class="token string">'sum the integers (default: find the max)'</span><span class="token punctuation">)</span>
args <span class="token operator">=</span> parser<span class="token punctuation">.</span>parse_args<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>args<span class="token punctuation">.</span>accumulate<span class="token punctuation">(</span>args<span class="token punctuation">.</span>integers<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> Shell: <pre class="line-numbers language-none"><code class="language-none">$ python prog.py -h
usage: prog.py [-h] [--sum] N [N ...]
Process some integers.
positional arguments:
 N           an integer for the accumulator
optional arguments:
 -h, --help  show this help message and exit
 --sum       sum the integers (default: find the max)<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h3 id="处理-warnings">处理 warnings</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Suppress warnings of NaNs:</span>
<span class="token keyword">with</span> np<span class="token punctuation">.</span>errstate<span class="token punctuation">(</span>invalid<span class="token operator">=</span><span class="token string">'ignore'</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># Suppress other warnings, e.g.</span>
<span class="token keyword">import</span> warnings
<span class="token keyword">with</span> warnings<span class="token punctuation">.</span>catch_warnings<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
    warnings<span class="token punctuation">.</span>simplefilter<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">)</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token comment"># Or</span>
warnings<span class="token punctuation">.</span>simplefilter<span class="token punctuation">(</span><span class="token string">"ignore"</span><span class="token punctuation">,</span> category<span class="token operator">=</span>xxx<span class="token punctuation">)</span>  <span class="token comment"># UserWarning, FutureWarning, etc.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h2 id="urllib-requests">urllib, requests</h2>
<p>示例和文件来自 <a href="http://python4astronomers.github.com"
class="uri">http://python4astronomers.github.com</a></p>
<p>注意 python3 不再使用 <code>urllib2</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 方法1</span>
<span class="token keyword">import</span> urllib
url <span class="token operator">=</span> <span class="token string">'http://python4astronomers.github.com/_downloads/myidlfile.sav'</span>
urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlretrieve<span class="token punctuation">(</span>url<span class="token punctuation">,</span> <span class="token string">'myidlfile.sav'</span><span class="token punctuation">)</span>
<span class="token comment"># 方法2</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'myidlfile.sav'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>urllib<span class="token punctuation">.</span>request<span class="token punctuation">.</span>urlopen<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment"># 方法3</span>
<span class="token keyword">import</span> requests
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'myidlfile.sav'</span><span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span>url<span class="token punctuation">)</span><span class="token punctuation">.</span>content<span class="token punctuation">)</span>
<span class="token comment"># 分块下载</span>
<span class="token keyword">import</span> requests
r <span class="token operator">=</span> requests<span class="token punctuation">.</span>get<span class="token punctuation">(</span><span class="token operator">&lt;</span>url<span class="token operator">></span><span class="token punctuation">)</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'wb'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">for</span> chunk <span class="token keyword">in</span> r<span class="token punctuation">.</span>iter_content<span class="token punctuation">(</span>chunk_size<span class="token operator">=</span><span class="token number">128</span><span class="token punctuation">)</span><span class="token punctuation">:</span>
        f<span class="token punctuation">.</span>write<span class="token punctuation">(</span>chunk<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Solar Physics</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>conda</tag>
        <tag>jupyter</tag>
        <tag>astropy</tag>
        <tag>sunpy</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 安装和配置</title>
    <url>//installpy.html</url>
    <content><![CDATA[<p><a
href="/downloads/notebooks/installpy.zip"><i class="fas fa-download"></i>
Jupyter Notebook</a></p>
<p><small><font color=gray>[Update 2022-07-12] Some outputs are updated
with python 3.10.</font></small></p>
<span id="more"></span>
<h2 id="安装-python">安装 python</h2>
<h3 id="安装-python-3">安装 python 3</h3>
<ul>
<li>检查系统自带的版本:</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sys
<span class="token keyword">print</span><span class="token punctuation">(</span>sys<span class="token punctuation">.</span>version<span class="token punctuation">)</span>
!<span class="token punctuation">&#123;</span>sys<span class="token punctuation">.</span>executable<span class="token punctuation">&#125;</span> <span class="token operator">-</span><span class="token operator">-</span>version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>3.10.5 | packaged by conda-forge | (main, Jun 14 2022, 07:04:59) [GCC 10.3.0]
Python 3.10.5</code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
python --version
python3 --version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>Python 3.10.5
Python 3.10.5</code></pre>
<h3 id="pip">pip</h3>
<h4 id="安装-pip">安装 pip</h4>
<p>检查 pip 是否安装以及版本</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
pip --version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>pip 22.1.2 from /home/lydia/miniconda3/lib/python3.10/site-packages/pip (python 3.10)</code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
python -m pip --version<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>pip 22.1.2 from /home/lydia/miniconda3/lib/python3.10/site-packages/pip (python 3.10)</code></pre>
<p>安装 (Ubuntu):</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> python3-pip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="用-pip-安装-python-包">用 pip 安装 python 包</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">></span>
pip <span class="token function">install</span> --upgrade <span class="token operator">&lt;</span>package<span class="token operator">></span>
pip uninstall <span class="token operator">&lt;</span>package<span class="token operator">></span>
pip list
pip list --outdated
pip show <span class="token operator">&lt;</span>package<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>安装到根目录 (不推荐!)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> -H pip <span class="token function">install</span> <span class="token operator">&lt;</span>package<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>[选项]</p>
<table>
<colgroup>
<col style="width: 50%" />
<col style="width: 50%" />
</colgroup>
<tbody>
<tr class="odd">
<td style="text-align: left;">-U, --upgrade</td>
<td style="text-align: left;">升级, 配合 install 使用</td>
</tr>
<tr class="even">
<td style="text-align: left;">--force-reinstall</td>
<td style="text-align: left;">强制重新安装依赖</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-I, --ignore-installed</td>
<td style="text-align: left;">强制安装 (无论是否已安装)</td>
</tr>
<tr class="even">
<td style="text-align: left;">--no-cache-dir</td>
<td style="text-align: left;">不生成cache</td>
</tr>
<tr class="odd">
<td style="text-align: left;">-i
<font color=blue><em>url</em></font></td>
<td style="text-align: left;">使用指定源 (更改配置见 <a
href="#pip-镜像源">pip 镜像源</a>)</td>
</tr>
<tr class="even">
<td
style="text-align: left;"><font color=blue><em>package</em></font>==x.x.x</td>
<td style="text-align: left;">指定版本, 错误版本号 (或为空)
将返回可用版本号</td>
</tr>
<tr class="odd">
<td
style="text-align: left;">"<font color=blue><em>package</em></font>&lt;x.x.x"</td>
<td style="text-align: left;">指定小于某版本的最新版本, 必须有引号</td>
</tr>
</tbody>
</table>
<p>检查包 (尝试导入, 查看包版本):</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python -c <span class="token string">"import &lt;package>"</span>
python -c <span class="token string">"import &lt;package>; print(&lt;package>.__version__)"</span>  <span class="token comment"># 版本号</span>
python -c <span class="token string">"import &lt;package>; print(&lt;package>.version)"</span>  <span class="token comment"># 安装位置</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h4 id="使-pip-安装-python-包到用户路径">使 pip 安装 python
包到用户路径</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
python -m site <span class="token operator">|</span> <span class="token function">grep</span> <span class="token string">'USER_SITE'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>USER_SITE: &#39;/home/lydia/.local/lib/python3.10/site-packages&#39; (doesn&#39;t exist)
ENABLE_USER_SITE: True</code></pre>
<ul>
<li>确认已创建用户包安装路径.<br></li>
<li>在 <code>~/.bashrc</code> 中设置 <code>PATH</code> 变量:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/.local/bin:<span class="token environment constant">$PATH</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>使用 <code>install</code> 或 <code>list</code> 时加上选项
<font color=red>--user</font> (注意: <code>uninstall</code> 不用)</li>
</ul>
<blockquote>
<p><font color=#b32425><em>使用 Anaconda 路径下的 pip
时不需要这个选项</em></font></p>
</blockquote>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> --user <span class="token operator">&lt;</span>pkg_name<span class="token operator">></span>
pip list --user
pip list --outdated --user<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<h3 id="anaconda">Anaconda</h3>
<h4 id="安装-anaconda-或-miniconda-推荐">安装 Anaconda 或 Miniconda
(推荐)</h4>
<ul>
<li><p>安装 miniconda 64位 (默认安装到
<font color=blue>~/miniconda3/</font>)</p>
<p>下载 <a href="https://conda.io/miniconda.html"
class="uri">https://conda.io/miniconda.html</a></p></li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">bash</span> Miniconda3-latest-Linux-x86_64.sh<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>在 <code>~/.bashrc</code> 加入如下语句:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/miniconda3/bin:<span class="token environment constant">$PATH</span>
<span class="token builtin class-name">.</span> <span class="token environment constant">$HOME</span>/miniconda3/etc/profile.d/conda.sh<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p> 完成后执行:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">source</span> ~/.bashrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>安装好后先更新 conda 和 pip:</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda update conda pip<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>帮助</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token punctuation">[</span>cmd<span class="token punctuation">]</span> --help<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>miniconda 下载 <a href="https://conda.io/miniconda.html"
class="uri">https://conda.io/miniconda.html</a><br> 安装参考 <a
href="https://conda.io/docs/user-guide/install/index.html"
class="uri">https://conda.io/docs/user-guide/install/index.html</a></p>
<h4 id="environment">environment</h4>
<p>默认环境为 base<br> <code>-n, --name &lt;env_name&gt;</code>
指定环境</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda create --name <span class="token operator">&lt;</span>env_name<span class="token operator">></span> <span class="token punctuation">[</span><span class="token operator">&lt;</span>packages<span class="token operator">></span><span class="token punctuation">]</span> <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3.6</span>
conda create --name <span class="token operator">&lt;</span>env_name<span class="token operator">></span> --clone base

<span class="token comment"># e.g.</span>
conda create --name intel intelpython3_core <span class="token assign-left variable">python</span><span class="token operator">=</span><span class="token number">3</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 删除环境</span>
conda-env remove --name <span class="token operator">&lt;</span>env_name<span class="token operator">></span>
*
<span class="token comment"># 列出信息</span>
conda info -e/--envs
conda-env list

<span class="token comment"># 进入环境</span>
<span class="token builtin class-name">source</span> activate <span class="token operator">&lt;</span>env_name<span class="token operator">></span>
conda activate <span class="token operator">&lt;</span>env_name<span class="token operator">></span>

<span class="token comment"># 离开环境</span>
<span class="token builtin class-name">source</span> deactivate
conda deactivate

<span class="token comment"># 在某环境中执行操作</span>
conda <span class="token operator">&lt;</span>commands<span class="token operator">></span> --name <span class="token operator">&lt;</span>env_name<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h4 id="使用-conda-命令">使用 conda 命令</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda info
conda list <span class="token punctuation">[</span><span class="token operator">&lt;</span>packages<span class="token operator">></span><span class="token punctuation">]</span>
conda search <span class="token operator">&lt;</span>package<span class="token operator">></span>
conda search <span class="token operator">&lt;</span>package<span class="token operator">></span> --info
conda <span class="token function">install</span> <span class="token operator">&lt;</span>packages<span class="token operator">></span>
conda update/upgrade <span class="token operator">&lt;</span>packages<span class="token operator">></span>
conda remove/uninstall <span class="token operator">&lt;</span>packages<span class="token operator">></span>
conda clean --all<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>见 <code>conda --help</code> 或 <code>conda cmd --help</code>,
<code>conda search</code> 语法见 <a
href="https://github.com/conda/conda/blob/master/conda/models/match_spec.py"
class="uri">https://github.com/conda/conda/blob/master/conda/models/match_spec.py</a></p>
<p>配置: <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># 安装确认时显示源的 url, 默认已开启</span>
conda config --set show_channel_urls True

<span class="token comment"># 禁止每次更新自动检查 conda 的更新, 默认True</span>
conda config --set auto_update_conda False

<span class="token comment"># 禁止源优先而使用版本优先, 默认True</span>
conda config --set channel_priority False

<span class="token comment"># 增加设置, 例如增加源 (可使用 url 或别名)</span>
conda config --add channels <span class="token operator">&lt;</span>channel<span class="token operator">></span>

<span class="token comment"># 删除某项设置的所有值, 例如删除所有自定义源</span>
conda config --remove-key channels

<span class="token comment"># 删除某项设置的某个值, 例如删除某个源</span>
conda config --remove channels <span class="token operator">&lt;</span>channel<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>用户配置文件 <code>~/.condarc</code> (见 <a
href="#conda-镜像源">conda 镜像源</a>)<br> 参考链接 <a
href="https://conda.io/docs/user-guide/configuration/use-condarc.html"
class="uri">https://conda.io/docs/user-guide/configuration/use-condarc.html</a></p>
<p>也可以在不同的环境用不同的配置文件:
<code>~/miniconda3/envs/&lt;env_name&gt;/.condarc</code></p>
<h3 id="镜像源">镜像源</h3>
<h4 id="pip-镜像源">pip 镜像源</h4>
<p>用户配置文件:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
<span class="token function">cat</span> ~/.pip/pip.conf<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>[global]
index-url = &lt;https://pypi.douban.com/simple&gt;
trusted-host = pypi.doubanio.com</code></pre>
<h4 id="conda-镜像源">conda 镜像源</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda config --add/--prepend channels <span class="token operator">&lt;</span>new_channel<span class="token operator">></span>
conda config --append channels <span class="token operator">&lt;</span>new_channel<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>清华源:<br> <a
href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/"
class="uri">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/main/</a><br>
<a href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/"
class="uri">https://mirrors.tuna.tsinghua.edu.cn/anaconda/pkgs/free/</a><br>
<a
href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/"
class="uri">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</a><br></p>
<p>channels 的默认的优先级为: 前排优先<br> 镜像源中
<code>pkgs/main</code> 通常比 <code>pkgs/free</code> 新,
因此将其放在最前.<br> 或使用 <code>channel_priority: false</code>,
见上一节 <a href="#使用-conda-命令">conda 设置</a>.</p>
<p>e.g.</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda config --add channels <span class="token operator">&lt;</span>https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>此时 <code>~/.condarc</code> 的内容:</p>
<blockquote>
<p>channels:<br>  - <a
href="https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/"
class="uri">https://mirrors.tuna.tsinghua.edu.cn/anaconda/cloud/conda-forge/</a><br>
 - defaults</p>
</blockquote>
<h3 id="troubleshooting">Troubleshooting</h3>
<h4 id="conda-安装时指定源且禁用其他源">conda
安装时指定源且禁用其他源</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> <span class="token operator">&lt;</span>packages<span class="token operator">></span> -c <span class="token operator">&lt;</span>channel<span class="token operator">></span> --override-channels<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h4 id="astropy-新版不再支持旧版-python">Astropy 新版不再支持旧版
Python</h4>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> <span class="token string">"astropy&lt;3.0"</span> <span class="token comment"># for python &lt; 3.5</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="安装常用包">安装常用包</h2>
<h3 id="numpy-scipy-matplotlib">numpy, scipy, matplotlib</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> numpy
conda <span class="token function">install</span> scipy
conda <span class="token function">install</span> matplotlib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p> Or <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> numpy
pip <span class="token function">install</span> scipy
pip <span class="token function">install</span> matplotlib<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>配置启动文件 (Ubuntu), 在 <code>~/.bashrc</code> 中添加:
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token builtin class-name">export</span> <span class="token assign-left variable">PYTHONSTARTUP</span><span class="token operator">=</span><span class="token environment constant">$HOME</span>/.pythonrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>pythonrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code># Python startup file
# ~/.pythonrc
import matplotlib.pyplot as plt
from matplotlib import cm
import numpy as np
import os

print(&quot;&gt;&gt;&gt; import matplotlib.pyplot as plt&quot;)
print(&quot;&gt;&gt;&gt; from matplotlib import cm&quot;)
print(&quot;&gt;&gt;&gt; import numpy as np&quot;)
print(&quot;&gt;&gt;&gt; import os&quot;)

try:
    from pprint import pprint
except ImportError:
    pass
else:
    print(&quot;&gt;&gt;&gt; from pprint import pprint&quot;)

# Tab completion &amp; history
try:
    import atexit, readline, rlcompleter
except ImportError:
    pass
else:
    readline.parse_and_bind(&#39;tab: complete&#39;) # Tab completion
    readline.parse_and_bind(&#39;&#39;&#39;control-l:&quot;    &quot;&#39;&#39;&#39;) # Indent, since TAB is occupied
    histfile = os.path.join(os.environ[&#39;HOME&#39;], &#39;.pyhistory&#39;) # History file
    try:
        readline.read_history_file(histfile)
    except IOError:
        pass
    atexit.register(readline.write_history_file, histfile)
    del histfile, readline, rlcompleter
    print(&quot;--- Tab completion: [ON] ---&quot;)
    print(&quot;--- History: [ON] ---&quot;)
    print(&quot;--- [Tab] -&gt; [Ctrl+L] ---&quot;)</code></pre>
<h3 id="astropy-sunpy">Astropy, SunPy</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> astropy
conda <span class="token function">install</span> sunpy -c conda-forge<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p> Or <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> astropy
pip <span class="token function">install</span> sunpy<span class="token punctuation">[</span>all<span class="token punctuation">]</span> pytest<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre></p>
<p>测试:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> astropy
<span class="token operator">>></span><span class="token operator">></span> astropy<span class="token punctuation">.</span>test<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sunpy
<span class="token operator">>></span><span class="token operator">></span> sunpy<span class="token punctuation">.</span>self_test<span class="token punctuation">(</span>online<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>如果出错: '$USER'权限问题, 见下面修改 <code>~/.sunpy/sunpyrc</code>
说明.</p>
<p>查看包信息:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
conda search <span class="token string">"conda-forge::sunpy>=4.0"</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>Loading channels: ...working... done
# Name                       Version           Build  Channel             
sunpy                          4.0.0 py310hde88566_0  conda-forge         
sunpy                          4.0.0  py38h71d37f0_0  conda-forge         
sunpy                          4.0.0  py39hd257fcd_0  conda-forge         
sunpy                          4.0.1 py310hde88566_0  conda-forge         
sunpy                          4.0.1  py38h71d37f0_0  conda-forge         
sunpy                          4.0.1  py39hd257fcd_0  conda-forge         
sunpy                          4.0.2 py310hde88566_0  conda-forge         
sunpy                          4.0.2  py38h71d37f0_0  conda-forge         
sunpy                          4.0.2  py39hd257fcd_0  conda-forge         
sunpy                          4.0.3 py310hde88566_0  conda-forge         
sunpy                          4.0.3  py38h71d37f0_0  conda-forge         
sunpy                          4.0.3  py39hd257fcd_0  conda-forge         </code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
conda search <span class="token string">"sunpy 4.0.3 py310hde88566_0"</span> --info<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>Loading channels: ...working... done
sunpy 4.0.3 py310hde88566_0
---------------------------
file name   : sunpy-4.0.3-py310hde88566_0.tar.bz2
name        : sunpy
version     : 4.0.3
build       : py310hde88566_0
build number: 0
size        : 5.7 MB
license     : BSD-2-Clause
subdir      : linux-64
url         : &lt;https://conda.anaconda.org/conda-forge/linux-64/sunpy-4.0.3-py310hde88566_0.tar.bz2&gt;
md5         : 5831b8fde0edd2aa0ff9f42b237b7ba2
timestamp   : 2022-07-08 16:21:32 UTC
dependencies: 
  - asdf &gt;=2.8.0
  - asdf-astropy &gt;=0.1.1
  - astropy &gt;=4.1.0
  - beautifulsoup4 &gt;=4.8.0
  - cdflib &gt;=0.3.19,!=0.4.0
  - drms &gt;=0.6.1
  - glymur &gt;=0.8.18,!=0.9.0,!=0.9.5
  - h5netcdf &gt;=0.8.1
  - h5py &gt;=3.1.0
  - libgcc-ng &gt;=12
  - matplotlib-base &gt;=3.2.0
  - mpl_animators &gt;=1.0.0
  - numpy &gt;=1.21.6,&lt;2.0a0
  - pandas &gt;=1.0.0
  - parfive &gt;=1.2.0
  - python &gt;=3.10,&lt;3.11.0a0
  - python-dateutil &gt;=2.8.0
  - python_abi 3.10.* *_cp310
  - reproject
  - scikit-image &gt;=0.16.0
  - scipy &gt;=1.3.0
  - setuptools
  - sqlalchemy &gt;=1.3.4
  - tqdm &gt;=4.32.1
  - zeep &gt;=3.4.0</code></pre>
<p>用户文件位置: <code>~/.sunpy/sunpyrc</code></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">cat <span class="token operator">~</span><span class="token operator">/</span><span class="token punctuation">.</span>sunpy<span class="token operator">/</span>sunpyrc<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>[general]
time_format = %Y-%m-%d %H:%M:%S
working_dir = /home/lydia/sunpy-downloads

[downloads]
download_dir = /home/lydia/sunpy-downloads/data
sample_dir = /home/lydia/sunpy-downloads/data/sample_data

[database]
url = sqlite:////home/lydia/sunpy-downloads/sunpydb.sqlite</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sunpy
sunpy<span class="token punctuation">.</span>util<span class="token punctuation">.</span>system_info<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>==============================
sunpy Installation Information
==============================

General
#######
OS: Ubuntu (18.04, Linux 4.19.128-microsoft-standard)
Arch: 64bit, (x86_64)
sunpy: 4.0.3
Installation path: /home/lydia/miniconda3/lib/python3.10/site-packages/sunpy-4.0.3.dist-info

Required Dependencies
#####################
astropy: 5.1
numpy: 1.23.1
packaging: 21.3
parfive: 1.5.1

Optional Dependencies
#####################
asdf: 2.12.0
asdf-astropy: 0.2.1
beautifulsoup4: 4.11.1
cdflib: 0.4.4
dask: 2022.7.0
drms: 0.6.2
glymur: 0.10.1
h5netcdf: 0.0.0
h5py: 3.7.0
matplotlib: 3.5.2
mpl-animators: 1.0.1
pandas: 1.4.1
python-dateutil: 2.8.2
reproject: 0.8
scikit-image: 0.19.3
scipy: 1.8.1
sqlalchemy: 1.4.39
tqdm: 4.64.0
zeep: 4.1.0</code></pre>
<p>设置下载位置:<br> (参考 <a
href="http://docs.sunpy.org/en/stable/guide/customization.html?highlight=sunpy.config.set)"
class="uri">http://docs.sunpy.org/en/stable/guide/customization.html?highlight=sunpy.config.set)</a></p>
<p>e.g. &gt; [downloads]<br>  download_dir = ...</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sunpy
<span class="token operator">>></span><span class="token operator">></span> sunpy<span class="token punctuation">.</span>config<span class="token punctuation">.</span><span class="token builtin">set</span><span class="token punctuation">(</span><span class="token string">'downloads'</span><span class="token punctuation">,</span> <span class="token string">'download_dir'</span><span class="token punctuation">,</span>
                 <span class="token string">'/home/&lt;user>/&lt;your_path>/sunpy-downloads/data'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>退出后再进入 python 如果发现没有修改成功, 则需要手动修改
~/.sunpy/sunpyrc 文件.<br> 不能用 '$USER' 代替具体的用户名
'&lt;user&gt;'</p>
<h3 id="jupyter">Jupyter</h3>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> jupyter -c conda-forge<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> Or <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> jupyter<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">%%bash
jupyter --path<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>config:
    /home/lydia/.jupyter
    /home/lydia/.local/etc/jupyter
    /home/lydia/miniconda3/etc/jupyter
    /usr/local/etc/jupyter
    /etc/jupyter
data:
    /home/lydia/.local/share/jupyter
    /home/lydia/miniconda3/share/jupyter
    /usr/local/share/jupyter
    /usr/share/jupyter
runtime:
    /home/lydia/.local/share/jupyter/runtime</code></pre>
<ul>
<li>设置双击打开 *.ipynb 文件</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> nbopen<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>再执行:</p>
<p>Linux/BSD: <br> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">python3 -m nbopen.install_xdg<span class="token operator">&lt;</span>br<span class="token operator">></span>
 ``<span class="token variable"><span class="token variable">`</span>   

Windows: <span class="token operator">&lt;</span>br<span class="token operator">></span>
<span class="token variable">`</span></span>``bash
python3 -m nbopen.install_win<span class="token operator">&lt;</span>br<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>Mac: <br>  Clone the repository
(https://github.com/takluyver/nbopen.git)<br>  and run
<code>./osx-install.sh</code><br><br>
之后即可在文件浏览器中选择文件的打开方式为
<code>Jupyter Notebook</code>.</p>
<blockquote>
<p>注意可能会更改 bash 脚本的默认打开方式.</p>
</blockquote>
<ul>
<li>Jupyter
插件集合<br>(https://github.com/ipython-contrib/jupyter_contrib_nbextensions)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> jupyter_contrib_nbextensions -c conda-forge<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> Or <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> jupyter_contrib_nbextensions<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> &gt; This also automatically installs the
Javascript and CSS files:<br>
<code>jupyter contrib nbextension install --sys-prefix</code></p>
<p>安装好后将同时启用 <code>Nbextensions</code> 选项卡,
手动选择需要的插件, 或者在命令行启用和禁用:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">jupyter nbextension list <span class="token comment"># 查看</span>
jupyter nbextension <span class="token builtin class-name">enable</span> <span class="token operator">&lt;</span>path<span class="token operator">></span> <span class="token comment"># &lt;path> 为上述 list 中的 &lt;extension>/main</span>
jupyter nbextension disable <span class="token operator">&lt;</span>path<span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>注意用如果 jupyter 安装在 conda 路径, 手动安装插件
(<code>jupyter nbextension install</code>) 时需要指定
<font color=red>--sys-prefix</font></p>
<ul>
<li>notebook 主题 (https://github.com/dunovank/jupyter-themes)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> jupyterthemes<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>演示代码过程的插件 (https://github.com/lgpage/nbtutor)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> nbtutor -c conda-forge<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p> Or <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> nbtutor
jupyter nbextension <span class="token function">install</span> --overwrite --py nbtutor
jupyter nbextension <span class="token builtin class-name">enable</span> --py nbtutor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<p>载入:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ipython/jupyter</span>
<span class="token operator">%</span>load_ext nbtutor<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>使用:<br> CodeCell 中首行加入下面语句, 然后执行 Cell (numpy 等需要在
Cell 内导入) <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ipython/jupyter</span>
<span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f
<span class="token comment"># 或</span>
<span class="token operator">%</span><span class="token operator">%</span>nbtutor <span class="token operator">-</span>r <span class="token operator">-</span>f <span class="token operator">-</span>i  <span class="token comment"># 缩减显示</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre></p>
<h3 id="其他">其他</h3>
<ul>
<li>PeakUtils (http://peakutils.readthedocs.io/en/latest/)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">git</span> clone <span class="token operator">&lt;</span>https://bitbucket.org/lucashnegri/peakutils.git<span class="token operator">></span>
<span class="token builtin class-name">cd</span> peakutils
python setup.py <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> peakutils<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>LMfit-py (https://github.com/lmfit/lmfit-py)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> lmfit -c conda-forge
<span class="token comment"># 或</span>
pip <span class="token function">install</span> lmfit<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> lmfit<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>HDF5包 (http://docs.h5py.org/en/latest/index.html)<br></li>
</ul>
<p><strong>pandas</strong> <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> pytables pandas<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>  Or <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> tables pandas<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> <br><br>
<strong>h5py</strong> (http://docs.h5py.org/en/latest/index.html)
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">conda <span class="token function">install</span> h5py  <span class="token comment"># 推荐. 将同时安装 hdf5, 并得到 h5dump 等命令</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>  Or <pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> h5py  <span class="token comment"># 需要 sudo apt-get install libhdf5-dev</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
<ul>
<li>CDF包<br></li>
</ul>
<p>安装 spacepy (https://pythonhosted.org/SpacePy)</p>
<p>或</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> cdflib <span class="token comment"># &lt;https://github.com/MAVENSDC/cdflib></span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>EVTK (https://bitbucket.org/pauloh/pyevtk)</li>
</ul>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">sudo</span> <span class="token function">apt-get</span> <span class="token function">install</span> mercurial  <span class="token comment"># 得到 hg 命令</span>

<span class="token function">hg</span> clone <span class="token operator">&lt;</span>https://bitbucket.org/pauloh/pyevtk<span class="token operator">></span>
<span class="token builtin class-name">cd</span> pyevtk
python setup.py build --debug <span class="token function">install</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token function">hg</span> pull <span class="token operator">&amp;&amp;</span> <span class="token function">hg</span> update default <span class="token comment"># 更新</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> evtk<span class="token punctuation">.</span>hl <span class="token keyword">import</span> gridToVTK<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<ul>
<li>Mayavi (http://docs.enthought.com/mayavi/mayavi)</li>
</ul>
<p> 需要先安装 cython (conda 或 pip)</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash">pip <span class="token function">install</span> mayavi  <span class="token comment"># 将同时安装 vtk. (pip 是目前 mayavi 最保险的安装方式)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># shell</span>
mayavi2<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Solar Physics</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>conda</tag>
        <tag>jupyter</tag>
        <tag>astropy</tag>
        <tag>sunpy</tag>
        <tag>install</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 简易教程 (lecture for Solar Group)</title>
    <url>//main.html</url>
    <content><![CDATA[<p><a
href="/downloads/notebooks/python-intro.zip"><i class="fas fa-download"></i>
Jupyter Notebook</a></p>
<h2 id="简介">简介</h2>
<p>优势: 开源, 用户广, 用途广, 社区完善, 新手友好</p>
<p><a
href="https://www.jetbrains.com/research/python-developers-survey-2017/"
class="uri">https://www.jetbrains.com/research/python-developers-survey-2017/</a>
<br><br> 2017年的 python 使用调查报告 <a
href="https://www.jetbrains.com/research/python-developers-survey-2017/"
class="uri">https://www.jetbrains.com/research/python-developers-survey-2017/</a>
<img src='/main/Python Developers Survey 2017 - Results-018.png' >
<img src='/main/Python Developers Survey 2017 - Results-019.png' >
<img src='/main/Python Developers Survey 2017 - Results-020.png' ></p>
<p>参考网站:</p>
<ul>
<li>官方网站: <a href="https://www.python.org/"
class="uri">https://www.python.org/</a></li>
<li>stackoverflow <a
href="https://stackoverflow.com/questions/tagged/python"
class="uri">https://stackoverflow.com/questions/tagged/python</a></li>
<li>官方文档 <a href="https://docs.python.org"
class="uri">https://docs.python.org</a></li>
<li>廖雪峰的网站 (包含 python2.7 和 python3 的教程) <a
href="https://www.liaoxuefeng.com"
class="uri">https://www.liaoxuefeng.com</a></li>
<li>wikibooks <a href="https://en.wikibooks.org/wiki/Python_Programming"
class="uri">https://en.wikibooks.org/wiki/Python_Programming</a></li>
<li>演示代码执行过程的工具 <a href="http://pythontutor.com/"
class="uri">http://pythontutor.com/</a></li>
<li>天文相关教程 (较新) <a href="https://python4astronomers.github.io"
class="uri">https://python4astronomers.github.io</a></li>
</ul>
<p><br> 获取 python 包/模块/函数的帮助:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">help</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-sh" data-language="sh"><code class="language-sh"># shell
$ pydoc &lt;name&gt;
$ pydoc -w &lt;name&gt;  # 生成一个 html 帮助文件<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ipython/jupyter</span>
name?  <span class="token comment"># 弹出帮助文档, `Esc` 退出文档</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<span id="more"></span>
<h2 id="基本语法">基本语法</h2>
<h3 id="语法特点">语法特点</h3>
<ul>
<li>对象编程的概念<br> 类 -&gt; 创建一个实例 -&gt;
使用该实例所属的类下面的方法 <pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># l 是 list 的一个实例</span>
l<span class="token punctuation">.</span>reverse<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># reverse 是一个方法(函数), reverse() 是一个实例</span>
l<span class="token punctuation">.</span>__dir__<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># 查看 l 的所有方法(函数)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre> <br></li>
<li>严格缩进 (通常采用4个半角空格) <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> a <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">:</span>
      a <span class="token operator">+=</span> <span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre> <br></li>
<li>空格不敏感 <pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">+</span> b <span class="token operator">*</span> c <span class="token operator">**</span> <span class="token number">2</span> <span class="token operator">/</span> d
f <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre> <br></li>
<li>大小写敏感, 使用大小写组合的变量名风格
(下划线仍是合法变量名字符,但有特殊含义, 见 <a
href="advance.html#脚本相关">Python 进阶#脚本相关</a>) <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>interpolate <span class="token keyword">import</span> BSpline<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pandas <span class="token keyword">as</span> pd
dataFrame <span class="token operator">=</span> pd<span class="token punctuation">.</span>DataFrame<span class="token punctuation">(</span>array<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre> 见 <a href="#IDL-sav-文件读取">IDL sav 文件读取</a>
<br><br></li>
<li>括号内换行不用换行符 <br><br></li>
<li>单行注释 <code># ...</code> <br><br></li>
<li>多行注释<br> 函数或模块的开头的多行注释
(将存储在<code>__doc__</code>变量), 可以用 <code>help()</code> 打印
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token triple-quoted-string string">"""
这是一个
多行注释
"""</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre> <br></li>
<li>同一行不同语句之间可用分号分隔 <pre class="line-numbers language-python" data-language="python"><code class="language-python">x <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span> <span class="token keyword">print</span><span class="token punctuation">(</span>x<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> <br></li>
<li>列表和数组的索引默认从<font color=red>0</font>开始 <br><br></li>
<li>列表的最后一个元素可以加逗号 <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">]</span>
<span class="token punctuation">&#123;</span><span class="token string">'a'</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre> <br></li>
<li><em>etc.</em></li>
</ul>
<h3 id="print函数">print函数</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1.</span><span class="token punctuation">;</span> b <span class="token operator">=</span> <span class="token number">2.</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a=%.3f, b=%.1e'</span> <span class="token operator">%</span> <span class="token punctuation">(</span>a<span class="token punctuation">,</span> b<span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>a=1.000, b=2.0e+00</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string-interpolation"><span class="token string">f'a=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>a<span class="token punctuation">&#125;</span></span><span class="token string">, b=</span><span class="token interpolation"><span class="token punctuation">&#123;</span>b<span class="token punctuation">:</span><span class="token format-spec">.3f</span><span class="token punctuation">&#125;</span></span><span class="token string">'</span></span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>a=1.0, b=2.000</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>python2
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yyy'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>xxx yyy</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span><span class="token operator">%</span>python3
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'xxx'</span><span class="token punctuation">,</span> end<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'yyy'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>xxx yyy</code></pre>
<p>更多格式化参考 <a href="https://pyformat.info/"
class="uri">https://pyformat.info/</a></p>
<h3 id="基本运算">基本运算</h3>
<p>运算符参考:<br> <a
href="https://en.wikibooks.org/wiki/Python_Programming/Basic_Math"
class="uri">https://en.wikibooks.org/wiki/Python_Programming/Basic_Math</a><br>
<a
href="https://www.tutorialspoint.com/python/python_basic_operators.htm"
class="uri">https://www.tutorialspoint.com/python/python_basic_operators.htm</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token number">1</span>
a <span class="token operator">+=</span> <span class="token number">1</span>  <span class="token comment"># 没有 a++ 这种语法</span>
a<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>2</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">3.</span> <span class="token operator">**</span> <span class="token number">2</span>  <span class="token comment"># 自动转换数据类型</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>9.0</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token number">1</span> <span class="token operator">&lt;</span> <span class="token number">2</span> <span class="token operator">!=</span> <span class="token number">3</span>  <span class="token comment"># 判断, 可以连写</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>True</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> <span class="token boolean">None</span>
a <span class="token keyword">is</span> <span class="token boolean">None</span>  <span class="token comment"># 注意这时不用 `==`</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>True</code></pre>
<h3 id="字符串">字符串</h3>
<p>用双引号和单引号皆可 (取决于所引内容).<br> 字符串具有和列表 (list)
类似的运算规则 (见之后的 list 说明):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">'a'</span> <span class="token operator">*</span> <span class="token number">10</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;aaaaaaaaaa&#39;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">'a'</span> <span class="token operator">+</span> <span class="token string">'b'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;ab&#39;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token string">'abc'</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>&#39;a&#39;</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'\n'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">r'\n'</span><span class="token punctuation">)</span>  <span class="token comment"># same as '\\n'</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>\n</code></pre>
<h3 id="list-tuple-dict-set">list, tuple, dict, set</h3>
<ul>
<li>有序表 list, tuple</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>  <span class="token comment"># list, 元素可变</span>
t <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># tuple, 元素不可变</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>  <span class="token comment"># 一个切片(slice)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>[0, 1, 2]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">t<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>(0, 1, 2)</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>  <span class="token comment"># 索引: [start, stop, step] (结果不包含 stop)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>[1, 3]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l<span class="token punctuation">[</span><span class="token number">5</span><span class="token punctuation">:</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>  <span class="token comment"># step &lt; 0, 仍然不包含 stop (此例中 stop=1)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>[5, 4, 3, 2]</code></pre>
<p>list 常用运算</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span>
l<span class="token punctuation">.</span>append<span class="token punctuation">(</span><span class="token string">'x'</span><span class="token punctuation">)</span>  <span class="token comment"># 添加在最后</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>
l<span class="token punctuation">.</span>insert<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token string">'y'</span><span class="token punctuation">)</span>  <span class="token comment"># 添加在 l[i] 之前</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">.</span>pop<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 删除某元素并返回该值</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>l<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>[0, 1, 2, 3, 4, 5, &#39;x&#39;]
[0, 1, 2, &#39;y&#39;, 3, 4, 5, &#39;x&#39;]
1
[0, 2, &#39;y&#39;, 3, 4, 5, &#39;x&#39;]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">print</span><span class="token punctuation">(</span>l <span class="token operator">*</span> <span class="token number">2</span><span class="token punctuation">)</span>  <span class="token comment"># 重复N遍</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>l <span class="token operator">+</span> <span class="token punctuation">[</span><span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 合并两个list</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>[1, &#39;y&#39;, 2, 3, 4, 5, &#39;x&#39;, 1, &#39;y&#39;, 2, 3, 4, 5, &#39;x&#39;]
[1, &#39;y&#39;, 2, 3, 4, 5, &#39;x&#39;, 6, 7]</code></pre>
<p>list 可以排序 (当元素为同一类型且可比较大小时), 返回到原列表</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">,</span> <span class="token string">'a'</span><span class="token punctuation">]</span>
l<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>[&#39;a&#39;, &#39;b&#39;]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span>
l<span class="token punctuation">.</span>sort<span class="token punctuation">(</span><span class="token punctuation">)</span>
l<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>[1, 2]</code></pre>
<ul>
<li>字典 dict</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token string">'a'</span> <span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token string">'b'</span> <span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d <span class="token operator">=</span> <span class="token builtin">dict</span><span class="token punctuation">(</span>a<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">2</span><span class="token punctuation">)</span> <span class="token comment"># 注意这时没有引号</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">d<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>1</code></pre>
<ul>
<li>集合 set</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">s <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">&#125;</span>  <span class="token comment"># set, 将自动排序并去除重复, 常用于 for 循环</span>
s  <span class="token comment"># 不能用 s[i] 来索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>&#123;1, 2, 3&#125;</code></pre>
<p>set 不可索引, 但可用作 for 循环. 见 <a
href="advance.html#循环,-迭代器,-生成器">Python 进阶#迭代器</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">:</span>
    <span class="token keyword">print</span><span class="token punctuation">(</span>i<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>1
2
3</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">l2 <span class="token operator">=</span> <span class="token punctuation">[</span>i <span class="token keyword">for</span> i <span class="token keyword">in</span> s<span class="token punctuation">]</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>l2<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>[1, 2, 3]</code></pre>
<h3 id="if-语句">if 语句</h3>
<p>python 里没有 <code>case</code>, 只有 <code>if</code>
(非零数值、非空字符串、非空 list 等皆为 True) <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">if</span> <span class="token operator">&lt;</span>条件判断<span class="token number">1</span><span class="token operator">></span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>执行<span class="token number">1</span><span class="token operator">></span>
<span class="token keyword">elif</span> <span class="token operator">&lt;</span>条件判断<span class="token number">2</span><span class="token operator">></span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>执行<span class="token number">2</span><span class="token operator">></span>
<span class="token keyword">elif</span> <span class="token operator">&lt;</span>条件判断<span class="token number">3</span><span class="token operator">></span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>执行<span class="token number">3</span><span class="token operator">></span>
<span class="token keyword">else</span><span class="token punctuation">:</span>
    <span class="token operator">&lt;</span>执行<span class="token number">4</span><span class="token operator">></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<h3 id="相关工具">相关工具</h3>
<h4 id="pip">pip</h4>
<p><img src='/main/logo-large.72ad8bf1.svg' /></p>
<blockquote>
<p>The <strong>Python Package Index (PyPI)</strong> is a repository of
software for the Python programming language.<br/> PyPI helps you find
and install software developed and shared by the Python community.<br/>
<a href="https://pypi.org/" class="uri">https://pypi.org/</a></p>
</blockquote>
<pre class="line-numbers language-none"><code class="language-none">$ pip install &lt;pkg_name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>    (其他命令见 <a href="installpy.html#用-pip-安装-python-包">Python
安装和配置#用 pip 安装 python 包</a>)</p>
<h4 id="anaconda">Anaconda</h4>
<p><img src='/main/DataScienceLibraries-01.png' />
<img src='/main/Conda-DistributionDiagram-01.png' /></p>
<p><img src='/main/Conda — Conda documentation.png' /></p>
<p><strong>Anaconda</strong> (https://www.anaconda.com/)<br> 安装好的
conda 包含独立于系统的 python 版本, 一部分已编译好的包, pip 工具,
以及不同环境的子目录.<br/> 可根据需要切换不同的 conda 环境以使用不同的
python 版本或不同的包的组合.</p>
<pre class="line-numbers language-none"><code class="language-none">$ conda install &lt;pkg_name&gt;<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>其他命令见 <a href="installpy.html#使用-conda-命令">Python
安装和配置#使用 conda 命令</a><br> 详细说明见 <a
href="advance.html#Anaconda">Python 进阶#Anaconda</a></p>
<h4 id="ipython-jupyter">IPython &amp; Jupyter</h4>
<p><img style='float: center;' src='/main/IPython.png' /></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># Have a look (ipython)</span>
!cd <span class="token operator">&amp;</span><span class="token operator">&amp;</span> gnome<span class="token operator">-</span>terminal <span class="token operator">-</span><span class="token operator">-</span>window<span class="token operator">-</span><span class="token keyword">with</span><span class="token operator">-</span>profile<span class="token operator">=</span><span class="token string">'lydia_white'</span>
!sleep <span class="token number">0.5</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> xdotool <span class="token builtin">type</span> <span class="token operator">-</span><span class="token operator">-</span>delay <span class="token number">200</span> <span class="token string">"ipython"</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> xdotool key Return
!sleep <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> xdotool <span class="token builtin">type</span> <span class="token operator">-</span><span class="token operator">-</span>delay <span class="token number">200</span> <span class="token string">"!idl"</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> xdotool key Return
!sleep <span class="token number">3</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> xdotool key Ctrl<span class="token operator">+</span>d
!sleep <span class="token number">1</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> xdotool <span class="token builtin">type</span> <span class="token operator">-</span><span class="token operator">-</span>delay <span class="token number">200</span> <span class="token string">"!csh -c sswidl"</span> <span class="token operator">&amp;</span><span class="token operator">&amp;</span> xdotool key Return<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<center>
<a href="http://jupyter.org/" class="uri">http://jupyter.org/</a>
</center>
<p><img style='float: center;' src='/main/jupyterlogo.png' /></p>
<center>
<a href="https://nbviewer.jupyter.org/"
class="uri">https://nbviewer.jupyter.org/</a>
</center>
<p><img style='float: center;' src='/main/nbviewer.png' /></p>
<p>参考文档 <a href="http://jupyter-notebook.readthedocs.io/en/stable/"
class="uri">http://jupyter-notebook.readthedocs.io/en/stable/</a></p>
<ul>
<li>打开 <code>jupyter notebook</code>:</li>
</ul>
<pre class="line-numbers language-none"><code class="language-none">$ jupyter notebook [filename]<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<h2 id="常用包介绍">常用包介绍</h2>
<h3 id="python-自带包和模块">Python 自带包和模块</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> math <span class="token keyword">import</span> <span class="token operator">*</span> <span class="token comment"># 包含 pi 等, 但更推荐 numpy</span>
<span class="token keyword">from</span> copy <span class="token keyword">import</span> deepcopy
<span class="token keyword">from</span> pprint <span class="token keyword">import</span> pprint  <span class="token comment"># 打印 list, dict 等更好看</span>
<span class="token keyword">import</span> requests
<span class="token keyword">import</span> os
<span class="token keyword">import</span> sys<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="numpy-scipy">NumPy, SciPy</h3>
<h4 id="概览">概览</h4>
<center>
<a href="https://www.scipy.org" class="uri">https://www.scipy.org</a>
</center>
<p><img src='/main/SciPy.png' /></p>
<center>
<a href="http://scikit-image.org"
class="uri">http://scikit-image.org</a>
</center>
<p><img src='/main/scikitlogo.png' />
<img src='/main/skimage01.png' /></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>导入包的不同方式将在各例子中看到.</p>
<p>参考:</p>
<ul>
<li>NumPy User Guide <a href="https://docs.scipy.org/doc/numpy/user/"
class="uri">https://docs.scipy.org/doc/numpy/user/</a></li>
<li>NumPy Reference <a
href="https://docs.scipy.org/doc/numpy/reference/"
class="uri">https://docs.scipy.org/doc/numpy/reference/</a></li>
<li>ndarray<br><a
href="https://docs.scipy.org/doc/numpy/reference/arrays.ndarray.html"
class="uri">https://docs.scipy.org/doc/numpy/reference/arrays.ndarray.html</a></li>
<li>Array manipulation routines<br><a
href="https://docs.scipy.org/doc/numpy/reference/routines.array-manipulation.html"
class="uri">https://docs.scipy.org/doc/numpy/reference/routines.array-manipulation.html</a></li>
<li>SciPy Cookbook <a href="http://scipy-cookbook.readthedocs.io/"
class="uri">http://scipy-cookbook.readthedocs.io/</a></li>
<li>与 IDL 的语法对照
<ul>
<li><a href="http://mathesaurus.sourceforge.net/idl-numpy.html"
class="uri">http://mathesaurus.sourceforge.net/idl-numpy.html</a></li>
<li><a
href="http://blog.rtwilson.com/ten-little-idl-programs-in-python/"
class="uri">http://blog.rtwilson.com/ten-little-idl-programs-in-python/</a></li>
<li><a href="http://www.astrobetter.com/blog/2009/05/04/idl-vs-python/"
class="uri">http://www.astrobetter.com/blog/2009/05/04/idl-vs-python/</a></li>
</ul></li>
</ul>
<h4 id="生成-numpy.ndarray-数组">生成 numpy.ndarray 数组</h4>
<p>将 list 或 tuple 转换为 <code>numpy.ndarray</code> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token comment"># 切片(slice), 索引可以是 int 或 list (python list 只支持 list作为索引)</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>          <span class="token comment"># 0</span>
a<span class="token punctuation">[</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>         <span class="token comment"># 4</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>        <span class="token comment"># array([0, 1, 2]) 注意!</span>
a<span class="token punctuation">[</span><span class="token punctuation">:</span><span class="token number">3</span><span class="token punctuation">]</span>         <span class="token comment"># array([0, 1, 2])</span>
a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">]</span>        <span class="token comment"># array([2, 3])</span>
a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>       <span class="token comment"># array([2, 3]) 注意!</span>
a<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token punctuation">]</span>         <span class="token comment"># array([2, 3, 4])</span>
a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">:</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">]</span>      <span class="token comment"># array([0, 2])</span>
a<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">:</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">]</span>     <span class="token comment"># array([4, 3])</span>
a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">]</span>  <span class="token comment"># array([1, 4, 3]) 花式切片, 索引是一个 list (不能是tuple)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre></p>
<p>多维:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[0, 1, 2],
       [3, 4, 5]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>array<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a
<span class="token comment"># 这里的tuple已转成ndarray, 于是结果是可变的</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>array([[0, 1, 2],
       [3, 4, 5]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>1</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>1</code></pre>
<p>从一维数组转变为多维:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a
<span class="token comment"># reshape 的参数为 &lt; 0 表示该维度自动判断元素个数</span>
<span class="token comment"># reshape 的参数是一个 list 或 tuple, 括号可以展开 (详见帮助文档)</span>
<span class="token comment"># 此例中 reshape((3, 2)), reshape(3, 2), reshape((3, -1)), reshape(3, -1) 等价</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">b <span class="token operator">=</span> a<span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> b  <span class="token comment"># reshape 的参数只有一个维度且 &lt; 0(自动)  => 展开成一维</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([ 0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11])</code></pre>
<p>花式切片的多维例子:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span>
a<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span><span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">]</span>
<span class="token comment"># a[col_inds, row_inds], 此例等价于 a[[[0, 1], [0, 2]]], a[([0, 1], [0, 2])]</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>array([0, 6])</code></pre>
<ul>
<li><strong>np.zeros</strong>(shape,
dtype=float), <strong>np.ones</strong>(shape, dtype=float)</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>zeros<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 默认浮点型</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[0., 0., 0.],
       [0., 0., 0.]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 默认浮点型</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[1., 1., 1.],
       [1., 1., 1.]])</code></pre>
<ul>
<li><strong>np.arange</strong>([start,] stop[, step,], dtype=None)</li>
</ul>
<p>生成的数组元素数据类型和参数一致.<br><br> 方便记忆: 最简形式
<code>np.arange</code>(<em>N</em>) 中的整数 <em>N</em> 即为
<em>元素个数</em>.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[0, 1],
       [2, 3],
       [4, 5]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[0, 1],
       [2, 3],
       [4, 5]])</code></pre>
<ul>
<li><strong>np.linspace</strong>(start, stop, num=50,
<strong>endpoint=True</strong>, retstep=False, dtype=None)<br>
默认生成的元素是浮点型<br> 注意 <code>np.linspace</code> 和
<code>np.arange</code> 的不同规则</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([0., 1.])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>linspace<span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> endpoint<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span> <span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([0. , 0.5])</code></pre>
<p>更多数组创建方法见 numpy 官网:<br> <a
href="https://docs.scipy.org/doc/numpy/reference/routines.array-creation.html"
class="uri">https://docs.scipy.org/doc/numpy/reference/routines.array-creation.html</a><br>
<a
href="https://docs.scipy.org/doc/numpy/user/basics.creation.html#arrays-creation"
class="uri">https://docs.scipy.org/doc/numpy/user/basics.creation.html#arrays-creation</a></p>
<ul>
<li>转置</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a <span class="token operator">=</span> np<span class="token punctuation">.</span>arange<span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">.</span>reshape<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">;</span> a<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[ 0,  1,  2,  3],
       [ 4,  5,  6,  7],
       [ 8,  9, 10, 11]])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">a<span class="token punctuation">.</span>T<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([[ 0,  4,  8],
       [ 1,  5,  9],
       [ 2,  6, 10],
       [ 3,  7, 11]])</code></pre>
<p>更多数组操作见 numpy 官网 <a
href="https://docs.scipy.org/doc/numpy/reference/routines.array-manipulation.html"
class="uri">https://docs.scipy.org/doc/numpy/reference/routines.array-manipulation.html</a>
矩阵操作见 <a href="advance.html#矩阵">Python 进阶#矩阵</a></p>
<h3 id="matplotlib">Matplotlib</h3>
<ul>
<li><p>官方示例 <a href="https://matplotlib.org/tutorials/index.html"
class="uri">https://matplotlib.org/tutorials/index.html</a>
<img src='/main/Matplotlib.png' />
<img src='/main/annotation_demo2_00.png' />
<img src='/main/contour_demo_05.png' /></p></li>
<li><p>官方教程 <a
href="https://matplotlib.org/tutorials/introductory/usage.html"
class="uri">https://matplotlib.org/tutorials/introductory/usage.html</a></p></li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<p>创建一个图像 (三种写法皆可):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fig<span class="token punctuation">,</span> ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplots<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">12</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> fig<span class="token punctuation">.</span>add_subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">)</span>  <span class="token comment"># 数字 (ijk) 表示: 这是一共i行j列中的组图中的第k个图</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>gcf<span class="token punctuation">(</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>gca<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>获取帮助:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">help</span><span class="token punctuation">(</span>ax<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 查看某对象包含的方法</span>
ax<span class="token punctuation">.</span><span class="token comment"># &lt;Tab>, &lt;Shift-Tab></span>
plt<span class="token punctuation">.</span><span class="token comment"># &lt;Tab>, &lt;Shift-Tab></span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>例:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>matplotlib?<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>matplotlib
<span class="token operator">%</span>run <span class="token operator">-</span>e <span class="token string">'examples/test_plot.py'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>matplotlib
<span class="token operator">%</span>run <span class="token operator">-</span>e <span class="token string">'examples/test_imshow.py'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<ul>
<li>颜色 <a
href="https://matplotlib.org/examples/color/colormaps_reference.html"
class="uri">https://matplotlib.org/examples/color/colormaps_reference.html</a></li>
<li>legend <a href="https://matplotlib.org/users/legend_guide.html"
class="uri">https://matplotlib.org/users/legend_guide.html</a> <br>
<img src='/main/named_colors.png' /></li>
</ul>
<h3 id="天文相关包">天文相关包</h3>
<h4 id="astropy">Astropy</h4>
<p><img src='/main/astropy_banner.svg' /></p>
<p>官方文档 <a href="http://docs.astropy.org/en/stable/index.html"
class="uri">http://docs.astropy.org/en/stable/index.html</a></p>
<p>坐标系统 <a
href="http://docs.astropy.org/en/stable/coordinates/index.html"
class="uri">http://docs.astropy.org/en/stable/coordinates/index.html</a></p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> astropy <span class="token keyword">import</span> units <span class="token keyword">as</span> u
<span class="token keyword">from</span> astropy<span class="token punctuation">.</span>coordinates <span class="token keyword">import</span> SkyCoord<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>参考 <a
href="https://python4astronomers.github.io/astropy/astropy.html"
class="uri">https://python4astronomers.github.io/astropy/astropy.html</a></p>
<h4 id="sunpy">SunPy</h4>
<p><img src='/main/Screenshot_20180625-005924.png' />
<img src='/main/sphx_glr_lat_lon_lines_001.png' />
<img src='/main/sphx_glr_submaps_and_cropping_001.png' /></p>
<p><br> HMI 示例见 <a href="advance.html#SunPy-示例">Python 进阶#SunPy
示例</a><br> <a
href="https://coding.net/u/lydiazly/p/scripts-sunpy/git?public=true"
class="uri">https://coding.net/u/lydiazly/p/scripts-sunpy/git?public=true</a></p>
<p><br><br> 参考:</p>
<ul>
<li>Gallery <a
href="http://docs.sunpy.org/en/stable/generated/gallery/index.html"
class="uri">http://docs.sunpy.org/en/stable/generated/gallery/index.html</a></li>
<li>SunPy Guide <a
href="http://docs.sunpy.org/en/stable/guide/index.html"
class="uri">http://docs.sunpy.org/en/stable/guide/index.html</a></li>
<li>SunPy Map<br><a
href="http://docs.sunpy.org/en/stable/code_ref/map.html#sunpy.map.mapbase.GenericMap"
class="uri">http://docs.sunpy.org/en/stable/code_ref/map.html#sunpy.map.mapbase.GenericMap</a></li>
<li>Example Gallery <a
href="http://docs.sunpy.org/en/stable/generated/gallery/index.html"
class="uri">http://docs.sunpy.org/en/stable/generated/gallery/index.html</a></li>
<li>A brief tour of SunPy <a
href="http://docs.sunpy.org/en/stable/guide/tour.html"
class="uri">http://docs.sunpy.org/en/stable/guide/tour.html</a></li>
<li>Finding and Downloading Data using Fido<br><a
href="http://docs.sunpy.org/en/stable/guide/acquiring_data/fido.html"
class="uri">http://docs.sunpy.org/en/stable/guide/acquiring_data/fido.html</a></li>
</ul>
<p>简单的例子 (来自官网):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">%</span>matplotlib inline

<span class="token keyword">import</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span>
<span class="token keyword">import</span> matplotlib<span class="token punctuation">.</span>pyplot <span class="token keyword">as</span> plt
<span class="token keyword">import</span> sunpy<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sample

aia <span class="token operator">=</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">.</span>Map<span class="token punctuation">(</span>sunpy<span class="token punctuation">.</span>data<span class="token punctuation">.</span>sample<span class="token punctuation">.</span>AIA_171_IMAGE<span class="token punctuation">)</span>

fig <span class="token operator">=</span> plt<span class="token punctuation">.</span>figure<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> dpi<span class="token operator">=</span><span class="token number">100</span><span class="token punctuation">)</span>
ax <span class="token operator">=</span> plt<span class="token punctuation">.</span>subplot<span class="token punctuation">(</span><span class="token number">111</span><span class="token punctuation">,</span> projection<span class="token operator">=</span>aia<span class="token punctuation">)</span>

aia<span class="token punctuation">.</span>plot<span class="token punctuation">(</span><span class="token punctuation">)</span>
aia<span class="token punctuation">.</span>draw_limb<span class="token punctuation">(</span><span class="token punctuation">)</span>
aia<span class="token punctuation">.</span>draw_grid<span class="token punctuation">(</span><span class="token punctuation">)</span>
aia<span class="token punctuation">.</span>draw_limb<span class="token punctuation">(</span><span class="token punctuation">)</span>
plt<span class="token punctuation">.</span>colorbar<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

<span class="token comment"># plt.show()</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>/home/lydia/miniconda3/lib/python3.6/site-packages/sunpy/map/sources/sdo.py:48: SunpyDeprecationWarning: Use Matplotlib to load the colormaps
  self.plot_settings[&#39;cmap&#39;] = cm.get_cmap(self._get_cmap_name())</code></pre>
<figure>
<img src="/main/main_126_1.png" alt="png" />
<figcaption aria-hidden="true">png</figcaption>
</figure>
<p>获取一些常数:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> sunpy<span class="token punctuation">.</span>sun <span class="token keyword">import</span> constants <span class="token keyword">as</span> con
<span class="token comment"># one astronomical unit (the average distance between the Sun and Earth)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>con<span class="token punctuation">.</span>au<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>  Name   = Astronomical Unit
  Value  = 149597870700.0
  Uncertainty  = 0.0
  Unit  = m
  Reference = IAU 2012 Resolution B2</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># the solar radius</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>con<span class="token punctuation">.</span>radius<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<pre><code>  Name   = Solar radius
  Value  = 695508000.0
  Uncertainty  = 26000.0
  Unit  = m
  Reference = Allen&#39;s Astrophysical Quantities 4th Ed.</code></pre>
<h2 id="常见数据文件读写">常见数据文件读写</h2>
<h3 id="一般情况">一般情况</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">f <span class="token operator">=</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span>  <span class="token comment"># 'w', 'r', ...</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
f<span class="token punctuation">.</span>close<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<p>更好的用法: <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span>filename<span class="token punctuation">,</span> <span class="token string">'w'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>  <span class="token comment"># 'w', 'r', ...</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre></p>
<h3 id="txt-csv-文件读写">txt, csv 文件读写</h3>
<ul>
<li>逐行读取整行的方式:<br> 使用 <code>strip</code>
可以用来去掉读入的每行末尾的 ''</li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">lines <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'data/data.csv'</span><span class="token punctuation">,</span> <span class="token string">'r'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">for</span> line <span class="token keyword">in</span> f<span class="token punctuation">:</span>
        lines<span class="token punctuation">.</span>append<span class="token punctuation">(</span>line<span class="token punctuation">.</span>strip<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">','</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
lines<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>[[&#39;col1&#39;, &#39;col2&#39;, &#39;col3&#39;],
 [&#39;row1&#39;, &#39;1&#39;, &#39;1e1&#39;],
 [&#39;row2&#39;, &#39;2&#39;, &#39;2e-1&#39;],
 [&#39;row3&#39;, &#39;3&#39;, &#39;3e+2&#39;]]</code></pre>
<ul>
<li>使用 numpy, 读取后直接转成数组的方式 (推荐):<br>
<code>np.loadtxt</code>, <code>np.genfromtxt</code> (写文件是
<code>np.savetxt</code>)<br> 超大文件读取建议用 pandas 包.</li>
</ul>
<p>e.g.</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> numpy <span class="token keyword">as</span> np
<span class="token operator">>></span><span class="token operator">></span> arr <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>fname<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span> <span class="token comment"># 默认分割符为空格</span>
<span class="token operator">>></span><span class="token operator">></span> col1<span class="token punctuation">,</span> col2 <span class="token operator">=</span> np<span class="token punctuation">.</span>loadtxt<span class="token punctuation">(</span>fname<span class="token punctuation">,</span> skiprows<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span> usecols<span class="token operator">=</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> unpack<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><code>np.genfromtxt</code> 和 <code>np.loadtxt</code> 类似,
增加了处理 missing values 的功能.<br> (但参数 skiprows=1 需替换为
skip_header=1)</p>
<p>例 (这里使用功能更多的 <code>np.genfromtxt</code> 代替
<code>np.loadtxt</code>):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">arr <span class="token operator">=</span> np<span class="token punctuation">.</span>genfromtxt<span class="token punctuation">(</span><span class="token string">'data/data.csv'</span><span class="token punctuation">,</span>
                    skip_header<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                    names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'col1'</span><span class="token punctuation">,</span> <span class="token string">'col2'</span><span class="token punctuation">,</span> <span class="token string">'col3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dtype<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'U15'</span><span class="token punctuation">,</span> <span class="token string">'int'</span><span class="token punctuation">,</span> <span class="token string">'float'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">[</span><span class="token punctuation">[</span><span class="token string">'col1'</span><span class="token punctuation">,</span> <span class="token string">'col2'</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span>  <span class="token comment"># 设定了 names 之后, 可以用名称索引</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>[(&#39;row1&#39;, 1) (&#39;row2&#39;, 2) (&#39;row3&#39;, 3)]</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">arr <span class="token operator">=</span> np<span class="token punctuation">.</span>genfromtxt<span class="token punctuation">(</span><span class="token string">'data/data2.csv'</span><span class="token punctuation">,</span>
                    skip_header<span class="token operator">=</span><span class="token number">1</span><span class="token punctuation">,</span>
                    names<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'col1'</span><span class="token punctuation">,</span> <span class="token string">'col2'</span><span class="token punctuation">,</span> <span class="token string">'col3'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    dtype<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">'U15'</span><span class="token punctuation">,</span> <span class="token string">'int'</span><span class="token punctuation">,</span> <span class="token string">'float'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    missing_values<span class="token operator">=</span><span class="token boolean">None</span><span class="token punctuation">,</span>
                    filling_values<span class="token operator">=</span><span class="token punctuation">(</span><span class="token string">''</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> np<span class="token punctuation">.</span>nan<span class="token punctuation">)</span><span class="token punctuation">,</span>  <span class="token comment"># 分开指定</span>
                    delimiter<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>arr<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>[(&#39;row1&#39;, 0, 10. ) (&#39;&#39;, 2,  0.2) (&#39;row3&#39;, 3,  nan)]</code></pre>
<ul>
<li>一般而言, 对于一个由分隔符分隔的字符串, 转成一个数组的方式:<br>
<code>np.fromstring(string, dtype=float, count=-1, sep='')</code></li>
</ul>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>fromstring<span class="token punctuation">(</span><span class="token string">'0 1 2'</span><span class="token punctuation">,</span> dtype<span class="token operator">=</span><span class="token builtin">int</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">' '</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([0, 1, 2])</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>fromstring<span class="token punctuation">(</span><span class="token string">'0., 1., 2.'</span><span class="token punctuation">,</span> sep<span class="token operator">=</span><span class="token string">','</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>array([0., 1., 2.])</code></pre>
<h3 id="numpy-save-文件读写">numpy save 文件读写</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">np<span class="token punctuation">.</span>save<span class="token punctuation">(</span><span class="token string">'fname'</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span>  <span class="token comment"># 'fname.npy'</span>
np<span class="token punctuation">.</span>savez<span class="token punctuation">(</span><span class="token string">'fname'</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span>  <span class="token comment"># 'fname.npz', 多个变量</span>
np<span class="token punctuation">.</span>savez_compressed<span class="token punctuation">(</span><span class="token string">'fname'</span><span class="token punctuation">,</span> arr<span class="token punctuation">)</span>  <span class="token comment"># 'fname.npz', 多个变量 &amp; 压缩</span>
np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'fname.npz'</span><span class="token punctuation">)</span>  <span class="token comment"># Load the files created by savez_compressed.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 存入</span>
arr <span class="token operator">=</span> np<span class="token punctuation">.</span>ones<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span>  <span class="token comment"># 默认 `float64`</span>
np<span class="token punctuation">.</span>savez<span class="token punctuation">(</span><span class="token string">'data/np_array'</span><span class="token punctuation">,</span> a<span class="token operator">=</span>arr<span class="token punctuation">,</span> b<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">ls data<span class="token operator">/</span><span class="token operator">*</span><span class="token punctuation">.</span>npz<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>data/np_array.npz</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 载入</span>
data <span class="token operator">=</span> np<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token string">'data/np_array.npz'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> data<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token builtin">int</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'b'</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 默认以`ndarray`读取</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>(array([1., 1., 1., 1., 1.]), array(0), 0)</code></pre>
<h3 id="idl-sav-文件读取">IDL sav 文件读取</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>idl <span class="token keyword">import</span> readsav
data <span class="token operator">=</span> readsav<span class="token punctuation">(</span><span class="token string">'dname.sav'</span><span class="token punctuation">,</span> verbose<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">,</span> python_dict<span class="token operator">=</span><span class="token boolean">False</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>默认读出的是<code>scipy.io.idl.AttrDict</code>类型, 即 key
的大小写不敏感.<br> 想要得到大小写敏感的 python dict, 设置
<code>python_dict=True</code> 即可. <br><br> 例:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> scipy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>idl <span class="token keyword">import</span> readsav
data <span class="token operator">=</span> readsav<span class="token punctuation">(</span><span class="token string">'data/myidlfile.sav'</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 注意返回的是一个`dict_keys`对象, 如需索引需要手动转为list</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'X'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># 大小写不敏感</span>
data <span class="token operator">=</span> readsav<span class="token punctuation">(</span><span class="token string">'data/myidlfile.sav'</span><span class="token punctuation">,</span> python_dict<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token builtin">type</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">print</span><span class="token punctuation">(</span>data<span class="token punctuation">[</span><span class="token string">'x'</span><span class="token punctuation">]</span><span class="token punctuation">.</span>shape<span class="token punctuation">)</span>  <span class="token comment"># 大小写敏感</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>&lt;class &#39;scipy.io.idl.AttrDict&#39;&gt;
dict_keys([&#39;x&#39;, &#39;y&#39;, &#39;str&#39;])
(25,)
&lt;class &#39;dict&#39;&gt;
(25,)</code></pre>
<h3 id="fits-文件读取">FITS 文件读取</h3>
<ul>
<li>Astropy</li>
</ul>
<p>参考:<br> <a href="http://docs.astropy.org/en/stable/io/fits"
class="uri">http://docs.astropy.org/en/stable/io/fits</a><br> <a
href="https://python4astronomers.github.io/astropy/fits.html"
class="uri">https://python4astronomers.github.io/astropy/fits.html</a></p>
<blockquote>
<p>[Note]<br> If you are already familiar with PyFITS, astropy.io.fits
is in fact the same code as the latest version of PyFITS, and you can
adapt old scripts that use PyFITS to use Astropy by simply doing:
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> astropy<span class="token punctuation">.</span>io <span class="token keyword">import</span> fits <span class="token keyword">as</span> pyfits<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre> However, for new scripts, we recommend the following
import: <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> astropy<span class="token punctuation">.</span>io <span class="token keyword">import</span> fits<span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre></p>
</blockquote>
<p><code>fits.open</code> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">from</span> astropy<span class="token punctuation">.</span>io <span class="token keyword">import</span> fits
<span class="token operator">>></span><span class="token operator">></span> hdulist <span class="token operator">=</span> fits<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'&lt;filename>.fit'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> hdulist<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># hdulist 是一个由 HDU objects 组成的类似列表的对象</span>
Filename<span class="token punctuation">:</span> <span class="token operator">&lt;</span>filename<span class="token operator">></span><span class="token punctuation">.</span>fit
No<span class="token punctuation">.</span>    Name         Type      Cards   Dimensions   Format
<span class="token number">0</span>    PRIMARY     PrimaryHDU    <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token number">1</span>    ENERGIES    BinTableHDU   <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>       <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>        <span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token punctuation">.</span>
<span class="token operator">>></span><span class="token operator">></span> hdu <span class="token operator">=</span> hdulist<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> hdu<span class="token punctuation">.</span>data  <span class="token comment"># ndarray</span>
<span class="token operator">>></span><span class="token operator">></span> hdu<span class="token punctuation">.</span>header<span class="token punctuation">[</span><span class="token string">'&lt;key>'</span><span class="token punctuation">]</span>  <span class="token comment"># 得到某个 header keyword</span>
<span class="token comment"># 修改数据后</span>
<span class="token operator">>></span><span class="token operator">></span> hdu<span class="token punctuation">.</span>writeto<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fits'</span><span class="token punctuation">)</span> <span class="token comment"># 保存 HDU object</span>
<span class="token operator">>></span><span class="token operator">></span> hdulist<span class="token punctuation">.</span>writeto<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fits'</span><span class="token punctuation">)</span>  <span class="token comment"># 或保存整个表</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># 创建一个 fits Primary HDU object</span>
<span class="token operator">>></span><span class="token operator">></span> hdu <span class="token operator">=</span> fits<span class="token punctuation">.</span>PrimaryHDU<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> hdu<span class="token punctuation">.</span>writeto<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fits'</span><span class="token punctuation">)</span>  <span class="token comment"># 保存 HDU object</span>
<span class="token operator">>></span><span class="token operator">></span> hdu<span class="token punctuation">.</span>writeto<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fits'</span><span class="token punctuation">,</span> clobber<span class="token operator">=</span><span class="token boolean">True</span><span class="token punctuation">)</span>  <span class="token comment"># 保存到已存在文件</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<code>fits.getdata</code>, <code>fits.getheader</code> <pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> data <span class="token operator">=</span> fits<span class="token punctuation">.</span>getdata<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fit'</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> header <span class="token operator">=</span> fits<span class="token punctuation">.</span>getheader<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fit'</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<br> * SunPy</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sunpy<span class="token punctuation">.</span>io
<span class="token operator">>></span><span class="token operator">></span> hdulist <span class="token operator">=</span> sunpy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fits'</span><span class="token punctuation">)</span>  <span class="token comment"># 自动判断文件类型</span>
<span class="token comment"># or use `hdulist = sunpy.io.fits.read('&lt;filename>.fits')`</span>
<span class="token operator">>></span><span class="token operator">></span> hdu <span class="token operator">=</span> hdulist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
<span class="token operator">>></span><span class="token operator">></span> hdu<span class="token punctuation">.</span>data  <span class="token comment"># ndarray</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span>
<span class="token operator">>></span><span class="token operator">></span> smap <span class="token operator">=</span> sunpy<span class="token punctuation">.</span><span class="token builtin">map</span><span class="token punctuation">.</span>Map<span class="token punctuation">(</span><span class="token string">'&lt;filename>.fits'</span><span class="token punctuation">)</span>
<span class="token comment"># 得到一个 sunpy `GenericMap` object</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>例:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">from</span> astropy<span class="token punctuation">.</span>io <span class="token keyword">import</span> fits
fname <span class="token operator">=</span> <span class="token string">'scripts-sunpy/plothmi/data/hmi.B_720s.20150827_052400_TAI.field.fits'</span>
hdulist <span class="token operator">=</span> fits<span class="token punctuation">.</span><span class="token builtin">open</span><span class="token punctuation">(</span>fname<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdulist<span class="token punctuation">.</span>info<span class="token punctuation">(</span><span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span></span></code></pre>
<pre><code>Filename: scripts-sunpy/plothmi/data/hmi.B_720s.20150827_052400_TAI.field.fits
No.    Name      Ver    Type      Cards   Dimensions   Format
  0  PRIMARY       1 PrimaryHDU       6   ()      
  1                1 CompImageHDU    155   (4096, 4096)   int32   </code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python">hdulist<span class="token punctuation">.</span>verify<span class="token punctuation">(</span><span class="token string">'silentfix+warn'</span><span class="token punctuation">)</span>
hdu <span class="token operator">=</span> hdulist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
hdu<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<pre><code>(4096, 4096)</code></pre>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> sunpy<span class="token punctuation">.</span>io
hdulist <span class="token operator">=</span> sunpy<span class="token punctuation">.</span>io<span class="token punctuation">.</span>read_file<span class="token punctuation">(</span>fname<span class="token punctuation">)</span>
hdu <span class="token operator">=</span> hdulist<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span>
hdu<span class="token punctuation">.</span>data<span class="token punctuation">.</span>shape<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<pre><code>(4096, 4096)</code></pre>
<h2 id="其他包和软件">其他包和软件</h2>
<ul>
<li>Astroconda <a href="https://astroconda.readthedocs.io/en/latest/"
class="uri">https://astroconda.readthedocs.io/en/latest/</a> &gt;
AstroConda is a free Conda channel maintained by the Space Telescope
Science Institute (STScI) in Baltimore, Maryland. This channel provides
tools and utilities required to process and analyze data from the Hubble
Space Telescope (HST), James Webb Space Telescope (JWST), and others.
<br><br></li>
<li>Canopy <a href="https://www.enthought.com/product/canopy/"
class="uri">https://www.enthought.com/product/canopy/</a> &gt; Enthought
Canopy provides a proven scientific and analytic Python package
distribution plus key integrated tools for iterative data analysis, data
visualization, and application development. Users have the ability to
extend and innovate with scripting and open platform APIs, driving the
creation and sharing of innovative workflows, tools, and applications.
<img src='/main/Canopy-Packages-min-1.png' > <br><br></li>
<li>PyCharm <a href="https://www.jetbrains.com/pycharm/"
class="uri">https://www.jetbrains.com/pycharm/</a>
<img src='/main/pycharm.jpg' > <br><br></li>
<li>Jupyterlab <a href="http://jupyterlab.readthedocs.io/en/stable/"
class="uri">http://jupyterlab.readthedocs.io/en/stable/</a>
<img src='/main/jupyterlab.png' ></li>
</ul>
]]></content>
      <categories>
        <category>Solar Physics</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>jupyter</tag>
      </tags>
  </entry>
  <entry>
    <title>Python 的脚本与交互式环境</title>
    <url>/2018-10-15-scripts-and-interactive-mode.html</url>
    <content><![CDATA[<p>目的是从交互环境调用脚本产生的变量, 可用于调试脚本和测试数据等等.</p>
<p>比如当前目录下有一个包含如下内容的脚本:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment">#!/usr/bin/env python</span>
a<span class="token operator">=</span><span class="token number">1</span>
<span class="token keyword">print</span><span class="token punctuation">(</span><span class="token string">'a ='</span><span class="token punctuation">,</span> a<span class="token punctuation">)</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<span id="more"></span>
<h3 id="方法-1.-shell---interactive-mode-推荐">方法 1. shell -&gt;
interactive mode (推荐)</h3>
<p>使用 <code>-i</code> 选项:</p>
<pre class="line-numbers language-bash" data-language="bash"><code class="language-bash"><span class="token comment"># shell</span>
$ python -i test.py<span aria-hidden="true" class="line-numbers-rows"><span></span><span></span></span></code></pre>
<p>执行结束随即进入 python 交互环境, 并且保留了脚本中定义的变量:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python</span>
a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token operator">>></span><span class="token operator">></span> a
<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="方法-2.-in-ipython-jupyter-第二推荐">方法 2. In ipython /
jupyter (第二推荐)</h3>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># ipython</span>
In <span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>run test<span class="token punctuation">.</span>py
a <span class="token operator">=</span> <span class="token number">1</span>

In <span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> a
Out<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token number">1</span>

In <span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>who
a

In <span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span><span class="token punctuation">:</span> <span class="token operator">%</span>whos
Variable   Type    Data<span class="token operator">/</span>Info
<span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span><span class="token operator">-</span>
a          <span class="token builtin">int</span>     <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<h3 id="方法-3.-in-interactive-mode">方法 3. In interactive mode</h3>
<blockquote>
<p><strong>NOTE</strong>: Python 3 取消了 <code>execfile()</code>
这个函数! 如今使用 <code>exec()</code>.</p>
</blockquote>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">exec</span><span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.py'</span><span class="token punctuation">)</span><span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token operator">>></span><span class="token operator">></span> a
<span class="token number">1</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token string">'a'</span> <span class="token keyword">in</span> <span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token boolean">True</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">[</span><span class="token string">'a'</span><span class="token punctuation">]</span>  <span class="token comment"># same as vars()['a']</span>
<span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>但这之后文件并没有关闭, 虽然多数时候没有影响, 但如果实在要关闭,
建议使用 <code>with</code> :</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python</span>
<span class="token keyword">with</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">'test.py'</span><span class="token punctuation">)</span> <span class="token keyword">as</span> f<span class="token punctuation">:</span>
    <span class="token keyword">exec</span><span class="token punctuation">(</span>f<span class="token punctuation">.</span>read<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># ctrl+D to exit the block</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p>总之十分不方便, 因此不推荐. <br><br> 对于没有使用
<code>if __name__ == "__main__"</code> 的脚本, 当脚本处在当前目录或
<code>$PYTHONPATH</code> 中时, 也可以有比较方便的办法<br>(
注意这里因为是调用 module 的形式, 所以不要加 '.py' ):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token comment"># python</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> test
a <span class="token operator">=</span> <span class="token number">1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span></span></code></pre>
<p><br> 补充说明在 python 交互环境中查看当前环境中的变量的方法 (ipython
/ jupyter 使用 <code>%who</code>, <code>%whos</code> 即可):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token builtin">dir</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># without an argument, return the names in the current scope</span>
<span class="token builtin">globals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># a dictionary containing the current scope's global variables</span>
<span class="token builtin">locals</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># a dictionary containing the current scope's local variables</span>
<span class="token builtin">vars</span><span class="token punctuation">(</span><span class="token punctuation">)</span>  <span class="token comment"># without arguments, equivalent to locals();</span>
        <span class="token comment"># with an argument, equivalent to object.__dict__.</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
]]></content>
      <categories>
        <category>Solar Physics</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>使用 pickle 模块存取 dict</title>
    <url>/2018-10-20-pickle.html</url>
    <content><![CDATA[<p>Python 自带一个存取 dict 到二进制文件的工具 <a
href="https://docs.python.org/3/library/pickle.html">pickle</a>,
支持数值型的 key (<a
href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.savez.html">numpy.savez</a>
和 <a
href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.savez_compressed.html">numpy.savez_compressed</a>
只支持字符串作为 key).</p>
<p>用法:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token keyword">import</span> pickle
<span class="token comment"># 存入</span>
pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>data<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"filename.p"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># type(data): dict</span>
<span class="token comment"># 读取</span>
data <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"filename.p"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 返回一个 dict</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<span id="more"></span>
<p>以下示例特地使用了数值型的 key:</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pickle
<span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token number">1.1</span><span class="token punctuation">:</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">:</span><span class="token number">2</span><span class="token punctuation">&#125;</span>  <span class="token comment"># 以 float 和 int 作为 key</span>
<span class="token operator">>></span><span class="token operator">></span> <span class="token keyword">import</span> pickle
<span class="token operator">>></span><span class="token operator">></span> pickle<span class="token punctuation">.</span>dump<span class="token punctuation">(</span>a<span class="token punctuation">,</span> <span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"data.p"</span><span class="token punctuation">,</span> <span class="token string">"wb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment"># 并不会自动添加后缀名</span>
<span class="token operator">>></span><span class="token operator">></span> b <span class="token operator">=</span> pickle<span class="token punctuation">.</span>load<span class="token punctuation">(</span><span class="token builtin">open</span><span class="token punctuation">(</span><span class="token string">"data.p"</span><span class="token punctuation">,</span> <span class="token string">"rb"</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> b<span class="token punctuation">.</span>keys<span class="token punctuation">(</span><span class="token punctuation">)</span>
dict_keys<span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token operator">>></span><span class="token operator">></span> b<span class="token punctuation">[</span><span class="token number">1.1</span><span class="token punctuation">]</span>
<span class="token number">1.1</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span></span></code></pre>
<p>注意 <code>pickle.load()</code> 返回的类型是 dict, 但
<code>numpy.load()</code> 读取 '*.npz' 文件所返回是一个可以像 dict
一样使用 key 来索引数据的 <code>numpy.lib.npyio.NpzFile</code> 对象.</p>
<p>'*.p' 文件的大小和非压缩的 '*.npz' (<code>numpy.savez()</code>) 一致,
然而压缩过的 '*.npz' (<code>numpy.savez_compressed()</code>)
显然占用空间更小, 因此在方便的情况下 (例如 key 是字符串,
读取后直接操作数据而不需要得到一个 dict), 推荐优先使用 numpy. <br><br>
如果要存入上述示例中同样的数据到 '*.npz' 格式, 需要转换 key 的类型
(读取时也需要使用字符串型的 key):</p>
<pre class="line-numbers language-python" data-language="python"><code class="language-python"><span class="token operator">>></span><span class="token operator">></span> a <span class="token operator">=</span> <span class="token punctuation">&#123;</span><span class="token builtin">str</span><span class="token punctuation">(</span>key<span class="token punctuation">)</span><span class="token punctuation">:</span>value <span class="token keyword">for</span> key<span class="token punctuation">,</span> value <span class="token keyword">in</span> a<span class="token punctuation">.</span>items<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">&#125;</span>
<span class="token operator">>></span><span class="token operator">></span> a
<span class="token punctuation">&#123;</span><span class="token string">'1.1'</span><span class="token punctuation">:</span> <span class="token number">1.1</span><span class="token punctuation">,</span> <span class="token string">'2'</span><span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">&#125;</span>
<span class="token operator">>></span><span class="token operator">></span> np<span class="token punctuation">.</span>savez_compressed<span class="token punctuation">(</span><span class="token string">'data2'</span><span class="token punctuation">,</span> <span class="token operator">**</span>a<span class="token punctuation">)</span>  <span class="token comment"># 会自动添加后缀名, 得到 'data2.npz'</span><span aria-hidden="true" class="line-numbers-rows"><span></span><span></span><span></span><span></span></span></code></pre>
<hr />
<p>其他数据存取教程:</p>
<ul>
<li><a href="main.html#4-常见数据文件读写">Python 简易教程 (lecture for
Solar Group)</a>
<ul>
<li><a href="main.html#41-一般情况">4.1. 一般情况</a></li>
<li><a href="main.html#42-txt-csv-文件读写">4.2. txt, csv
文件读写</a></li>
<li><a href="main.html#43-numpy-save-文件读写">4.3. numpy save
文件读写</a></li>
<li><a href="main.html#44-idl-sav-文件读取">4.4. IDL sav
文件读取</a></li>
<li><a href="main.html#45-fits-文件读取">4.5. FITS 文件读取</a></li>
</ul></li>
<li><a href="advance.html#9-其他格式文件读写">Python 进阶 (lecture for
Solar Group)</a>
<ul>
<li><a href="advance.html#91-用-pandas-读-csv">9.1. 用 pandas 读
csv</a></li>
<li><a href="advance.html#92-fortran-二进制文件读写">9.2. Fortran
二进制文件读写</a></li>
<li><a href="advance.html#93-hdf5-文件读写-ncdf-cdf-文件读取">9.3. HDF5
文件读写, NCDF, CDF 文件读取</a></li>
<li><a href="advance.html#94-numpy-to-vtk">9.4. NumPy to VTK</a></li>
<li><a href="advance.html#95-matlab-mat-文件读写">9.5. Matlab mat
文件读写</a></li>
</ul></li>
</ul>
]]></content>
      <categories>
        <category>Solar Physics</category>
      </categories>
      <tags>
        <tag>python</tag>
      </tags>
  </entry>
  <entry>
    <title>Pandas sep=&#39;\s+&#39; 的问题</title>
    <url>/2018-12-04-pandas-sep.html</url>
    <content><![CDATA[<p>Pandas 的 <code>read_table</code> (<a
href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_table.html">官方文档</a>)
和 <code>read_csv</code> (<a
href="https://pandas.pydata.org/pandas-docs/stable/generated/pandas.read_csv.html">官方文档</a>)
(指定分隔符的情况下两者无区别), 有关键字 <code>sep=</code>
(<code>read_table</code> 默认为 <code>sep='\t'</code>,
<code>read_csv</code> 默认为 <code>sep=','</code>).</p>
<p>但当需要指定多个空格的情况下, 指定 <code>sep='\s+'</code>
可能无法被正确识别. <span id="more"></span></p>
<p>请使用 <strong><code>' +'</code></strong> 代替.</p>
<p>官方文档中关于 <code>sep</code> 关键字的说明有如下描述:</p>
<blockquote>
<p>In addition, separators longer than 1 character and <strong>different
from <code>'\s+'</code></strong> will be interpreted as regular
expressions and will also force the use of the Python parsing
engine.</p>
</blockquote>
<p>指定 <code>sep='\s+'</code> 可能无法被正确识别,</p>
<p>暂时的办法是:<br> 加上参数 <code>engine='python'</code>, 或使用
<strong><code>' +'</code></strong> 代替 (此时
<code>engine='python'</code>).<br> 如果设为 <code>engine='c'</code>,
速度较快, 但不便识别正则表达, 追求效率的话可以配合使用:<br>
<code>quoting=3</code> (即使用 <code>csv.QUOTE_NONE</code>)</p>
<hr />
<p>Pandas 的读取方法简单介绍参见: <a
href="advance.html#91-用-pandas-读-csv">用 pandas 读 csv</a></p>
]]></content>
      <categories>
        <category>Solar Physics</category>
      </categories>
      <tags>
        <tag>python</tag>
        <tag>pandas</tag>
      </tags>
  </entry>
  <entry>
    <title>Coming back soon ...</title>
    <url>/2022-07-12-Coming-back-soon.html</url>
    <content><![CDATA[<p>I'm keep on restoring my old posts, as the original site has not been
accessable for quit a long time.</p>
<p>See you later~</p>
]]></content>
  </entry>
</search>
